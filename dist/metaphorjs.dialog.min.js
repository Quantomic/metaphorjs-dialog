(function(){window.MetaphorJs={lib:{}};var T=Array.prototype.slice,Z=MetaphorJs.isPlainObject=function(y){return!(!y||y.constructor!==Object)},K=MetaphorJs.extend=function c(){var a=!1,e=!1,b=T.call(arguments),g=b.shift(),p,h,A;"boolean"==typeof b[b.length-1]&&(a=b.pop());"boolean"==typeof b[b.length-1]&&(e=a,a=b.pop());for(;b.length;)if(p=b.shift())for(h in p)if(p.hasOwnProperty(h)&&"undefined"!=typeof(A=p[h]))if(e)if(g[h]&&Z(g[h])&&Z(A))c(g[h],A,a,e);else{if(!0===a||"undefined"==typeof g[h]||null===
g[h])Z(A)?(g[h]={},c(g[h],A,a,!0)):g[h]=A}else if(!0===a||"undefined"==typeof g[h]||null===g[h])g[h]=A;return g},aa=MetaphorJs.nextUid=function(){var c=["0","0","0"];return function(){for(var a=c.length,e;a;){a--;e=c[a].charCodeAt(0);if(57==e)return c[a]="A",c.join("");if(90==e)c[a]="0";else return c[a]=String.fromCharCode(e+1),c.join("")}c.unshift("0");return c.join("")}}(),y=MetaphorJs.bind=Function.prototype.bind?function(c,a){return c.bind(a)}:function(c,a){return function(){return c.apply(a,
arguments)}},ga=function(){var c={};return function(a){return c[a]||(c[a]=new RegExp(a))}}(),ba=MetaphorJs.hasClass=function(c,a){return a?ga("(?:^|\\s)"+a+"(?!\\S)").test(c.className):!1},L=MetaphorJs.addClass=function(c,a){a&&!ba(c,a)&&(c.className+=" "+a)},U=MetaphorJs.removeClass=function(c,a){a&&(c.className=c.className.replace(ga("(?:^|\\s)"+a+"(?!\\S)"),""))},ua=Object.prototype.toString,V=MetaphorJs.isArray=function(c){return!(!c||"object"!=typeof c||"number"!=typeof c.length||"[object Array]"!=
ua.call(c))},s=MetaphorJs.data=function(){var c={};return function(a,e,b){a=a._mjsId||(a._mjsId=aa());var g=c[a];return"undefined"!=typeof b?(g||(g=c[a]={}),g[e]=b):g?g[e]:void 0}}(),H=MetaphorJs.addListener=function(c,a,e){c.attachEvent?c.attachEvent("on"+a,e):c.addEventListener(a,e,!1)},M=MetaphorJs.removeListener=function(c,a,e){c.detachEvent?c.detachEvent("on"+a,e):c.removeEventListener(a,e,!1)},W=MetaphorJs.returnFalse=function(){return!1},X=MetaphorJs.returnTrue=function(){return!0};(function(){var c=
function(a){if(a instanceof c)return a;if(!(this instanceof c))return new c(a);for(var e in a)if(!this[e])try{this[e]=a[e]}catch(b){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var g,p=a.button;"undefined"==typeof this.pageX&&null!=a.clientX&&(g=this.target?this.target.ownerDocument||document:document,e=g.documentElement,g=g.body,this.pageX=a.clientX+(e&&e.scrollLeft||g&&g.scrollLeft||0)-(e&&e.clientLeft||g&&g.clientLeft||0),this.pageY=a.clientY+(e&&
e.scrollTop||g&&g.scrollTop||0)-(e&&e.clientTop||g&&g.clientTop||0));this.which||void 0===p||(this.which=p&1?1:p&2?3:p&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?X:W;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};c.prototype={isDefaultPrevented:W,isPropagationStopped:W,isImmediatePropagationStopped:W,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=X;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=
this.originalEvent;this.isPropagationStopped=X;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=X;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};MetaphorJs.lib.NormalizedEvent=c})();var N=MetaphorJs.normalizeEvent=function(){var c=MetaphorJs.lib.NormalizedEvent;return function(a){return new c(a)}}(),ha=MetaphorJs.isVisible=function(c){return!(0>=c.offsetWidth||0>=c.offsetHeight)},
ca=MetaphorJs.toArray=function(c){if(c&&void 0!=c.length&&"string"!=typeof c){for(var a=[],e=-1,b=c.length>>>0;++e!==b;a[e]=c[e]);return a}return c?[c]:[]},E=MetaphorJs.select=function(){var c=/^[\w[:#.][\w\]*^|=!]*$/,a=/=([^\]]+)/,e=/ *, */,b=/(\([^)]*)\+/,g=/(\[[^\]]+)~/,p=/(~|>|\+)/,h=/ +/,A=/([^[:.#]+)?(?:#([^[:.#]+))?(?:\.([^[:.]+))?(?:\[([^!&^*|$[:=]+)([!$^*|&]?=)?([^:\]]+)?\])?(?::([^(]+)(?:\(([^)]+)\))?)?/,l=/(?:(-?\d*)n)?(?:(%|-)(\d*))?/,t=/\D/,va=/[^(]*\(([^)]*)\)/,x=/\(.*/,J=/\[([^!~^*|$ [:=]+)([$^*|]?=)?([^ :\]]+)?\]/,
v=document,y=!!v.getElementsByClassName,ia=!!v.querySelectorAll,B={"first-child":function(k){return k.parentNode.getElementsByTagName("*")[0]!==k},"last-child":function(k){for(;(k=k.nextSibling)&&1!=k.nodeType;);return!!k},root:function(k){return"html"!==k.nodeName.toLowerCase()},"nth-child":function(k,r){var n=k.nodeIndex||0,f=r[3]=r[3]?("%"===r[2]?-1:1)*r[3]:0,d=r[1];if(n)return!((n+f)%d);var b=k.parentNode.firstChild;n++;do if(1==b.nodeType&&(b.nodeIndex=++n)&&k===b&&(n+f)%d)return 0;while(b=b.nextSibling);
return 1},"nth-last-child":function(k,r){var n=k.nodeIndexLast||0,f=r[3]?("%"===r[2]?-1:1)*r[3]:0,d=r[1];if(n)return!((n+f)%d);var b=k.parentNode.lastChild;n++;do if(1==b.nodeType&&(b.nodeLastIndex=n++)&&k===b&&(n+f)%d)return 0;while(b=b.previousSibling);return 1},empty:function(d){return!!d.firstChild},parent:function(d){return!d.firstChild},"only-child":function(d){return 1!=d.parentNode.getElementsByTagName("*").length},checked:function(d){return!d.checked},lang:function(d,r){return d.lang!==r&&
v.documentElement.lang!==r},enabled:function(d){return d.disabled||"hidden"===d.type},disabled:function(d){return!d.disabled},selected:function(d){return!d.selected}},w={},z=function(d){return w[d]||(w[d]=new RegExp("(^| +)"+d+"($| +)"))},d={"":function(d,r){return!!d.getAttribute(r)},"=":function(d,r,n){return(r=d.getAttribute(r))&&r===n},"&=":function(d,r,n){return(r=d.getAttribute(r))&&z(n).test(r)},"^=":function(d,r,n){return(r=d.getAttribute(r)+"")&&!r.indexOf(n)},"$=":function(d,r,n){return(r=
d.getAttribute(r)+"")&&r.indexOf(n)==r.length-n.length},"*=":function(d,r,n){return(r=d.getAttribute(r)+"")&&-1!=r.indexOf(n)},"|=":function(d,r,n){return(r=d.getAttribute(r)+"")&&(r===n||!!r.indexOf(n+"-"))},"!=":function(d,r,n){return!(r=d.getAttribute(r))||!z(n).test(r)}};return function(k,r){r=r||v;var n=[],f=null,I,z,w,u,m,F,G;if(ia)try{n=ca(r.querySelectorAll(k.replace(a,'="$1"')))}catch(Y){f=!0}if(!ia||f)if(c.test(k))switch(f=0,k.charAt(0)){case "#":f=k.slice(1);n=v.getElementById(f);n.id!==
f&&(n=v.all[f]);n=n?[n]:[];break;case ".":I=k.slice(1);if(y)n=ca((n=r.getElementsByClassName(I)).length?n:[]);else{I=" "+I+" ";z=r.getElementsByTagName("*");for(w=0;u=z[w++];)-1!=(" "+u.className+" ").indexOf(I)&&(n[f++]=u);n=f?n:[]}break;case ":":z=r.getElementsByTagName("*");w=0;m=k.replace(va,"$1");for(F=k.replace(x,"");u=z[w++];)B[F]&&!B[F](u,m)&&(n[f++]=u);n=f?n:[];break;case "[":z=r.getElementsByTagName("*");w=0;u=J.exec(k);I=u[1];G=u[2]||"";for(m=u[3];u=z[w++];)d[G]&&(d[G](u,I,m)||"class"===
I&&d[G](u,"className",m))&&(n[f++]=u);n=f?n:[];break;default:n=ca((n=r.getElementsByTagName(k)).length?n:[])}else{for(var ja=k.split(e),ka=ja.length-1,wa=!!ka,la,ma,D,da,Q,s,R,S,H,C,E,K;f=ja[ka--];){ma=(la=f.replace(b,"$1%").replace(g,"$1&").replace(p," $1 ").split(h)).length;w=0;da=" ";for(z=[r];D=la[w++];)if(" "!==D&&">"!==D&&"~"!==D&&"+"!==D&&z){D=D.match(A);Q=D[1]||"*";s=D[2];R=D[3]?" "+D[3]+" ":"";I=D[4];G=D[5]||"";F=D[7];m="nth-child"===F||"nth-last-child"===F?l.exec("even"===D[8]&&"2n"||"odd"===
D[8]&&"2n%1"||!t.test(D[8])&&"0n%"+D[8]||D[8]):D[8];S=[];f=H=0;for(E=w==ma;C=z[H++];)switch(da){case " ":K=C.getElementsByTagName(Q);for(C=0;u=K[C++];)s&&u.id!==s||R&&-1==(" "+u.className+" ").indexOf(R)||!(!I||d[G]&&(d[G](u,I,D[6])||"class"===I&&d[G](u,"className",D[6])))||u.yeasss||(B[F]?B[F](u,m):F)||(E&&(u.yeasss=1),S[f++]=u);break;case "~":for(Q=Q.toLowerCase();(C=C.nextSibling)&&!C.yeasss;)1!=C.nodeType||"*"!==Q&&C.nodeName.toLowerCase()!==Q||s&&C.id!==s||R&&-1==(" "+C.className+" ").indexOf(R)||
!(!I||d[G]&&(d[G](u,I,D[6])||"class"===I&&d[G](u,"className",D[6])))||C.yeasss||(B[F]?B[F](C,m):F)||(E&&(C.yeasss=1),S[f++]=C);break;case "+":for(;(C=C.nextSibling)&&1!=C.nodeType;);!C||C.nodeName.toLowerCase()!==Q.toLowerCase()&&"*"!==Q||s&&C.id!==s||R&&-1==(" "+u.className+" ").indexOf(R)||!(!I||d[G]&&(d[G](u,I,D[6])||"class"===I&&d[G](u,"className",D[6])))||C.yeasss||(B[F]?B[F](C,m):F)||(E&&(C.yeasss=1),S[f++]=C);break;case ">":for(K=C.getElementsByTagName(Q),w=0;u=K[w++];)u.parentNode!==C||s&&
u.id!==s||R&&-1==(" "+u.className+" ").indexOf(R)||!(!I||d[G]&&(d[G](u,I,D[6])||"class"===I&&d[G](u,"className",D[6])))||u.yeasss||(B[F]?B[F](u,m):F)||(E&&(u.yeasss=1),S[f++]=u)}z=S}else da=D;if(wa){if(!z.concat){S=[];for(C=0;u=z[C];)S[C++]=u;z=S}n=z.concat(1==n.length?n[0]:n)}else n=z}for(f=n.length;f--;)n[f].yeasss=n[f].nodeIndex=n[f].nodeIndexLast=null}return n}}(),ea=MetaphorJs.is=function(c,a){var e=E(a,c.parentNode),b,g;b=-1;for(g=e.length;++b<g;)if(e[b]===c)return!0;return!1},na=function(){var c=
["Moz","Webkit","ms","O","Khtml"],a="animationDelay",e="animationDuration",b="transitionDelay",g="transitionDuration",p=null;(function(){var h=document.createElement("div"),A=!1,l,t,p;if(void 0!==h.style.animationName)A=!0;else for(t=0,p=c.length;t<p;t++)if(l=c[t],void 0!==h.style[l+"AnimationName"]){A=!0;a=l+"AnimationDelay";e=l+"AnimationDuration";b=l+"TransitionDelay";g=l+"TransitionDuration";break}return A})()&&(p={animationDelay:a,animationDuration:e,transitionDelay:b,transitionDuration:g});
return function(){return p}}(),xa=MetaphorJs.getAnimationDuration=function(){var c=function(b){if(!b)return 0;var l=parseFloat(b);-1==b.indexOf("ms")&&(l*=1E3);return l},a=function(b,l,g){var a,h,p=l.length;for(a=0;a<p;a++)h=c(l[a])+c(g[a]),b=Math.max(h,b);return b},e=na(),b=e?e.animationDuration:null,g=e?e.animationDelay:null,p=e?e.transitionDuration:null,h=e?e.transitionDelay:null;return function(A){if(!e)return 0;var l=window.getComputedStyle?window.getComputedStyle(A,null):A.style;A=0;var t=(l[b]||
"").split(","),c=(l[g]||"").split(","),x=(l[p]||"").split(","),l=(l[h]||"").split(",");A=Math.max(A,a(A,t,c));return A=Math.max(A,a(A,x,l))}}(),O=MetaphorJs.isThenable=function(c){var a;return!c||"object"!=typeof c&&"function"!=typeof c?!1:"function"==typeof(a=c.then)?a:!1};(function(){var c="undefined"!=typeof window?window:global,a={};MetaphorJs.ns={register:function(e,b){var g;g=e.split(".");var p,h=g.pop();p=g.join(".");var A=g.length,l,t=c;if(a[p])g=[a[p],h];else{for(p=0;p<A;p++)l=g[p],t[l]||
(t[l]={}),t=t[l];g=[t,h]}g[0][g[1]]=b;return a[e]=b},exists:function(c){return a[c]?!0:!1},get:function(e,b){if(a[e]||b)return a[e];var g=e.split("."),p,h=g.length,A,l=c;for(p=0;p<h;p++){A=g[p];if(!l[A])return null;l=l[A]}l&&(a[e]=l);return l},add:function(c,b){return a[c]=b},remove:function(c){delete a[c]}}})();var oa=MetaphorJs.ns.get;(function(){var c=[],a=!1,e="undefined"!=typeof process?process.nextTick:function(b){setTimeout(b,0)},b=function(){a=!0;var g=c.shift();e(function(){g[0].apply(g[1],
g[2]);c.length?b():a=!1},0)},g=function(g,l,t){t=t||[];c.push([g,l,t]);a||b()},p=function(b,l){return function(g){try{l.resolve(b(g))}catch(a){l.reject(a)}}},h=function(b,l){if(b instanceof h)return b;if(!(this instanceof h))return new h(b,l);this._fulfills=[];this._rejects=[];this._dones=[];this._fails=[];if("undefined"!=typeof b)if(O(b)||"function"!=typeof b)this.resolve(b);else try{b.call(l,y(this.resolve,this),y(this.reject,this))}catch(g){this.reject(g)}};h.prototype={_state:0,_fulfills:null,
_rejects:null,_dones:null,_fails:null,_wait:0,_value:null,_reason:null,_triggered:!1,isPending:function(){return 0==this._state},isFulfilled:function(){return 1==this._state},isRejected:function(){return 2==this._state},_cleanup:function(){delete this._fulfills;delete this._rejects;delete this._dones;delete this._fails},_processValue:function(b,l){var g;if(0==this._state)if(b===this)this._doReject(new TypeError("cannot resolve promise with itself"));else{try{if(g=O(b)){b instanceof h?b.then(y(this._processResolveValue,
this),y(this._processRejectReason,this)):(new h(g,b)).then(y(this._processResolveValue,this),y(this._processRejectReason,this));return}}catch(a){0==this._state&&this._doReject(a);return}l.call(this,b)}},_callResolveHandlers:function(){this._done();for(var b=this._fulfills,l;l=b.shift();)g(l[0],l[1],[this._value]);this._cleanup()},_doResolve:function(b){this._value=b;this._state=1;0==this._wait&&this._callResolveHandlers()},_processResolveValue:function(b){this._processValue(b,this._doResolve)},resolve:function(b){if(this._triggered)return this;
this._triggered=!0;this._processResolveValue(b);return this},_callRejectHandlers:function(){this._fail();for(var b=this._rejects,l;l=b.shift();)g(l[0],l[1],[this._reason]);this._cleanup()},_doReject:function(b){this._state=2;this._reason=b;0==this._wait&&this._callRejectHandlers()},_processRejectReason:function(b){this._processValue(b,this._doReject)},reject:function(b){if(this._triggered)return this;this._triggered=!0;this._processRejectReason(b);return this},then:function(b,l){var a=new h,c=this._state;
0==c||0!=this._wait?(b&&"function"==typeof b?this._fulfills.push([p(b,a),null]):this._fulfills.push([a.resolve,a]),l&&"function"==typeof l?this._rejects.push([p(l,a),null]):this._rejects.push([a.reject,a])):1==c?b&&"function"==typeof b?g(p(b,a),null,[this._value]):a.resolve(this._value):2==c&&(l&&"function"==typeof l?g(p(l,a),null,[this._reason]):a.reject(this._reason));return a},"catch":function(b){return this.then(null,b)},_done:function(){for(var b=this._dones,a;a=b.shift();)a[0].call(a[1]||null,
this._value)},done:function(b,a){var g=this._state;1==g&&0==this._wait?b.call(a||null,this._value):0==g&&this._dones.push([b,a]);return this},_fail:function(){for(var b=this._fails,a;a=b.shift();)a[0].call(a[1]||null,this._reason)},fail:function(b,a){var g=this._state;2==g&&0==this._wait?b.call(a||null,this._reason):0==g&&this._fails.push([b,a]);return this},always:function(b,a){this.done(b,a);this.fail(b,a);return this},promise:function(){return{then:y(this.then,this),done:y(this.done,this),fail:y(this.fail,
this),always:y(this.always,this)}},after:function(b){var a=this;if(O(b)){a._wait++;var g=function(){a._wait--;0==a._wait&&0!=a._state&&(1==a._state?a._callResolveHandlers():a._callRejectHandlers())};"function"==typeof b.done?b.done(g):b.then(g)}return a}};h.resolve=function(b){return new h(b)};h.reject=function(b){var a=new h;a.reject(b);return a};h.all=function(b){if(!b.length)return h.resolve(null);var a=new h,g=b.length,c=Array(g),p=g,e,v,s=function(b,g){c[g]=b;p--;0==p&&a.resolve(c)};for(e=0;e<
g;e++)(function(g){v=b[e];v instanceof h?v.done(function(b){s(b,g)}).fail(a.reject,a):O(v)||"function"==typeof v?(new h(v)).done(function(b){s(b,g)}).fail(a.reject,a):s(v,g)})(e);return a};h.when=function(){return h.all(arguments)};h.allResolved=function(b){if(!b.length)return h.resolve(null);var a=new h,g=b.length,c=[],p=g,e,v,s=function(b){c.push(b);y()},y=function(){p--;0==p&&a.resolve(c)};for(e=0;e<g;e++)v=b[e],v instanceof h?v.done(s).fail(y):O(v)||"function"==typeof v?(new h(v)).done(s).fail(y):
s(v);return a};h.race=function(b){if(!b.length)return h.resolve(null);var a=new h,g=b.length,c,p;for(c=0;c<g&&(p=b[c],p instanceof h?p.done(a.resolve,a).fail(a.reject,a):O(p)||"function"==typeof p?(new h(p)).done(a.resolve,a).fail(a.reject,a):a.resolve(p),a.isPending());c++);return a};MetaphorJs.lib.Promise=h})();var P=MetaphorJs.lib.Promise,ya=MetaphorJs.animate=function(){var c={show:["mjs-show"],hide:["mjs-hide"],enter:["mjs-enter"],leave:["mjs-leave"],move:["mjs-move"]},a=0,e=!!na(),b=window.requestAnimationFrame?
window.requestAnimationFrame:function(b){window.setTimeout(b,0)},g=function(a,g,c){var p=function(){(new Date).getTime()-g>=c?a():b(p)};b(p)},p=function l(a,c,h,e,v,y,E){var B=function(){var b=s(a,"mjsAnimationQueue");return b&&b.length&&b[0].id==E?!1:(v.reject(a),!0)},w=function(){if(!B()){var b=h;h++;if(h==c.length){v.resolve(a);s(a,"mjsAnimationQueue").shift();var r=s(a,"mjsAnimationQueue");r.length?(r=r[0],p(r.el,r.stages,0,r.start,r.deferred,!1,r.id)):s(a,"mjsAnimationQueue",null)}else s(a,"mjsAnimationQueue")[0].position=
h,l(a,c,h,null,v);U(a,c[b]);U(a,c[b]+"-active")}},z=function(){if(!B()){L(a,c[h]+"-active");var b=xa(a);b?g(w,(new Date).getTime(),b):w()}},d=function(){if(!B()){L(a,c[h]);var d;e&&(d=e(a),e=null);O(d)?d.done(z):b(z)}};y?b(d):d()},h=function(b,g,h,y){var J=new P,v=s(b,"mjsAnimationQueue")||[],E=++a,H=b.getAttribute("mjs-animate"),B,w,z,d,k,r,n;g=g||H;y&&null===H&&(g=null);if(g){"string"==typeof g?"["==g.substr(0,1)?B=(new Function("","return "+g))():(B=c[g],g=oa&&oa("animate."+g,!0)):"function"==
typeof g?w=g:V(g)&&("string"==typeof g[0]?B=g:(z=g[0],d=g[1]));g&&g.constructor===Object&&(B=g.stages,w=g.fn,z=g.before,d=g.after,k=g.options?K({},g.options):{},r=g.context||null,n=g.duration||null,h=h||k.start);if(e&&B)return v.push({el:b,stages:B,start:h,deferred:J,position:0,id:E}),s(b,"mjsAnimationQueue",v),1==v.length&&p(b,B,0,h,J,!0,E),J;k=k||{};h&&(k.start=function(){h(b)});k.complete=function(){J.resolve(b)};n&&(k.duration=n);if(w&&"function"==typeof w)return z&&K(b.style,z,!0,!1),h&&h(b),
s(b,"mjsAnimationQueue",w.call(r,b,function(){J.resolve(b)})),J;if(window.jQuery){g=$(b);z&&g.css(z);s(b,"mjsAnimationQueue","stop");if(w&&"string"==typeof w)return g[w](k),J;if(d)return g.animate(d,k),J}}h?(w=h(b),O(w)?w.done(function(){J.resolve(b)}):J.resolve(b)):J.resolve(b);return J};h.addAnimationType=function(b,a){c[b]=a};return h}(),pa=MetaphorJs.stopAnimation=function(c){var a=s(c,"mjsAnimationQueue"),e;V(a)&&a.length?(e=a[0])&&e.stages&&(a=e.position,e=e.stages,U(c,e[a]),U(c,e[a]+"-active")):
"function"==typeof a?a(c):"stop"==a&&$(c).stop(!0,!0);s(c,"mjsAnimationQueue",null)},qa=MetaphorJs.async=function(c,a,e){setTimeout(function(){c.apply(a,e||[])},0)};(function(){var c=function(){this.events={}};c.prototype={createEvent:function(b,g){b=b.toLowerCase();var c=this.events;c[b]||(c[b]=new a(b,g));return c[b]},getEvent:function(b){b=b.toLowerCase();return this.events[b]},on:function(b,g,c,h){b=b.toLowerCase();var e=this.events;e[b]||(e[b]=new a(b));return e[b].on(g,c,h)},once:function(b,
a,c,h){h=h||{};h.limit=1;return this.on(b,a,c,h)},un:function(b,a,c){b=b.toLowerCase();var h=this.events;h[b]&&h[b].un(a,c)},hasListener:function(b,a,c){b=b.toLowerCase();var h=this.events;return h[b]?h[b].hasListener(a,c):!1},removeAllListeners:function(b){var a=this.events;a[b]&&a[b].removeAllListeners()},triggerAsync:function(){var b=arguments[0],a=this.events,b=b.toLowerCase();if(!a[b])return[];b=a[b];return b.triggerAsync.apply(b,T.call(arguments,1))},trigger:function(){var b=arguments[0],a=
this.events,b=b.toLowerCase();if(!a[b])return null;b=a[b];return b.trigger.apply(b,T.call(arguments,1))},suspendEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].suspend()},suspendAllEvents:function(){var b=this.events,a;for(a in b)b[a].suspend()},resumeEvent:function(b){b=b.toLowerCase();var a=this.events;a[b]&&a[b].resume()},resumeAllEvents:function(){var b=this.events,a;for(a in b)b[a].resume()},destroyEvent:function(b){var a=this.events;a[b]&&(a[b].removeAllListeners(),a[b].destroy(),
delete a[b])},destroy:function(b){var a=this.events;if(b)b=b.toLowerCase(),a[b]&&(a[b].destroy(),delete a[b]);else{for(var c in a)a[c].destroy();this.events={}}},getApi:function(){if(!this.api){for(var b="createEvent getEvent on un once hasListener removeAllListeners triggerAsync trigger suspendEvent suspendAllEvents resumeEvent resumeAllEvents destroyEvent".split(" "),a={},c,h=-1,e=b.length;++h<e;c=b[h],a[c]=y(this[c],this));this.api=a}return this.api}};var a=function(b,a){this.name=b;this.listeners=
[];this.map={};this.hash=aa();this.uni="$$"+b+"_"+this.hash;this.suspended=!1;this.lid=0;this.returnResult=a||!1};a.prototype={getName:function(){return this.name},destroy:function(){this.map=this.listeners=null},on:function(b,a,c){if(!b)return null;a=a||null;c=c||{};var h=this.uni,e=a||b;if(e[h]&&!c.allowDupes)return null;var l=++this.lid,t=c.first||!1;e[h]=l;b={fn:b,scope:a,uniScope:e,id:l,called:0,limit:c.limit||0,start:c.start||1,count:0,append:c.append,prepend:c.prepend};t?this.listeners.unshift(b):
this.listeners.push(b);this.map[l]=b;return l},once:function(b,a,c){c=c||{};c.once=!0;return this.on(b,a,c)},un:function(b,a){var c=-1,h=this.uni,e=this.listeners,l;l=b==parseInt(b)?b:(a||b)[h];if(!l)return!1;for(var t=0,s=e.length;t<s;t++)if(e[t].id==l){c=t;delete e[t].uniScope[h];break}if(-1==c)return!1;e.splice(c,1);delete this.map[l];return!0},hasListener:function(b,a){var c=this.listeners,h;if(b){h="function"!=typeof b?b:(a||b)[this.uni];if(!h)return!1;for(var e=0,l=c.length;e<l;e++)if(c[e].id==
h)return!0;return!1}return 0<c.length},removeAllListeners:function(){var b=this.listeners,a=this.uni,c,e;c=0;for(e=b.length;c<e;c++)delete b[c].uniScope[a];this.listeners=[];this.map={}},suspend:function(){this.suspended=!0},resume:function(){this.suspended=!1},_prepareArgs:function(b,a){var c;b.append||b.prepend?(c=T.call(a),b.prepend&&(c=b.prepend.concat(c)),b.append&&(c=c.concat(b.append))):c=a;return c},triggerAsync:function(){if("undefined"==typeof P)throw Error("Promises are not defined");var b=
this,a=b.listeners,c=b.returnResult,e=T.call(arguments),A=[],l=[],t,s,y;if(b.suspended||0==a.length)return P.resolve(null);s=0;for(y=a.length;s<y;s++)A.push(a[s]);for(s=function(a){t=b._prepareArgs(a,e);return new P(function(c,g){qa(function(){try{c(a.fn.apply(a.scope,t))}catch(e){g(e)}a.called++;a.called==a.limit&&b.un(a.id)},0)})};(a=A.shift())&&(!a||!b.map[a.id]||(a.count++,a.count<a.start||(l.push(s(a)),"first"!=c))););return"last"==c?[l.pop()]:l},trigger:function(){var b=this.listeners,a=this.returnResult;
if(this.suspended||0==b.length)return null;for(var c="all"==a?[]:null,e,s,b="first"==a?[b[0]]:T.call(b);e=b.shift();)if(e&&this.map[e.id]&&(e.count++,!(e.count<e.start))){s=e.fn.apply(e.scope,this._prepareArgs(e,arguments));e.called++;e.called==e.limit&&this.un(e.id);"all"==a&&c.push(s);if("first"==a)return s;"last"==a&&(c=s);if(!1==a&&!1===s)break}if(a)return c}};var e=new c;K(MetaphorJs,e.getApi(),!0,!1);MetaphorJs.lib.Observable=c})();var ra=MetaphorJs.lib.Observable,sa=MetaphorJs.trim=function(){return String.prototype.trim?
function(c){return"string"==typeof c?c.trim():c}:function(c){return"string"==typeof c?c.replace(/^\s\s*/,"").replace(/\s\s*$/,""):c}}(),fa=MetaphorJs.emptyFn=function(){},ta=function(c,a){var e,b;if(!c||"string"!==typeof c)return null;try{b=new DOMParser,e=b.parseFromString(c,a||"text/xml")}catch(g){e=void 0}if(!e||e.getElementsByTagName("parsererror").length)throw"Invalid XML: "+c;return e};(function(){var c=/#.*$/,a=/([?&])_=[^&]*/,e=/\?/,b=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,
g=/^(?:GET|HEAD)$/i,p=0,h=function(a,b,f){var d,c;if("string"==typeof a&&f)b.push(encodeURIComponent(f)+"="+encodeURIComponent(a));else if(V(a)&&f)for(d=0,c=a.length;d<c;d++)h(a[d],b,f+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&h(a[d],b,f?f+"["+d+"]":d)},s=function(b,d){b.replace(c,"");if(!1===d.cache){var f=(new Date).getTime();return a.test(b)?b.replace(a,"$1_="+f):b+(e.test(b)?"&":"?")+"_="+f}!d.data||window.FormData&&d.data instanceof window.FormData||("string"!=typeof d.data?
(f=[],h(d.data,f,null),f=f.join("&").replace(/%20/g,"+")):f=d.data,d.data=f,g.test(d.method)&&(b+=(e.test(b)?"&":"?")+d.data,d.data=null));return b},l={xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"},t={url:null,data:null,method:"GET",headers:null,username:null,password:null,cache:null,dataType:null,timeout:0,contentType:"application/x-www-form-urlencoded",xhrFields:null,jsonp:!1,
jsonpParam:null,jsonpCallback:null,transport:null,replace:!1,selector:null,form:null,beforeSend:null,progress:null,uploadProgress:null,processResponse:null,callbackScope:null},L={},x=new ra,J=function(a){var b;b=eval;a&&(/^[^\S]*use strict/.test(a)?(b=document.createElement("script"),b.text=a,document.head.appendChild(b).parentNode.removeChild(b)):b(a))},v=function(a,b,f){var d,c;if("object"!=typeof a&&"function"!=typeof a&&f)d=document.createElement("input"),d.setAttribute("type","hidden"),d.setAttribute("name",
f),d.setAttribute("value",a),b.appendChild(d);else if(V(a)&&f)for(d=0,c=a.length;d<c;d++)v(a[d],b,f+"["+d+"]");else if("object"==typeof a)for(d in a)a.hasOwnProperty(d)&&v(a[d],b,f?f+"["+d+"]":d)},M=function(a){for(var b,f,d="",c=0;c<a.elements.length;c++)if(b=a.elements[c],b.hasAttribute("name"))if(f="INPUT"===b.nodeName.toUpperCase()?b.getAttribute("type").toUpperCase():"TEXT","FILE"===f)for(f=0;f<b.files.length;d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.files[f++].name));else if("RADIO"!==
f&&"CHECKBOX"!==f||b.checked)d+="&"+encodeURIComponent(b.name)+"="+encodeURIComponent(b.value);return d},N=function(a,b,f){var d=b?b.dataType:null;b=b?b.selector:null;if("string"!=typeof a)return a;f=f||"";if("xml"===d||!d&&0<=f.indexOf("xml"))return a=ta(sa(a)),b?E(b,a):a;if("html"===d)return a=ta(a,"text/html"),b?E(b,a):a;if("fragment"==d){f=document.createDocumentFragment();d=document.createElement("div");for(d.innerHTML=a;d.firstChild;)f.appendChild(d.firstChild);return f}if("json"===d||!d&&0<=
f.indexOf("json"))return a=sa(a),a="undefined"!=typeof JSON?JSON.parse(a):(new Function("return "+a))(),a;("script"===d||!d&&0<=f.indexOf("javascript"))&&J(a);return a+""},B=function(a){var c=b.exec(("undefined"!=typeof window?window.location.href:"").toLowerCase())||[],f=b.exec(a.url.toLowerCase());this._opt=a;a.crossDomain=!(!f||f[1]===c[1]&&f[2]===c[2]&&(f[3]||("http:"===f[1]?"80":"443"))===(c[3]||("http:"===c[1]?"80":"443")));c=new P;"iframe"!=a.transport||a.form?a.form&&(this._form=a.form,"POST"!=
a.method||"undefined"!=typeof window&&window.FormData||"iframe"==a.transport||(a.transport="iframe")):(this.createForm(),a.form=this._form);a.form&&"iframe"!=a.transport&&(a.data="POST"==a.method?new FormData(a.form):M(a.form));a.url=s(a.url,a);f=!a.crossDomain&&"script"!=a.transport||a.form?"iframe"==a.transport?new k(a,c,this):new z(a,c,this):new d(a,c,this);this._deferred=c;this._transport=f;c.done(function(a){x.trigger("success",a)});c.fail(function(a){x.trigger("error",a)});c.always(function(){x.trigger("end")});
x.trigger("start");a.timeout&&(this._timeout=setTimeout(y(this.onTimeout,this),a.timeout));a.jsonp&&this.createJsonp();!1===x.trigger("beforeSend",a,f)&&(this._promise=P.reject());a.beforeSend&&!1===a.beforeSend.call(a.callbackScope,a,f)&&(this._promise=P.reject());this._promise||(qa(f.send,f),c.abort=y(this.abort,this),c.always(this.destroy,this),this._promise=c)};B.prototype={_jsonpName:null,_transport:null,_opt:null,_deferred:null,_promise:null,_timeout:null,_form:null,_removeForm:!1,promise:function(){return this._promise},
abort:function(a){this._transport.abort();this._deferred.reject(a||"abort")},onTimeout:function(){this.abort("timeout")},createForm:function(){var a=document.createElement("form");a.style.display="none";a.setAttribute("method",this._opt.method);v(this._opt.data,a,null);document.body.appendChild(a);this._form=a;this._removeForm=!0},createJsonp:function(){var a=this._opt,b=a.jsonpParam||"callback",d=a.jsonpCallback||"jsonp_"+ ++p;a.url+=(e.test(a.url)?"&":"?")+b+"="+d;this._jsonpName=d;"undefined"!=
typeof window&&(window[d]=y(this.jsonpCallback,this));"undefined"!=typeof global&&(global[d]=y(this.jsonpCallback,this));return d},jsonpCallback:function(a){try{this._deferred.resolve(this.processResponseData(a))}catch(b){this._deferred.reject(b)}},processResponseData:function(a,b){var d=this._opt;a=N(a,d,b);x.hasListener("processResponse")&&(a=x.trigger("processResponse",a,this._deferred));d.processResponse&&(a=d.processResponse.call(d.callbackScope,a,this._deferred));return a},processResponse:function(a,
b){var d=this._deferred;if(this._opt.jsonp)if(a){try{J(a)}catch(c){d.reject(c)}d.isPending()&&d.reject("jsonp script didn't invoke callback")}else d.reject("jsonp script is empty");else try{d.resolve(this.processResponseData(a,b))}catch(e){d.reject(e)}},destroy:function(){this._timeout&&clearTimeout(this._timeout);this._form&&this._form.parentNode&&this._removeForm&&this._form.parentNode.removeChild(this._form);this._transport.destroy();delete this._transport;delete this._opt;delete this._deferred;
delete this._promise;delete this._timeout;delete this._form;this._jsonpName&&("undefined"!=typeof window&&delete window[this._jsonpName],"undefined"!=typeof global&&delete global[this._jsonpName])}};var w=function(a,b){b=b||{};a&&"string"!=typeof a?b=a:b.url=a;if(!b.url&&(b.form&&(b.url=b.form.getAttribute("action")),!b.url))throw"Must provide url";K(b,L,!1,!0);K(b,t,!1,!0);b.method=b.method?b.method.toUpperCase():b.form?b.form.getAttribute("method").toUpperCase()||"GET":"GET";return(new B(b)).promise()};
w.setup=function(a){K(L,a,!0,!0)};w.on=function(){x.on.apply(x,arguments)};w.un=function(){x.un.apply(x,arguments)};w.get=function(a,b){b=b||{};b.method="GET";return w(a,b)};w.post=function(a,b){b=b||{};b.method="POST";return w(a,b)};w.load=function(a,b,d){d=d||{};"string"!=typeof b&&(d=b);d.dataType="fragment";return w(b,d).done(function(b){if(d.replace)for(;a.firstChild;)a.removeChild(a.firstChild);a.appendChild(b)})};w.loadScript=function(a){return w(a,{transport:"script"})};w.submit=function(a,
b){b=b||{};b.form=a;return w(null,b)};var z=function(a,b,d){var c;if(!(window.XMLHttpRequest&&(c=new XMLHttpRequest)||(c=new ActiveXObject("Msxml2.XMLHTTP"))||(c=new ActiveXObject("Microsoft.XMLHTTP"))))throw"Unable to create XHR object";this._xhr=c;this._deferred=b;this._opt=a;this._ajax=d;a.progress&&H(c,"progress",y(a.progress,a.callbackScope));a.uploadProgress&&c.upload&&H(c.upload,"progress",y(a.uploadProgress,a.callbackScope));try{var e;if(a.xhrFields)for(e in a.xhrFields)c[e]=a.xhrFields[e];
a.data&&a.contentType&&c.setRequestHeader("Content-Type",a.contentType);c.setRequestHeader("X-Requested-With","XMLHttpRequest");c.setRequestHeader("Accept",a.dataType&&l[a.dataType]?l[a.dataType]+", */*; q=0.01":l._default);for(e in a.headers)c.setRequestHeader(e,a.headers[e])}catch(g){}c.onreadystatechange=y(this.onReadyStateChange,this)};z.prototype={_xhr:null,_deferred:null,_ajax:null,onReadyStateChange:function(){var a=this._xhr,b=this._deferred;if(0===a.readyState)a.onreadystatechange=fa,b.resolve(a);
else if(4===a.readyState){a.onreadystatechange=fa;var d;a:{try{d=!a.status&&"undefined"!=typeof location&&"file:"==location.protocol||200<=a.status&&300>a.status||304===a.status||1223===a.status;break a}catch(c){}d=!1}d?this._ajax.processResponse("string"==typeof a.responseText?a.responseText:void 0,a.getResponseHeader("content-type")||""):b.reject(a)}},abort:function(){this._xhr.onreadystatechange=fa;this._xhr.abort()},send:function(){var a=this._opt;try{this._xhr.open(a.method,a.url,!0,a.username,
a.password),this._xhr.send(a.data)}catch(b){this._deferred.reject(b)}},destroy:function(){delete this._xhr;delete this._deferred;delete this._opt;delete this._ajax}};var d=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};d.prototype={_opt:null,_deferred:null,_ajax:null,_el:null,send:function(){var a=document.createElement("script");a.setAttribute("async","async");a.setAttribute("charset","utf-8");a.setAttribute("src",this._opt.url);H(a,"load",y(this.onLoad,this));H(a,"error",y(this.onError,
this));document.head.appendChild(a);this._el=a},onLoad:function(a){this._deferred&&this._deferred.resolve(a)},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};var k=function(a,b,d){this._opt=a;this._ajax=d;this._deferred=b};k.prototype={_opt:null,_deferred:null,_ajax:null,
_el:null,send:function(){var a=document.createElement("iframe"),b="frame-"+ ++p,d=this._opt.form;a.setAttribute("id",b);a.setAttribute("name",b);a.style.display="none";document.body.appendChild(a);d.setAttribute("action",this._opt.url);d.setAttribute("target",b);H(a,"load",y(this.onLoad,this));H(a,"error",y(this.onError,this));this._el=a;try{d.submit()}catch(c){this._deferred.reject(c)}},onLoad:function(){var a=this._el;this._opt&&!this._opt.jsonp&&(a=a.contentDocument||a.contentWindow.document,a=
a.body.innerHTML,this._ajax.processResponse(a))},onError:function(a){this._deferred.reject(a)},abort:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el)},destroy:function(){this._el.parentNode&&this._el.parentNode.removeChild(this._el);delete this._el;delete this._opt;delete this._ajax;delete this._deferred}};MetaphorJs.ajax=w})();var za=MetaphorJs.ajax;(function(){var c=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},a=function(a,b){var d=a.style,c;for(c in b)d[c]=
b[c]},e=function(a){var c;c=b();var d=g();if(a===window)d=document.documentElement,c={left:0,right:d.clientWidth,top:c,bottom:d.clientHeight+c,width:d.clientWidth,height:d.clientHeight};else if(a.getBoundingClientRect)a=a.getBoundingClientRect(),c={left:a.left+d,top:a.top+c,right:a.right+d,bottom:a.bottom+c},c.width=c.right-c.left,c.height=c.bottom-c.top;else{var e=a.style;c={left:(parseInt(e.left,10)||0)+d,top:(parseInt(e.top,10)||0)+c,width:a.offsetWidth,height:a.offsetHeight,right:0,bottom:0}}c.getCenter=
function(){return this.width/2};c.getCenterX=function(){return this.left+this.width/2};return c},b=function(){if("undefined"!=typeof window.pageYOffset)return window.pageYOffset;var a=document.body,b=document.documentElement;return(b.clientHeight?b:a).scrollTop},g=function(){if("undefined"!=typeof window.pageXOffset)return window.pageXOffset;var a=document.body,b=document.documentElement;return(b.clientWidth?b:a).scrollLeft},p={},h=function(a,b,d,c){var e=b+"-"+d,g=function(a){a=N(a);return ea(a.target,
b)?c(a):null};p[e]||(p[e]=[]);p[e].push({el:a,ls:g,fn:c});H(a,d,g)},y=function(a,b,d,c){var e,g;if(g=p[b+"-"+d])for(b=-1,e=g.length;++b<e;)g[b].el===a&&g[b].fn===c&&M(a,d,g[b].ls)},l={t:"b",r:"l",b:"t",l:"r"},t={t:"top",r:"right",b:"bottom",l:"left"},O={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},x=document.all&&!window.XMLHttpRequest,J=function(){var a={},b={};return{register:function(d){var c=d.getInstanceId(),e=d.getGroup(),g,f,h;a[c]=d;g=0;for(f=e.length;g<f;g++)h=e[g],b[h]||(b[h]={}),b[h][c]=
!0;d.on("destroy",this.unregister,this)},unregister:function(b){b=b.getInstanceId();delete a[b]},hideAll:function(d){var c=d.getInstanceId();d=d.getGroup();var e,g,f,h;e=0;for(g=d.length;e<g;e++)for(h in f=d[e],f=b[f],f)a[h]?h==c||a[h].isHideAllIgnored()||a[h].hide(null,!0,!0):delete f[h]}}}(),v=function(b,g,d){var k,h=this,n,f={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},p=g.size,q=g.width||2*p;K(h,{init:function(){g.border&&h.createInner()},
getEl:function(){return k},getDialogPositionOffset:function(){var a=(h.detectPointerPosition()||"").substr(0,1),d=(b.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1),c={x:0,y:0};a==l[d]&&(c["t"==a||"b"==a?"y":"x"]="b"==a||"r"==a?-p:p);return c},createInner:function(){var a=K({},g);a.size=p-2*g.border;a.width=q-4*g.border;delete a.border;delete a.borderColor;delete a.borderCls;delete a.offset;n=new v(b,a,g.border)},detectPointerPosition:function(){if(g.position)return g.position;var a=
(b.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return a?l[a]:null},detectPointerDirection:function(a){return g.direction?g.direction:a},getBorders:function(a,b,d){var f={},G=a.substr(0,1);a=b.substr(0,1);var g=b.substr(1);b=x?"dotted":"solid";f["border"+c(t[l[G]])]=p+"px solid "+d;f["border"+c(t[G])]="0 "+b+" transparent";g?(f["border"+c(t[g])]="0 solid transparent",f["border"+c(t[l[g]])]=q+"px "+b+" transparent"):(d=Math.floor(q/2),f["border"+c(t[O[a][0]])]=d+"px "+b+" transparent",
f["border"+c(t[O[a][1]])]=d+"px "+b+" transparent");return f},getOffsets:function(a,b){var f={},h=a.substr(0,1),G="t"==h||"b"==h?"r":"b";if(!p)switch(document.body.appendChild(k),h){case "t":case "b":p=e(k).height;q=e(k).width;break;case "l":case "r":q=e(k).height,p=e(k).width}f[t[h]]=d?"auto":-p+"px";f[t[G]]="auto";if(d){var h=b.substr(0,1),Y=b.substr(1);f[t[l[G]]]=Y?"l"==Y||"t"==Y?d+"px":-q-d+"px":Math.floor(-q/2)+"px";f[t[l[h]]]=-(p+2*d)+"px"}else{switch(a){case "t":case "r":case "b":case "l":h=
b!=a?"l"==b||"t"==b?g.offset:-q+g.offset:-q/2+g.offset;break;case "bl":case "tl":case "lt":case "rt":h=g.offset;break;default:h=-q-g.offset}f["margin"+c(t[l[G]])]=h+"px";switch(a){case "t":case "r":case "b":case "l":h="50%";break;case "tr":case "rb":case "br":case "lb":h="100%";break;default:h=0}f[t[l[G]]]=h}return f},render:function(){if(!k){var c=h.detectPointerPosition();if(c)if(g.el){if("string"==typeof g.el){var e=document.createElement("div");e.innerHTML=g.el;k=e.firstChild}else k=g.el;a(k,
{position:"absolute"});a(k,h.getOffsets(c));L(k,g.cls);b.getElem().appendChild(k)}else{e=h.detectPointerDirection(c);k=document.createElement("div");var m=document.createComment(" ");k.appendChild(m);a(k,f);a(k,h.getBorders(c,e,g.borderColor||g.color));a(k,h.getOffsets(c,e));L(k,g.borderCls||g.cls);n&&(n.render(),k.appendChild(n.getEl()));d||b.getElem().appendChild(k)}}},destroy:function(){h.remove();n=h=null},remove:function(){n&&n.remove();k&&(k.parentNode.removeChild(k),k=null)}},!0,!1);h.init();
return h},P=function(a){if(!a)return{};var b=function(b,c,g){var e=a[b],f=!1;if(void 0!==e){switch(g){case "string":f="string"==typeof e;break;case "function":f="function"==typeof e;break;case "number":f="number"==typeof e||e==parseInt(e);break;case "dom":f=e&&(e.tagName||e.nodeName)?!0:!1;break;case "jquery":(f=e&&e.jquery?!0:!1)&&(e=e.get(0));break;case "boolean":if(!0===e||!1===e)f=!0;break;default:!0===g&&!0===e&&(f=!0),!1===g&&!1===e&&(f=!0)}f&&(a[b]={},a[b][c]=e)}};b("content","value","string");
b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");b("show","events",!1);b("show","events","string");b("hide","events",!1);b("hide","events","string");b("toggle","events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position",
"string");b("pointer","size","number");return a},T={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,
process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,
animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},B=function(c,l){c&&"string"!=typeof c&&(l=c,c=null);l=l||{};var d=this,k={},p=aa(),n=new ra,f=K({},T,P(B.defaults),P(B[c]),P(l),!0,!0),t=f.callback.scope||k,q,x,u,m={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,
images:0,position:null,destroyDelay:null};l=null;K(k,n.getApi(),{getElem:function(){return q},getInstanceId:function(){return p},getCfg:function(){return K({},f)},getGroup:function(){return f.group?"string"==typeof f.group?[f.group]:f.group:[""]},setTarget:function(a){if(!a)return k;var b=!1,c=m.target;m.target?(d.setHandlers("unbind","_target"),b=!0):m.dynamicTarget&&(b=!0);"string"==typeof a?(m.dynamicTarget=!0,m.target=null):(m.dynamicTarget=!1,m.target=a);b&&(d.setHandlers("bind","_target"),d.trigger("targetchange",
k,a,c));return k},getTarget:function(){return m.dynamicTarget?m.dynamicTargetEl:f.target},isEnabled:function(){return m.enabled},isVisible:function(){return m.visible},isHideAllIgnored:function(){return f.show.ignoreHideAll},isFrozen:function(){return m.frozen},enable:function(){m.enabled=!0;return k},disable:function(){d.hide();m.enabled=!1;return k},freeze:function(){m.frozen=!0;return k},unfreeze:function(){m.frozen=!1;return k},toggle:function(a,b){return a&&a.stopPropagation&&m.dynamicTarget&&
m.visible&&d.isDynamicTargetChanged(a)?d.show(a):d[m.visible?"hide":"show"](a,b)},show:function(a,b){var c=a&&a.stopPropagation?null:k,e=f.show;if(!k.isEnabled())return f.debug&&console.log("show: not enabled",k.getTarget()),c;a&&a.stopPropagation&&f.events.show&&f.events.show[a.type]&&(c=f.events.show[a.type],c.process?c=c.process(k,a):(c.stopPropagation&&a.stopPropagation(),c.preventDefault&&a.preventDefault(),c=c.returnValue));if(m.visible&&m.hideTimeout)return window.clearTimeout(m.hideTimeout),
m.hideTimeout=window.setTimeout(d.hide,f.hide.timeout),f.debug&&console.log("show: hide timeout was set",k.getTarget()),c;if(m.hideDelay)return window.clearTimeout(m.hideDelay),m.hideDelay=null,m.visible=!0,f.debug&&console.log("show: hide delay was set; already shown",k.getTarget()),c;if(m.frozen)return f.debug&&console.log("show: frozen",k.getTarget()),c;m.destroyDelay&&(window.clearTimeout(m.destroyDelay),m.destroyDelay=null);var g=!1;a&&a.stopPropagation&&m.dynamicTarget&&(g=d.changeDynamicTarget(a));
if(m.visible)if(g)if(f.render.fn)d.hide(null,!0);else return d.reposition(a),c;else return f.debug&&console.log("show: already shown",q),c;q?g&&d.changeDynamicContent():d.render();if(!1===d.trigger("beforeshow",k,a))return f.debug&&console.log("show: beforeshow return false",k.getTarget()),c;pa(q);m.visible=!0;e.single&&J.hideAll(d);d.toggleTitleAttribute(!1);e.delay&&!b?m.showDelay=window.setTimeout(function(){d.showAfterDelay(a)},e.delay):d.showAfterDelay(a,b);return c},hide:function(a,b,c){m.hideTimeout=
null;var e=a&&a.stopPropagation?null:k;a&&a.stopPropagation&&f.events.hide&&f.events.hide[a.type]&&(e=f.events.hide[a.type],e.process?e=e.process(k,a):(e.stopPropagation&&a.stopPropagation(),e.preventDefault&&a.preventDefault(),e=e.returnValue));!m.visible&&m.hideDelay&&b&&(window.clearTimeout(m.hideDelay),m.hideDelay=null,m.visible=!0);if(!q||!m.visible||!d.isEnabled())return f.debug&&console.log("hide: elem/visible/enabled: ",q,m.visible,d.isEnabled()),e;if(m.showDelay)return f.hide.cancelShowDelay||
c?(window.clearTimeout(m.showDelay),m.showDelay=null,m.visible=!1,f.debug&&console.log("hide: cancelShowDelay: ",d.getTarget())):f.debug&&console.log("hide: show delay was set",d.getTarget()),e;if(m.frozen)return f.debug&&console.log("hide: frozen",d.getTarget()),e;if(!1===d.trigger("beforehide",k,a))return f.debug&&console.log("hide: beforehide returned false",d.getTarget()),e;pa(q);m.visible=!1;d.toggleTitleAttribute(!0);m.dynamicTarget&&d.resetDynamicTarget();f.hide.delay&&!b?m.hideDelay=window.setTimeout(function(){d.hideAfterDelay(a)},
f.hide.delay):d.hideAfterDelay(a,b);return e},setPositionType:function(a){a&&("function"==typeof a?(f.position.get=a,f.position.type=!1):(f.position.get=null,f.position.type=a));a=f.position.type;!1===a?m.position=!1:f.position.get&&"m"!=a?m.position="fn":(a=a.substr(0,1),m.position="w"==a?"window":"m"==a?"mouse":"target");x&&(x.remove(),q&&x.render())},getPosition:function(a){if(!q)return null;var b,c=f.position;switch(m.position){case !1:return null;case "target":b=d.getTargetPosition(a);break;
case "mouse":b=d.getMousePosition(a);break;case "window":b=d.getWindowPosition(a);break;case "fn":b=c.get.call(t,k,a)}if(!1!==c.screenX||!1!==c.screenY)b=d.correctScreenPosition(b,c.screenX,c.screenY);return b},reposition:function(b){b&&(b=N(b));if(b=d.getPosition(b))void 0!=b.x&&a(q,{left:b.x+"px"}),void 0!=b.y&&a(q,{top:b.y+"px"}),void 0==b.x&&void 0==b.y&&a(q,b)},getContentElem:function(){return q?f.selector.content?E(f.selector.content,q).shift()||q:q:null},setContent:function(a,b){b=b||"";if(!q)return f.content.value=
a,k;f.content.prepare&&(a=f.content.prepare(k,b,a));var c=k.getContentElem(),e=m.rendered&&!f.selector.content&&x,g=e&&x.getEl();if(e&&g)try{q.removeChild(g)}catch(h){}if("string"!=typeof a)for(var l in a){var p=f.selector[l];p&&(p=E(p,c).shift())&&(p.innerHTML=a[l])}else c.innerHTML=a;if(e&&g)try{q.appendChild(g)}catch(n){}c=E("img",c);m.images=c.length;l=-1;for(e=c.length;++l<e;H(c[l],"load",d.onImageLoad));d.trigger("contentchange",k,a,b);d.onContentChange();return k},readContent:function(){var a=
k.getTarget(),b;a&&(b=f.content.attr?a.getAttribute(f.content.attr):a.getAttribute("tooltip")||a.getAttribute("title")||a.getAttribute("alt"));b&&d.setContent(b,"attribute");return k},loadContent:function(a){L(q,f.cls.loading);a=K({},f.ajax,a,!0,!0);d.trigger("beforeajax",k,a);return za(a).done(d.onAjaxLoad)},destroy:function(){d.trigger("destroy",k);M(window,"resize",d.onWindowResize);M(window,"scroll",d.onWindowScroll);d.destroyElem();x&&(x.destroy(),x=null);d.setHandlers("unbind");n.destroy();
u=m=k=d=n=null},setFocus:function(){var a=f.show.focus,b;if(!0===a)if(a=E("input",q).concat(E("textarea",q)),0<a.length)a[0].focus();else{if(f.buttons)for(b in f.buttons){(b=E(f.buttons[b],q).shift())&&b.focus();break}}else(b=E(a,q).shift())&&b.focus()}},!0,!1);K(d,k,{init:function(){J.register(d);f.modal&&(f.overlay.enabled=!0);d.setPositionType();d.setTarget(f.target);if(f.pointer.size||f.pointer.el)x=new v(d,f.pointer);f.render.lazy||d.render();d.setHandlers("bind")},setHandlers:function(a,b){for(var c=
["show","hide","toggle"],e="bind"==a?H:M,g="bind"==a?h:y,l,p,n,r,s,w,t,v,x,z;l=c.shift();)if(p=f[l].events,!1!==p){if("string"==typeof p||V(p))m.dynamicTarget?(s={},s[p]=f.target,p={_html:s}):p={_target:p};for(n in p){if(b)if("_self"==b){if("_self"!=n&&"_overlay"!=n&&">"!=n.substr(0,1))continue}else if(n!=b)continue;if("_self"!=n&&"_overlay"!=n&&">"!=n.substr(0,1)||q){if(t=p[n]){switch(n){case "_target":v=[d.getTarget()];break;case "_self":v=[q];break;case "_window":v=[window];break;case "_document":v=
[document];break;case "_html":v=[document.documentElement];break;case "_overlay":v=[u];break;default:v=">"==n.substr(0,1)?E(n.substr(1),q):E(n)}if(v&&v.length)if("string"==typeof t&&(t=[t]),V(t))for(s=0,w=t.length;s<w;s++)for(x=-1,z=v.length;++x<z;e(v[x],t[s],k[l]));else for(r in t)for(x=-1,z=v.length;++x<z;g(v[x],t[r],r,k[l]));}}else m.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var a=m.dynamicTargetEl;a&&(d.setHandlers("unbind","_target"),d.trigger("targetchange",k,null,a))},isDynamicTargetChanged:function(a){var b=
f.target;a=a.target;for(var c=m.dynamicTargetEl;a&&!ea(a,b);)a=a.parentNode;return a?!c||c!==a:!1},changeDynamicTarget:function(a){var b=f.target;a=a.target;for(var c=m.dynamicTargetEl;a&&!ea(a,b);)a=a.parentNode;if(!a||c&&c===a)return!1;c&&d.setHandlers("unbind","_target");m.dynamicTargetEl=a;d.setHandlers("bind","_target");d.trigger("targetchange",k,a,c);return!0},showAfterDelay:function(a,b){m.showDelay=null;if(m.visible){f.position.manual||d.reposition(a);"mouse"==m.position&&H(document.documentElement,
"mousemove",d.onMouseMove);var c=f.position;(c.resize||c.screenX||c.screenY)&&H(window,"resize",d.onWindowResize);(c.scroll||c.screenX||c.screenY)&&H(window,"scroll",d.onWindowScroll);if(b||!1!==d.trigger("afterdelay",k,a)){u&&(f.overlay.animateShow?d.animate("show",null,!0):u.style.display="");if(f.show.preventScroll){var c=f.show.preventScroll,e,g;!0===c&&(c="body");c=E(c);e=-1;for(g=c.length;++e<g;H(c[e],"mousewheel",d.onPreventScroll)&&H(c[e],"touchmove",d.onPreventScroll));}f.show.animate&&!b?
d.animate("show").done(function(){d.showAfterAnimation(a)}):d.showAfterAnimation(a)}else m.visible=!1,f.debug&&console.log("showAfterDelay: afterdelay returned false",k.getTarget())}else f.debug&&console.log("showAfterDelay: already hidden",d.getTarget())},showAfterAnimation:function(a){m.visible?(U(q,f.cls.hidden),L(q,f.cls.visible),f.render.keepVisible||(q.style.display=""),f.hide.timeout&&(m.hideTimeout=window.setTimeout(d.hide,f.hide.timeout)),f.show.focus&&window.setTimeout(d.setFocus,20),d.trigger("show",
k,a)):f.debug&&console.log("showAfterAnimation: already hidden",d.getTarget())},hideAfterDelay:function(a,b){m.hideDelay=null;if(m.visible)f.debug&&console.log("hideAfterDelay: already shown again",d.getTarget());else{"mouse"==m.position&&M(document.documentElement,"mousemove",d.onMouseMove);var c=f.position;(c.resize||c.screenX||c.screenY)&&M(window,"resize",d.onWindowResize);(c.scroll||c.screenX||c.screenY)&&M(window,"scroll",d.onWindowScroll);if(b||!1!==d.trigger("afterhidedelay",k,a)){if(f.show.preventScroll){var c=
f.show.preventScroll,e,g;!0===c&&(c="body");c=E(c);e=-1;for(g=c.length;++e<g;M(c[e],"mousewheel",d.onPreventScroll)&&M(c[e],"touchmove",d.onPreventScroll));}u&&(f.overlay.animateShow?d.animate("hide",null,!0).done(function(){u.style.display="none"}):u.style.display="none");f.hide.animate&&!b?d.animate("hide").done(function(){d.hideAfterAnimation(a)}):d.hideAfterAnimation(a)}else m.visible=f.cls.hidden?!ba(q,f.cls.hidden):ha(q),f.debug&&console.log("hideAfterDelay: afterhdelay returned false",d.getTarget())}},
hideAfterAnimation:function(a){m.visible?f.debug&&console.log("hideAfterAnimation: already shown again",d.getTarget()):(U(q,f.cls.visible),L(q,f.cls.hidden),f.render.keepVisible||(q.style.display="none"),d.trigger("hide",k,a),a=f.render.lifetime,null!==a&&(0===a?d.destroyElem():m.destroyDelay=window.setTimeout(d.destroyElem,a)),q&&f.hide.destroy&&window.setTimeout(function(){s(q,f.instanceName,null);d.destroy()},0))},render:function(){if(q)f.debug&&console.log("element already rendered",q);else{var b=
f.render,c=f.cls;if(b.fn){var e=b.fn.call(t,k);b["string"==typeof e?"tpl":"el"]=e}b.el?"string"==typeof b.el?(q=E(b.el).shift(),b.keepInDOM=!0):q=b.el:(e=document.createElement("div"),e.innerHTML=b.tpl,q=e.firstChild);q||(q=document.createElement("div"));b.id&&q.setAttribute("id",b.id);f.render.keepVisible||(q.style.display="none");L(q,c.dialog);L(q,c.hidden);b.style&&a(q,b.style);f.overlay.enabled&&(u=document.createElement("div"),a(u,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,
opacity:f.overlay.opacity,backgroundColor:f.overlay.color}),document.body.appendChild(u),H(u,"click",d.onOverlayClick),b.zIndex&&a(u,{zIndex:b.zIndex}),f.overlay.cls&&L(u,f.overlay.cls));b.appendTo?b.appendTo.appendChild(q):!1!==b.appendTo&&document.body.appendChild(q);b.zIndex&&a(q,{zIndex:b.zIndex});b=f.content;if(!1!==b.value)if(b.value)d.setContent(b.value);else if(b.fn)d.setContent(b.fn.call(t,k));else d[f.ajax.url?"loadContent":"readContent"]();x&&x.render();if(f.buttons)for(var g in f.buttons)if(b=
E(f.buttons[g],q).shift())s(b,"metaphorjsTooltip-button-id",g),H(b,"click",d.onButtonClick),H(b,"keyup",d.onButtonKeyup);m.bindSelfOnRender&&(d.setHandlers("bind","_self"),m.bindSelfOnRender=!1);m.rendered=!0;d.trigger("render",k)}},animate:function(a,b,c){var e,g;e=c?"show"==a?f.overlay.animateShow:f.overlay.animateHide:f[a].animate;"function"==typeof e&&(e=e(d,b));g=e.skipDisplayChange||!1;"boolean"==typeof e?e=a:"string"==typeof e&&(e=[e]);return ya(q,e,function(){"show"!=a||g||(c?u.style.display=
"":q.style.display="")})},toggleTitleAttribute:function(a){var b=k.getTarget(),c;b&&(!1===a?(s(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(c=s(b,"tmp-title"))&&b.setAttribute("title",c))},changeDynamicContent:function(){f.content.fn?d.setContent(f.content.fn.call(t,k)):f.content.attr&&d.readContent()},getDialogSize:function(){var b=f.cls.hidden?ba(q,f.cls.hidden):!ha(q),c,d=q.style.left;b&&(a(q,{left:"-1000px"}),q.style.display="");c={width:e(q).width,height:e(q).height};b&&
(a(q,{left:d}),q.style.display="none");return c},getTargetSize:function(){var a=d.getTarget();return a?{width:e(a).width,height:e(a).height}:null},getTargetPosition:function(a,b){var c=d.getTarget();if(!c)return null;var g=d.getDialogSize(),c=e(c),h=d.getTargetSize(),k={};b=b||f.position.type;var l=b.substr(0,1),p=b.substr(1),m=f.position.offsetX,n=f.position.offsetY,q=x?x.getDialogPositionOffset():null;switch(l){case "t":k.y=c.top-g.height-n;break;case "r":k.x=c.left+h.width+m;break;case "b":k.y=
c.top+h.height+n;break;case "l":k.x=c.left-g.width-m}switch(p){case "t":k.y=c.top+n;break;case "r":k.x=c.left+h.width-g.width-m;break;case "b":k.y=c.top+h.height-g.height-n;break;case "l":k.x=c.left+m;break;case "rc":k.x=c.left+h.width+m;break;case "lc":k.x=c.left-g.width-m;break;case "":switch(l){case "t":case "b":k.x=c.left+h.width/2-g.width/2;break;case "r":case "l":k.y=c.top+h.height/2-g.height/2}}q&&(k.x+=q.x,k.y+=q.y);return k},getMousePosition:function(a){if(!a)return null;var b=d.getDialogSize(),
c={},e=f.position.type.substr(1),g=f.position.offsetX,h=f.position.offsetY,l=f.position.axis,m=x?x.getDialogPositionOffset():null;switch(e){case "":c=f.position.get.call(t,k,a);break;case "t":c.y=a.pageY-b.height-h;c.x=a.pageX-b.width/2;break;case "r":c.y=a.pageY-b.height/2;c.x=a.pageX+g;break;case "b":c.y=a.pageY+h;c.x=a.pageX-b.width/2;break;case "l":c.y=a.pageY-b.height/2;c.x=a.pageX-b.width-g;break;case "rt":c.y=a.pageY-b.height-h;c.x=a.pageX+g;break;case "rb":c.y=a.pageY+h;c.x=a.pageX+g;break;
case "lt":c.y=a.pageY-b.height-h;c.x=a.pageX-b.width-g;break;case "lb":c.y=a.pageY+h,c.x=a.pageX-b.width-g}m&&(c.x+=m.x,c.y+=m.y);l&&(a=d.getTargetPosition(a,e))&&("x"==l?c.y=a.y:c.x=a.x);return c},getWindowPosition:function(){var a=d.getDialogSize(),c={},h=f.position.type.substr(1),k=f.position.offsetX,l=f.position.offsetY,m=b(),n=g(),p=e(window).width,q=e(window).height;switch(h){case "c":c.y=q/2-a.height/2+m;c.x=p/2-a.width/2+n;break;case "t":c.y=m+l;c.x=p/2-a.width/2+n;break;case "r":c.y=q/2-
a.height/2+m;c.x=p-a.width+n-k;break;case "b":c.y=q-a.height+m-l;c.x=p/2-a.width/2+n;break;case "l":c.y=q/2-a.height/2+m;c.x=n+k;break;case "rt":c.y=m+l;c.x=p-a.width+n-k;break;case "rb":c.y=q-a.height+m-l;c.x=p-a.width+n-k;break;case "lt":c.y=m+l;c.x=n+k;break;case "lb":c.y=q-a.height+m-l,c.x=n+k}return c},correctScreenPosition:function(a,c,f){var h=d.getDialogSize(),k=b(),l=g(),m=e(window).width,n=e(window).height;f&&a.y+h.height>n+k-f&&(a.y=n+k-f-h.height);c&&a.x+h.width>m+l-c&&(a.x=m+l-c-h.width);
f&&a.y<k+f&&(a.y=k+f);c&&a.x<l+c&&(a.x=l+c);return a},onMouseMove:function(a){d.reposition(N(a))},onWindowResize:function(a){d.reposition(N(a))},onWindowScroll:function(a){d.reposition(N(a))},onPreventScroll:function(a){N(a).preventDefault()},onOverlayClick:function(a){return f.modal?(a=N(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=N(a).target;(b=s(b,"metaphorjsTooltip-button-id"))&&d.trigger("button",k,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==
a.keyCode){var b=s(a.target,"metaphorjsTooltip-button-id");b&&d.trigger("button",k,b,N(a))}},onAjaxLoad:function(a){U(q,f.cls.loading);d.setContent(a,"ajax")},onImageLoad:function(){m.images--;d.onContentChange()},onContentChange:function(){m.visible&&d.reposition()},destroyElem:function(){d.setHandlers("unbind","_self");m.bindSelfOnRender=!0;x&&x.remove();u&&(u.parentNode.removeChild(u),u=null);q&&(f.render.keepInDOM||q.parentNode.removeChild(q),q=null);d.trigger("lifetime",k)}},!0,!1);delete f.callback.scope;
for(var F in f.callback)k.on(F,f.callback[F],t);f.target&&f.useHref&&(F=f.target.getAttribute("href"),"#"==F.substr(0,1)?f.render.el=F:f.ajax.url=F);d.init();return k};K(B,{defaults:{}});MetaphorJs.lib.Dialog=B;window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(a,b,c){var e="dialog",g;"string"==typeof a&&"destroy"!=a&&(g=a,a=b,b=c);a=a||{};e+="-"+(b||"default");this.each(function(){var b=s(this,e);if(b)if("destroy"==a)b.destroy(),s(this,e,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");
else a.target=this,a.instanceName=e,s(this,e,new B(g,a))})})})()})();
