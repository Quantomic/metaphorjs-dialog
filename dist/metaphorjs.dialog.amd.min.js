define("metaphorjs-dialog",["metaphorjs-observable","metaphorjs-promise","metaphorjs-ajax","metaphorjs-select","metaphorjs-animate"],function(Y,da,Z,p,T){var U=T.stop,$=Array.prototype.slice,aa=Object.prototype.toString,K=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var l=a[aa.call(b)];return void 0===
l?-1:1==l&&isNaN(b)?8:l}}(),M=function(a){return"object"==typeof a&&3===K(a)&&!a.nodeType},N=function(a){return!0===a||!1===a},F=function(){return function b(){var l=!1,f=!1,m=$.call(arguments),n=m.shift(),p,q,r;N(m[m.length-1])&&(l=m.pop());N(m[m.length-1])&&(f=l,l=m.pop());for(;m.length;)if(p=m.shift())for(q in p)if(p.hasOwnProperty(q)&&void 0!==(r=p[q]))if(f)if(n[q]&&M(n[q])&&M(r))b(n[q],r,l,f);else{if(!0===l||void 0==n[q])M(r)?(n[q]={},b(n[q],r,l,!0)):n[q]=r}else if(!0===l||void 0==n[q])n[q]=
r;return n}}(),V=function(){var a=["0","0","0"];return function(){for(var b=a.length,l;b;){b--;l=a[b].charCodeAt(0);if(57==l)return a[b]="A",a.join("");if(90==l)a[b]="0";else return a[b]=String.fromCharCode(l+1),a.join("")}a.unshift("0");return a.join("")}}(),W=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),O=function(a,b){return b?W("(?:^|\\s)"+b+"(?!\\S)").test(a.className):!1},G=function(a,b){b&&!O(a,b)&&(a.className+=" "+b)},P=function(a,b){b&&(a.className=a.className.replace(W("(?:^|\\s)"+
b+"(?!\\S)"),""))},B=function(){var a={};return function(b,l,f){b=b._mjsid||(b._mjsid=V());var m=a[b];return void 0!==f?(m||(m=a[b]={}),m[l]=f):m?m[l]:void 0}}(),A=function(a,b,l){a.attachEvent?a.attachEvent("on"+b,l):a.addEventListener(b,l,!1)},C=function(a,b,l){a.detachEvent?a.detachEvent("on"+b,l):a.removeEventListener(b,l,!1)},J=function(){return!1},D=function(){return!0},H=function(a){if(a instanceof H)return a;if(!(this instanceof H))return new H(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(l){}this.originalEvent=
a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var f,m=a.button;void 0===this.pageX&&null!==a.clientX&&(f=this.target?this.target.ownerDocument||document:document,b=f.documentElement,f=f.body,this.pageX=a.clientX+(b&&b.scrollLeft||f&&f.scrollLeft||0)-(b&&b.clientLeft||f&&f.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||f&&f.scrollTop||0)-(b&&b.clientTop||f&&f.clientTop||0));this.which||void 0===m||(this.which=m&1?1:m&2?3:m&4?2:0);this.isDefaultPrevented=a.defaultPrevented||
void 0===a.defaultPrevented&&!1===a.returnValue?D:J;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};H.prototype={isDefaultPrevented:J,isPropagationStopped:J,isImmediatePropagationStopped:J,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=D;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=D;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;
this.isImmediatePropagationStopped=D;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};var E=function(a){return new H(a)},Q=p.is,z=function(a){return"string"==typeof a||0===K(a)},u=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},R=function(){if(void 0!==window.pageYOffset)return function(){return window.pageYOffset};var a=document.body,b=document.documentElement;return b.clientHeight?function(){return b.scrollTop}:function(){return a.scrollTop}}(),S=
function(){if(void 0!==window.pageXOffset)return function(){return window.pageXOffset};var a=document.body,b=document.documentElement;return b.clientWidth?function(){return b.scrollLeft}:function(){return a.scrollLeft}}(),r=function(a){var b;b=R();var l=S();a===window?(l=document.documentElement,b={left:0,right:l.clientWidth,top:b,bottom:l.clientHeight+b,width:l.clientWidth,height:l.clientHeight}):a.getBoundingClientRect?(a=a.getBoundingClientRect(),b={left:a.left+l,top:a.top+b,right:a.right+l,bottom:a.bottom+
b},b.width=b.right-b.left,b.height=b.bottom-b.top):b={left:a.offsetLeft+l,top:a.offsetTop+b,width:a.offsetWidth,height:a.offsetHeight,right:0,bottom:0};b.getCenter=function(){return this.width/2};b.getCenterX=function(){return this.left+this.width/2};return b},L={},ba=function(a,b,l,f){var m=b+"-"+l,n=function(a){a=E(a);return Q(a.target,b)?f(a):null};L[m]||(L[m]=[]);L[m].push({el:a,ls:n,fn:f});A(a,l,n)},ca=function(a,b,l,f){var m,n;if(n=L[b+"-"+l])for(b=-1,m=n.length;++b<m;)n[b].el===a&&n[b].fn===
f&&C(a,l,n[b].ls)},X=function(){var a=function(a,b){var e=a.style,h;for(h in b)e[h]=b[h]},b={t:"b",r:"l",b:"t",l:"r"},l={t:"top",r:"right",b:"bottom",l:"left"},f={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},m=document.all&&!window.XMLHttpRequest,n=function(){var a={},b={};return{register:function(e){var h=e.getInstanceId(),l=e.getGroup(),y,d,f;a[h]=e;y=0;for(d=l.length;y<d;y++)f=l[y],b[f]||(b[f]={}),b[f][h]=!0;e.on("destroy",this.unregister,this)},unregister:function(e){e=e.getInstanceId();delete a[e]},
hideAll:function(e){var h=e.getInstanceId();e=e.getGroup();var l,f,d,m;l=0;for(f=e.length;l<f;l++)for(m in d=e[l],d=b[d],d)a[m]?m==h||a[m].isHideAllIgnored()||a[m].hide(null,!0,!0):delete d[m]}}}(),H=function(n,s,e){var h,p=this,y,d={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},v=s.size,k=s.width||2*v;F(p,{init:function(){s.border&&p.createInner()},getEl:function(){return h},getDialogPositionOffset:function(){var d=(p.detectPointerPosition()||
"").substr(0,1),e=(n.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1),a={x:0,y:0};d==b[e]&&(a["t"==d||"b"==d?"y":"x"]="b"==d||"r"==d?-v:v);return a},createInner:function(){var d=F({},s);d.size=v-2*s.border;d.width=k-4*s.border;delete d.border;delete d.borderColor;delete d.borderCls;delete d.offset;y=new H(n,d,s.border)},detectPointerPosition:function(){if(s.position)return s.position;var d=(n.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return d?b[d]:null},detectPointerDirection:function(d){return s.direction?
s.direction:d},getBorders:function(d,e,a){var h={},c=d.substr(0,1);d=e.substr(0,1);var I=e.substr(1);e=m?"dotted":"solid";h["border"+u(l[b[c]])]=v+"px solid "+a;h["border"+u(l[c])]="0 "+e+" transparent";I?(h["border"+u(l[I])]="0 solid transparent",h["border"+u(l[b[I]])]=k+"px "+e+" transparent"):(a=Math.floor(k/2),h["border"+u(l[f[d][0]])]=a+"px "+e+" transparent",h["border"+u(l[f[d][1]])]=a+"px "+e+" transparent");return h},getOffsets:function(d,a){var g={},f=d.substr(0,1),c="t"==f||"b"==f?"r":"b";
if(!v)switch(document.body.appendChild(h),f){case "t":case "b":v=r(h).height;k=r(h).width;break;case "l":case "r":k=r(h).height,v=r(h).width}g[l[f]]=e?"auto":-v+"px";g[l[c]]="auto";if(e){var f=a.substr(0,1),I=a.substr(1);g[l[b[c]]]=I?"l"==I||"t"==I?e+"px":-k-e+"px":Math.floor(-k/2)+"px";g[l[b[f]]]=-(v+2*e)+"px"}else{switch(d){case "t":case "r":case "b":case "l":f=a!=d?"l"==a||"t"==a?s.offset:-k+s.offset:-k/2+s.offset;break;case "bl":case "tl":case "lt":case "rt":f=s.offset;break;default:f=-k-s.offset}g["margin"+
u(l[b[c]])]=f+"px";switch(d){case "t":case "r":case "b":case "l":f="50%";break;case "tr":case "rb":case "br":case "lb":f="100%";break;default:f=0}g[l[b[c]]]=f}return g},render:function(){if(!h){var b=p.detectPointerPosition();if(b)if(s.el){if(z(s.el)){var k=document.createElement("div");k.innerHTML=s.el;h=k.firstChild}else h=s.el;a(h,{position:"absolute"});a(h,p.getOffsets(b));G(h,s.cls);n.getElem().appendChild(h)}else{k=p.detectPointerDirection(b);h=document.createElement("div");var g=document.createComment(" ");
h.appendChild(g);a(h,d);a(h,p.getBorders(b,k,s.borderColor||s.color));a(h,p.getOffsets(b,k));G(h,s.borderCls||s.cls);y&&(y.render(),h.appendChild(y.getEl()));e||n.getElem().appendChild(h)}}},destroy:function(){p.remove();y=p=null},remove:function(){y&&y.remove();h&&(h.parentNode.removeChild(h),h=null)}},!0,!1);p.init();return p},q=function(a){if(!a)return{};var b=function(e,b,l){var f=a[e],d=!1;if(void 0!==f){switch(l){case "string":d=z(f);break;case "function":d="function"==typeof f;break;case "number":d=
1===K(f)||f==parseInt(f);break;case "dom":d=f&&(f.tagName||f.nodeName)?!0:!1;break;case "jquery":(d=f&&f.jquery?!0:!1)&&(f=f.get(0));break;case "boolean":if(!0===f||!1===f)d=!0;break;default:!0===l&&!0===f&&(d=!0),!1===l&&!1===f&&(d=!0)}d&&(a[e]={},a[e][b]=f)}};b("content","value","string");b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");
b("show","events",!1);b("show","events","string");b("hide","events",!1);b("hide","events","string");b("toggle","events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position","string");b("pointer","size","number");return a},J={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},
cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},
position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},D=function(b,f){b&&!z(b)&&
(f=b,b=null);f=f||{};var e=this,h={},l=V(),m=new Y,d=F({},J,q(D.defaults),q(D[b]),q(f),!0,!0),v=d.callback.scope||h,k,t,w,g={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};f=null;F(h,m.getApi(),{getElem:function(){return k},getInstanceId:function(){return l},getCfg:function(){return F({},d)},getGroup:function(){return d.group?z(d.group)?[d.group]:
d.group:[""]},setTarget:function(c){if(!c)return h;var d=!1,a=g.target;g.target?(e.setHandlers("unbind","_target"),d=!0):g.dynamicTarget&&(d=!0);z(c)?(g.dynamicTarget=!0,g.target=null):(g.dynamicTarget=!1,g.target=c);d&&(e.setHandlers("bind","_target"),e.trigger("targetchange",h,c,a));return h},getTarget:function(){return g.dynamicTarget?g.dynamicTargetEl:d.target},isEnabled:function(){return g.enabled},isVisible:function(){return g.visible},isHideAllIgnored:function(){return d.show.ignoreHideAll},
isFrozen:function(){return g.frozen},enable:function(){g.enabled=!0;return h},disable:function(){e.hide();g.enabled=!1;return h},freeze:function(){g.frozen=!0;return h},unfreeze:function(){g.frozen=!1;return h},toggle:function(c,d){return c&&c.stopPropagation&&g.dynamicTarget&&g.visible&&e.isDynamicTargetChanged(c)?e.show(c):e[g.visible?"hide":"show"](c,d)},show:function(c,a){var b=c&&c.stopPropagation?null:h,f=d.show;if(!h.isEnabled())return d.debug&&console.log("show: not enabled",h.getTarget()),
b;c&&c.stopPropagation&&d.events.show&&d.events.show[c.type]&&(b=d.events.show[c.type],b.process?b=b.process(h,c):(b.stopPropagation&&c.stopPropagation(),b.preventDefault&&c.preventDefault(),b=b.returnValue));if(g.visible&&g.hideTimeout)return window.clearTimeout(g.hideTimeout),g.hideTimeout=window.setTimeout(e.hide,d.hide.timeout),d.debug&&console.log("show: hide timeout was set",h.getTarget()),b;if(g.hideDelay)return window.clearTimeout(g.hideDelay),g.hideDelay=null,g.visible=!0,d.debug&&console.log("show: hide delay was set; already shown",
h.getTarget()),b;if(g.frozen)return d.debug&&console.log("show: frozen",h.getTarget()),b;g.destroyDelay&&(window.clearTimeout(g.destroyDelay),g.destroyDelay=null);var l=!1;c&&c.stopPropagation&&g.dynamicTarget&&(l=e.changeDynamicTarget(c));if(g.visible)if(l)if(d.render.fn)e.hide(null,!0);else return e.reposition(c),b;else return d.debug&&console.log("show: already shown",k),b;k?l&&e.changeDynamicContent():e.render();if(!1===e.trigger("beforeshow",h,c))return d.debug&&console.log("show: beforeshow return false",
h.getTarget()),b;U(k);g.visible=!0;f.single&&n.hideAll(e);e.toggleTitleAttribute(!1);f.delay&&!a?g.showDelay=window.setTimeout(function(){e.showAfterDelay(c)},f.delay):e.showAfterDelay(c,a);return b},hide:function(c,a,b){g.hideTimeout=null;var f=c&&c.stopPropagation?null:h;c&&c.stopPropagation&&d.events.hide&&d.events.hide[c.type]&&(f=d.events.hide[c.type],f.process?f=f.process(h,c):(f.stopPropagation&&c.stopPropagation(),f.preventDefault&&c.preventDefault(),f=f.returnValue));!g.visible&&g.hideDelay&&
a&&(window.clearTimeout(g.hideDelay),g.hideDelay=null,g.visible=!0);if(!k||!g.visible||!e.isEnabled())return d.debug&&console.log("hide: elem/visible/enabled: ",k,g.visible,e.isEnabled()),f;if(g.showDelay)return d.hide.cancelShowDelay||b?(window.clearTimeout(g.showDelay),g.showDelay=null,g.visible=!1,d.debug&&console.log("hide: cancelShowDelay: ",e.getTarget())):d.debug&&console.log("hide: show delay was set",e.getTarget()),f;if(g.frozen)return d.debug&&console.log("hide: frozen",e.getTarget()),f;
if(!1===e.trigger("beforehide",h,c))return d.debug&&console.log("hide: beforehide returned false",e.getTarget()),f;U(k);g.visible=!1;e.toggleTitleAttribute(!0);g.dynamicTarget&&e.resetDynamicTarget();d.hide.delay&&!a?g.hideDelay=window.setTimeout(function(){e.hideAfterDelay(c)},d.hide.delay):e.hideAfterDelay(c,a);return f},setPositionType:function(c){c&&(z(c)?(d.position.get=c,d.position.type=!1):(d.position.get=null,d.position.type=c));c=d.position.type;!1===c?g.position=!1:d.position.get&&"m"!=
c?g.position="fn":(c=c.substr(0,1),g.position="w"==c?"window":"m"==c?"mouse":"target");t&&(t.remove(),k&&t.render())},getPosition:function(c){if(!k)return null;var a,b=d.position;switch(g.position){case !1:return null;case "target":a=e.getTargetPosition(c);break;case "mouse":a=e.getMousePosition(c);break;case "window":a=e.getWindowPosition(c);break;case "fn":a=b.get.call(v,h,c)}if(!1!==b.screenX||!1!==b.screenY)a=e.correctScreenPosition(a,b.screenX,b.screenY);return a},reposition:function(c){c&&(c=
E(c));if(c=e.getPosition(c))void 0!=c.x&&a(k,{left:c.x+"px"}),void 0!=c.y&&a(k,{top:c.y+"px"}),void 0==c.x&&void 0==c.y&&a(k,c)},getContentElem:function(){return k?d.selector.content?p(d.selector.content,k).shift()||k:k:null},setContent:function(c,a){a=a||"";if(!k)return d.content.value=c,h;d.content.prepare&&(c=d.content.prepare(h,a,c));var b=h.getContentElem(),f=g.rendered&&!d.selector.content&&t,l=f&&t.getEl();if(f&&l)try{k.removeChild(l)}catch(ea){}if(z(c))b.innerHTML=c;else for(var m in c){var x=
d.selector[m];x&&(x=p(x,b).shift())&&(x.innerHTML=c[m])}if(f&&l)try{k.appendChild(l)}catch(n){}b=p("img",b);g.images=b.length;m=-1;for(f=b.length;++m<f;A(b[m],"load",e.onImageLoad));e.trigger("contentchange",h,c,a);e.onContentChange();return h},readContent:function(){var c=h.getTarget(),a;c&&(a=d.content.attr?c.getAttribute(d.content.attr):c.getAttribute("tooltip")||c.getAttribute("title")||c.getAttribute("alt"));a&&e.setContent(a,"attribute");return h},loadContent:function(c){G(k,d.cls.loading);
c=F({},d.ajax,c,!0,!0);e.trigger("beforeajax",h,c);return Z(c).done(e.onAjaxLoad)},destroy:function(){e.trigger("destroy",h);C(window,"resize",e.onWindowResize);C(window,"scroll",e.onWindowScroll);e.destroyElem();t&&(t.destroy(),t=null);e.setHandlers("unbind");m.destroy();w=g=h=e=m=null},setFocus:function(){var c=d.show.focus,a;if(!0===c)if(c=p("input",k).concat(p("textarea",k)),0<c.length)c[0].focus();else{if(d.buttons)for(a in d.buttons){(a=p(d.buttons[a],k).shift())&&a.focus();break}}else(a=p(c,
k).shift())&&a.focus()}},!0,!1);F(e,h,{init:function(){n.register(e);d.modal&&(d.overlay.enabled=!0);e.setPositionType();e.setTarget(d.target);if(d.pointer.size||d.pointer.el)t=new H(e,d.pointer);d.render.lazy||e.render();e.setHandlers("bind")},setHandlers:function(c,a){for(var b=["show","hide","toggle"],f="bind"==c?A:C,l="bind"==c?ba:ca,m,n,x,s,r,v,t,q,u,y;m=b.shift();)if(n=d[m].events,!1!==n){if(z(n)||"object"==typeof n&&5===K(n))g.dynamicTarget?(r={},r[n]=d.target,n={_html:r}):n={_target:n};for(x in n){if(a)if("_self"==
a){if("_self"!=x&&"_overlay"!=x&&">"!=x.substr(0,1))continue}else if(x!=a)continue;if("_self"!=x&&"_overlay"!=x&&">"!=x.substr(0,1)||k){if(t=n[x]){switch(x){case "_target":q=[e.getTarget()];break;case "_self":q=[k];break;case "_window":q=[window];break;case "_document":q=[document];break;case "_html":q=[document.documentElement];break;case "_overlay":q=[w];break;default:q=">"==x.substr(0,1)?p(x.substr(1),k):p(x)}if(q&&q.length)if(z(t)&&(t=[t]),"object"==typeof t&&5===K(t))for(r=0,v=t.length;r<v;r++)for(u=
-1,y=q.length;++u<y;f(q[u],t[r],h[m]));else for(s in t)for(u=-1,y=q.length;++u<y;l(q[u],t[s],s,h[m]));}}else g.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var c=g.dynamicTargetEl;c&&(e.setHandlers("unbind","_target"),e.trigger("targetchange",h,null,c))},isDynamicTargetChanged:function(c){var a=d.target;c=c.target;for(var b=g.dynamicTargetEl;c&&!Q(c,a);)c=c.parentNode;return c?!b||b!==c:!1},changeDynamicTarget:function(c){var a=d.target;c=c.target;for(var b=g.dynamicTargetEl;c&&!Q(c,a);)c=
c.parentNode;if(!c||b&&b===c)return!1;b&&e.setHandlers("unbind","_target");g.dynamicTargetEl=c;e.setHandlers("bind","_target");e.trigger("targetchange",h,c,b);return!0},showAfterDelay:function(c,a){g.showDelay=null;if(g.visible){d.position.manual||e.reposition(c);"mouse"==g.position&&A(document.documentElement,"mousemove",e.onMouseMove);var b=d.position;(b.resize||b.screenX||b.screenY)&&A(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&A(window,"scroll",e.onWindowScroll);if(a||
!1!==e.trigger("afterdelay",h,c)){w&&(d.overlay.animateShow?e.animate("show",null,!0):w.style.display="");if(d.show.preventScroll){var b=d.show.preventScroll,f,k;!0===b&&(b="body");b=p(b);f=-1;for(k=b.length;++f<k;A(b[f],"mousewheel",e.onPreventScroll)&&A(b[f],"touchmove",e.onPreventScroll));}d.show.animate&&!a?e.animate("show").done(function(){e.showAfterAnimation(c)}):e.showAfterAnimation(c)}else g.visible=!1,d.debug&&console.log("showAfterDelay: afterdelay returned false",h.getTarget())}else d.debug&&
console.log("showAfterDelay: already hidden",e.getTarget())},showAfterAnimation:function(c){g.visible?(P(k,d.cls.hidden),G(k,d.cls.visible),d.render.keepVisible||(k.style.display=""),d.hide.timeout&&(g.hideTimeout=window.setTimeout(e.hide,d.hide.timeout)),d.show.focus&&window.setTimeout(e.setFocus,20),e.trigger("show",h,c)):d.debug&&console.log("showAfterAnimation: already hidden",e.getTarget())},hideAfterDelay:function(c,a){g.hideDelay=null;if(g.visible)d.debug&&console.log("hideAfterDelay: already shown again",
e.getTarget());else{"mouse"==g.position&&C(document.documentElement,"mousemove",e.onMouseMove);var b=d.position;(b.resize||b.screenX||b.screenY)&&C(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&C(window,"scroll",e.onWindowScroll);if(a||!1!==e.trigger("afterhidedelay",h,c)){if(d.show.preventScroll){var b=d.show.preventScroll,f,l;!0===b&&(b="body");b=p(b);f=-1;for(l=b.length;++f<l;C(b[f],"mousewheel",e.onPreventScroll)&&C(b[f],"touchmove",e.onPreventScroll));}w&&(d.overlay.animateShow?
e.animate("hide",null,!0).done(function(){w.style.display="none"}):w.style.display="none");d.hide.animate&&!a?e.animate("hide").done(function(){e.hideAfterAnimation(c)}):e.hideAfterAnimation(c)}else g.visible=d.cls.hidden?!O(k,d.cls.hidden):!(0>=k.offsetWidth||0>=k.offsetHeight),d.debug&&console.log("hideAfterDelay: afterhdelay returned false",e.getTarget())}},hideAfterAnimation:function(c){g.visible?d.debug&&console.log("hideAfterAnimation: already shown again",e.getTarget()):(P(k,d.cls.visible),
G(k,d.cls.hidden),d.render.keepVisible||(k.style.display="none"),e.trigger("hide",h,c),c=d.render.lifetime,null!==c&&(0===c?e.destroyElem():g.destroyDelay=window.setTimeout(e.destroyElem,c)),k&&d.hide.destroy&&window.setTimeout(function(){B(k,d.instanceName,null);e.destroy()},0))},render:function(){if(k)d.debug&&console.log("element already rendered",k);else{var c=d.render,b=d.cls;if(c.fn){var f=c.fn.call(v,h);c[z(f)?"tpl":"el"]=f}c.el?z(c.el)?(k=p(c.el).shift(),c.keepInDOM=!0):k=c.el:(f=document.createElement("div"),
f.innerHTML=c.tpl,k=f.firstChild);k||(k=document.createElement("div"));c.id&&k.setAttribute("id",c.id);d.render.keepVisible||(k.style.display="none");G(k,b.dialog);G(k,b.hidden);c.style&&a(k,c.style);d.overlay.enabled&&(w=document.createElement("div"),a(w,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:d.overlay.opacity,backgroundColor:d.overlay.color}),document.body.appendChild(w),A(w,"click",e.onOverlayClick),c.zIndex&&a(w,{zIndex:c.zIndex}),d.overlay.cls&&G(w,d.overlay.cls));
c.appendTo?c.appendTo.appendChild(k):!1!==c.appendTo&&document.body.appendChild(k);c.zIndex&&a(k,{zIndex:c.zIndex});c=d.content;if(!1!==c.value)if(c.value)e.setContent(c.value);else if(c.fn)e.setContent(c.fn.call(v,h));else e[d.ajax.url?"loadContent":"readContent"]();t&&t.render();if(d.buttons)for(var l in d.buttons)if(c=p(d.buttons[l],k).shift())B(c,"metaphorjsTooltip-button-id",l),A(c,"click",e.onButtonClick),A(c,"keyup",e.onButtonKeyup);g.bindSelfOnRender&&(e.setHandlers("bind","_self"),g.bindSelfOnRender=
!1);g.rendered=!0;e.trigger("render",h)}},animate:function(c,b,a){var f,h;f=a?"show"==c?d.overlay.animateShow:d.overlay.animateHide:d[c].animate;"function"==typeof f&&(f=f(e,b));h=f.skipDisplayChange||!1;N(f)?f=c:z(f)&&(f=[f]);return T(k,f,function(){"show"!=c||h||(a?w.style.display="":k.style.display="")})},toggleTitleAttribute:function(c){var b=h.getTarget(),a;b&&(!1===c?(B(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(a=B(b,"tmp-title"))&&b.setAttribute("title",a))},changeDynamicContent:function(){d.content.fn?
e.setContent(d.content.fn.call(v,h)):d.content.attr&&e.readContent()},getDialogSize:function(){var c=d.cls.hidden?O(k,d.cls.hidden):!!(0>=k.offsetWidth||0>=k.offsetHeight),b,e=k.style.left;c&&(a(k,{left:"-1000px"}),k.style.display="");b={width:r(k).width,height:r(k).height};c&&(a(k,{left:e}),k.style.display="none");return b},getTargetSize:function(){var c=e.getTarget();return c?{width:r(c).width,height:r(c).height}:null},getTargetPosition:function(c,b){var a=e.getTarget();if(!a)return null;var f=
e.getDialogSize(),a=r(a),h=e.getTargetSize(),g={};b=b||d.position.type;var k=b.substr(0,1),l=b.substr(1),m=d.position.offsetX,n=d.position.offsetY,p=t?t.getDialogPositionOffset():null;switch(k){case "t":g.y=a.top-f.height-n;break;case "r":g.x=a.left+h.width+m;break;case "b":g.y=a.top+h.height+n;break;case "l":g.x=a.left-f.width-m}switch(l){case "t":g.y=a.top+n;break;case "r":g.x=a.left+h.width-f.width-m;break;case "b":g.y=a.top+h.height-f.height-n;break;case "l":g.x=a.left+m;break;case "rc":g.x=a.left+
h.width+m;break;case "lc":g.x=a.left-f.width-m;break;case "":switch(k){case "t":case "b":g.x=a.left+h.width/2-f.width/2;break;case "r":case "l":g.y=a.top+h.height/2-f.height/2}}p&&(g.x+=p.x,g.y+=p.y);return g},getMousePosition:function(c){if(!c)return null;var b=e.getDialogSize(),a={},f=d.position.type.substr(1),g=d.position.offsetX,k=d.position.offsetY,l=d.position.axis,m=t?t.getDialogPositionOffset():null;switch(f){case "":a=d.position.get.call(v,h,c);break;case "t":a.y=c.pageY-b.height-k;a.x=c.pageX-
b.width/2;break;case "r":a.y=c.pageY-b.height/2;a.x=c.pageX+g;break;case "b":a.y=c.pageY+k;a.x=c.pageX-b.width/2;break;case "l":a.y=c.pageY-b.height/2;a.x=c.pageX-b.width-g;break;case "rt":a.y=c.pageY-b.height-k;a.x=c.pageX+g;break;case "rb":a.y=c.pageY+k;a.x=c.pageX+g;break;case "lt":a.y=c.pageY-b.height-k;a.x=c.pageX-b.width-g;break;case "lb":a.y=c.pageY+k,a.x=c.pageX-b.width-g}m&&(a.x+=m.x,a.y+=m.y);l&&(c=e.getTargetPosition(c,f))&&("x"==l?a.y=c.y:a.x=c.x);return a},getWindowPosition:function(){var c=
e.getDialogSize(),a={},b=d.position.type.substr(1),f=d.position.offsetX,g=d.position.offsetY,h=R(),k=S(),l=r(window).width,m=r(window).height;switch(b){case "c":a.y=m/2-c.height/2+h;a.x=l/2-c.width/2+k;break;case "t":a.y=h+g;a.x=l/2-c.width/2+k;break;case "r":a.y=m/2-c.height/2+h;a.x=l-c.width+k-f;break;case "b":a.y=m-c.height+h-g;a.x=l/2-c.width/2+k;break;case "l":a.y=m/2-c.height/2+h;a.x=k+f;break;case "rt":a.y=h+g;a.x=l-c.width+k-f;break;case "rb":a.y=m-c.height+h-g;a.x=l-c.width+k-f;break;case "lt":a.y=
h+g;a.x=k+f;break;case "lb":a.y=m-c.height+h-g,a.x=k+f}return a},correctScreenPosition:function(a,b,d){var f=e.getDialogSize(),g=R(),h=S(),k=r(window).width,l=r(window).height;d&&a.y+f.height>l+g-d&&(a.y=l+g-d-f.height);b&&a.x+f.width>k+h-b&&(a.x=k+h-b-f.width);d&&a.y<g+d&&(a.y=g+d);b&&a.x<h+b&&(a.x=h+b);return a},onMouseMove:function(a){e.reposition(E(a))},onWindowResize:function(a){e.reposition(E(a))},onWindowScroll:function(a){e.reposition(E(a))},onPreventScroll:function(a){E(a).preventDefault()},
onOverlayClick:function(a){return d.modal?(a=E(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=E(a).target;(b=B(b,"metaphorjsTooltip-button-id"))&&e.trigger("button",h,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=B(a.target,"metaphorjsTooltip-button-id");b&&e.trigger("button",h,b,E(a))}},onAjaxLoad:function(a){P(k,d.cls.loading);e.setContent(a,"ajax")},onImageLoad:function(){g.images--;e.onContentChange()},onContentChange:function(){g.visible&&
e.reposition()},destroyElem:function(){e.setHandlers("unbind","_self");g.bindSelfOnRender=!0;t&&t.remove();w&&(w.parentNode.removeChild(w),w=null);k&&(d.render.keepInDOM||k.parentNode.removeChild(k),k=null);e.trigger("lifetime",h)}},!0,!1);delete d.callback.scope;for(var u in d.callback)h.on(u,d.callback[u],v);d.target&&d.useHref&&(u=d.target.getAttribute("href"),"#"==u.substr(0,1)?d.render.el=u:d.ajax.url=u);e.init();return h};F(D,{defaults:{}});return D}();window.jQuery&&(jQuery.fn.metaphorjsTooltip=
function(a,b,l){var f="dialog",m;"string"==typeof a&&"destroy"!=a&&(m=a,a=b,b=l);a=a||{};f+="-"+(b||"default");this.each(function(){var b=B(this,f);if(b)if("destroy"==a)b.destroy(),B(this,f,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else a.target=this,a.instanceName=f,B(this,f,new X(m,a))})});return X});
