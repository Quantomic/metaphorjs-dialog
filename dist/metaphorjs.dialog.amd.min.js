define("metaphorjs-dialog",["metaphorjs-observable","metaphorjs-promise","metaphorjs-ajax","metaphorjs-select","metaphorjs-animate"],function(da,s,ea,x,Y){var Z=Y.stop,fa=Array.prototype.slice,ga=Object.prototype.toString,L=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var g=a[ga.call(b)];return void 0===
g?-1:1==g&&isNaN(b)?8:g}}(),Q=function(a){return"object"==typeof a&&3===L(a)&&!a.nodeType},R=function(a){return!0===a||!1===a},D=function(){return function b(){var g=!1,c=!1,m=fa.call(arguments),n=m.shift(),F,p,q;R(m[m.length-1])&&(g=m.pop());R(m[m.length-1])&&(c=g,g=m.pop());for(;m.length;)if(F=m.shift())for(p in F)if(F.hasOwnProperty(p)&&void 0!==(q=F[p]))if(c)if(n[p]&&Q(n[p])&&Q(q))b(n[p],q,g,c);else{if(!0===g||void 0==n[p])Q(q)?(n[p]={},b(n[p],q,g,!0)):n[p]=q}else if(!0===g||void 0==n[p])n[p]=
q;return n}}(),$=function(){var a=["0","0","0"];return function(){for(var b=a.length,g;b;){b--;g=a[b].charCodeAt(0);if(57==g)return a[b]="A",a.join("");if(90==g)a[b]="0";else return a[b]=String.fromCharCode(g+1),a.join("")}a.unshift("0");return a.join("")}}(),aa=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),S=function(a,b){return b?aa("(?:^|\\s)"+b+"(?!\\S)").test(a.className):!1},E=function(a,b){b&&!S(a,b)&&(a.className+=" "+b)},T=function(a,b){b&&(a.className=a.className.replace(aa("(?:^|\\s)"+
b+"(?!\\S)"),""))},y=function(){var a={};return function(b,g,c){b=b._mjsid||(b._mjsid=$());var m=a[b];return void 0!==c?(m||(m=a[b]={}),m[g]=c):m?m[g]:void 0}}(),A=function(a,b,g){a.attachEvent?a.attachEvent("on"+b,g):a.addEventListener(b,g,!1)},B=function(a,b,g){a.detachEvent?a.detachEvent("on"+b,g):a.removeEventListener(b,g,!1)},M=function(){return!1},N=function(){return!0},K=function(a){if(a instanceof K)return a;if(!(this instanceof K))return new K(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(g){}this.originalEvent=
a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var c,m=a.button;void 0===this.pageX&&null!==a.clientX&&(c=this.target?this.target.ownerDocument||document:document,b=c.documentElement,c=c.body,this.pageX=a.clientX+(b&&b.scrollLeft||c&&c.scrollLeft||0)-(b&&b.clientLeft||c&&c.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||c&&c.scrollTop||0)-(b&&b.clientTop||c&&c.clientTop||0));this.which||void 0===m||(this.which=m&1?1:m&2?3:m&4?2:0);this.isDefaultPrevented=a.defaultPrevented||
void 0===a.defaultPrevented&&!1===a.returnValue?N:M;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};K.prototype={isDefaultPrevented:M,isPropagationStopped:M,isImmediatePropagationStopped:M,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=N;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=N;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;
this.isImmediatePropagationStopped=N;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};var C=function(a){return new K(a)},U=x.is,z=function(a){return"string"==typeof a||a===""+a},t=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)};s=function(a){var b,g=a?"pageYOffset":"pageXOffset",c=a?"scrollTop":"scrollLeft";a=document;var m=a.body,n=a.documentElement;b=void 0!==window[g]?function(){return window[g]}:n.clientHeight?function(){return n[c]}:function(){return m[c]};
return function(a){return a&&a!==window?a&&1==a.nodeType&&a!==m&&a!==n?a[c]:b():b()}};var V=s(!0),W=s(!1),O=document.documentElement,ha=function(){var a=function(b){return b===window?!0:3==b.nodeType?b.parentElement?a(b.parentElement):!0:b===O?!0:O.contains(b)};return a}(),ia=function(){return window.getComputedStyle?function(a,b,g){if(a===window)return b?g?0:null:{};a=getComputedStyle(a,null);b=b?a[b]:a;return g?parseFloat(b)||0:b}:function(a,b,g){a=a.currentStyle||a.style||{};b=b?a[b]:a;return g?
parseFloat(b)||0:b}}(),ba=document.body,ja=function(){var a;return function(){if(void 0===a){var b=document.createElement("div"),g=document.createElement("div");g.style&&window.getComputedStyle?(b.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",b.appendChild(g),g.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",g.innerHTML=
"",ba.appendChild(b),g="4px"===window.getComputedStyle(g,null).width,ba.removeChild(b),a=g):a=!1}return a}}();s=function(a,b){var g=/^([+-]?(?:d*.|)d+(?:[eE][+-]?d+|))(?!px)[a-z%]+$/i,c=["Top","Right","Bottom","Left"],m=a?"inner"==a?"padding":"":"content";return function(a,x){if(a===window)return a.document.documentElement["client"+b];if(9===a.nodeType){var p=a.documentElement;return Math.max(a.body["scroll"+b],p["scroll"+b],a.body["offset"+b],p["offset"+b],p["client"+b])}a:{var q=b.toLowerCase(),
u=m||(!0===x?"margin":"border"),p=ia(a),X=!0,r="width"===q?a.offsetWidth:a.offsetHeight,e="border-box"===p.boxSizing;if(0>=r||null==r){r=a.style[q];if(g.test(r)){p=r;break a}X=e&&(ja()||r===a.style[q]);r=parseFloat(r)||0}u=u||(e?"border":"content");q=u===(X?"border":"content")?4:"width"===q?1:0;for(e=0;4>q;q+=2)"margin"===u&&(e+=parseFloat(p[u+c[q]])),X?("content"===u&&(e-=parseFloat(p["padding"+c[q]])),"margin"!==u&&(e-=parseFloat(p["border"+c[q]+"Width"]))):(e+=parseFloat(p["padding"+c[q]]),"padding"!==
u&&(e+=parseFloat(p["border"+c[q]+"Width"])));p=r+e}return p}};var I=s("outer","Width"),J=s("outer","Height"),P={},ka=function(a,b,g,c){var m=b+"-"+g,n=function(a){a=C(a);return U(a.target,b)?c(a):null};P[m]||(P[m]=[]);P[m].push({el:a,ls:n,fn:c});A(a,g,n)},la=function(a,b,g,c){var m,n;if(n=P[b+"-"+g])for(b=-1,m=n.length;++b<m;)n[b].el===a&&n[b].fn===c&&B(a,g,n[b].ls)},ca=function(){var a=function(a,b){var e=a.style,k;for(k in b)e[k]=b[k]},b={t:"b",r:"l",b:"t",l:"r"},g={t:"top",r:"right",b:"bottom",
l:"left"},c={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},m=document.all&&!window.XMLHttpRequest,n=function(){var a={},b={};return{register:function(e){var k=e.getInstanceId(),g=e.getGroup(),c,d,m;a[k]=e;c=0;for(d=g.length;c<d;c++)m=g[c],b[m]||(b[m]={}),b[m][k]=!0;e.on("destroy",this.unregister,this)},unregister:function(e){e=e.getInstanceId();delete a[e]},hideAll:function(e){var k=e.getInstanceId();e=e.getGroup();var g,c,d,m;g=0;for(c=e.length;g<c;g++)for(m in d=e[g],d=b[d],d)a[m]?m==k||a[m].isHideAllIgnored()||
a[m].hide(null,!0,!0):delete d[m]}}}(),F=function(p,r,e){var k,n=this,G,d={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},q=r.size,l=r.width||2*q;D(n,{init:function(){r.border&&n.createInner()},getEl:function(){return k},getDialogPositionOffset:function(){var a=(n.detectPointerPosition()||"").substr(0,1),e=(p.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1),d={x:0,y:0};a==b[e]&&(d["t"==a||"b"==a?"y":"x"]="b"==a||"r"==a?-q:q);
return d},createInner:function(){var a=D({},r);a.size=q-2*r.border;a.width=l-4*r.border;delete a.border;delete a.borderColor;delete a.borderCls;delete a.offset;G=new F(p,a,r.border)},detectPointerPosition:function(){if(r.position)return r.position;var a=(p.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return a?b[a]:null},detectPointerDirection:function(a){return r.direction?r.direction:a},getBorders:function(a,e,d){var k={},f=a.substr(0,1);a=e.substr(0,1);var H=e.substr(1);e=m?"dotted":
"solid";k["border"+t(g[b[f]])]=q+"px solid "+d;k["border"+t(g[f])]="0 "+e+" transparent";H?(k["border"+t(g[H])]="0 solid transparent",k["border"+t(g[b[H]])]=l+"px "+e+" transparent"):(d=Math.floor(l/2),k["border"+t(g[c[a][0]])]=d+"px "+e+" transparent",k["border"+t(g[c[a][1]])]=d+"px "+e+" transparent");return k},getOffsets:function(a,d){var h={},c=a.substr(0,1),f="t"==c||"b"==c?"r":"b";if(!q)switch(document.body.appendChild(k),c){case "t":case "b":q=J(k);l=I(k);break;case "l":case "r":l=J(k),q=I(k)}h[g[c]]=
e?"auto":-q+"px";h[g[f]]="auto";if(e){var c=d.substr(0,1),H=d.substr(1);h[g[b[f]]]=H?"l"==H||"t"==H?e+"px":-l-e+"px":Math.floor(-l/2)+"px";h[g[b[c]]]=-(q+2*e)+"px"}else{switch(a){case "t":case "r":case "b":case "l":c=d!=a?"l"==d||"t"==d?r.offset:-l+r.offset:-l/2+r.offset;break;case "bl":case "tl":case "lt":case "rt":c=r.offset;break;default:c=-l-r.offset}h["margin"+t(g[b[f]])]=c+"px";switch(a){case "t":case "r":case "b":case "l":c="50%";break;case "tr":case "rb":case "br":case "lb":c="100%";break;
default:c=0}h[g[b[f]]]=c}return h},render:function(){if(!k){var b=n.detectPointerPosition();if(b)if(r.el){if(z(r.el)){var l=document.createElement("div");l.innerHTML=r.el;k=l.firstChild}else k=r.el;a(k,{position:"absolute"});a(k,n.getOffsets(b));E(k,r.cls);p.getElem().appendChild(k)}else{l=n.detectPointerDirection(b);k=document.createElement("div");var h=document.createComment(" ");k.appendChild(h);a(k,d);a(k,n.getBorders(b,l,r.borderColor||r.color));a(k,n.getOffsets(b,l));E(k,r.borderCls||r.cls);
G&&(G.render(),k.appendChild(G.getEl()));e||p.getElem().appendChild(k)}}},destroy:function(){n.remove();G=n=null},remove:function(){G&&G.remove();k&&(k.parentNode.removeChild(k),k=null)}},!0,!1);n.init();return n},p=function(a){if(!a)return{};var b=function(e,b,g){var c=a[e],d=!1;if(void 0!==c){switch(g){case "string":d=z(c);break;case "function":d="function"==typeof c;break;case "number":d=1===L(c)||c==parseInt(c);break;case "dom":d=c&&(c.tagName||c.nodeName)?!0:!1;break;case "jquery":(d=c&&c.jquery?
!0:!1)&&(c=c.get(0));break;case "boolean":if(!0===c||!1===c)d=!0;break;default:!0===g&&!0===c&&(d=!0),!1===g&&!1===c&&(d=!0)}d&&(a[e]={},a[e][b]=c)}};b("content","value","string");b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");b("show","events",!1);b("show","events","string");b("hide","events",!1);b("hide","events","string");b("toggle",
"events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position","string");b("pointer","size","number");return a},q={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",
fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,
direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},u=function(b,c){b&&!z(b)&&(c=b,b=null);c=c||{};var e=this,k={},g=$(),m=new da,d=D({},q,p(u.defaults),p(u[b]),p(c),!0,!0),t=d.callback.scope||
k,l,v,w,h={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};c=null;D(k,m.getApi(),{getElem:function(){return l},getInstanceId:function(){return g},getCfg:function(){return D({},d)},getGroup:function(){return d.group?z(d.group)?[d.group]:d.group:[""]},setTarget:function(f){if(!f)return k;var a=!1,d=h.target;h.target?(e.setHandlers("unbind","_target"),
a=!0):h.dynamicTarget&&(a=!0);z(f)?(h.dynamicTarget=!0,h.target=null):(h.dynamicTarget=!1,h.target=f);a&&(e.setHandlers("bind","_target"),e.trigger("targetchange",k,f,d));return k},getTarget:function(){return h.dynamicTarget?h.dynamicTargetEl:d.target},isEnabled:function(){return h.enabled},isVisible:function(){return h.visible},isHideAllIgnored:function(){return d.show.ignoreHideAll},isFrozen:function(){return h.frozen},enable:function(){h.enabled=!0;return k},disable:function(){e.hide();h.enabled=
!1;return k},freeze:function(){h.frozen=!0;return k},unfreeze:function(){h.frozen=!1;return k},toggle:function(f,a){return f&&f.stopPropagation&&h.dynamicTarget&&h.visible&&e.isDynamicTargetChanged(f)?e.show(f):e[h.visible?"hide":"show"](f,a)},show:function(f,a){var b=f&&f.stopPropagation?null:k,c=d.show;if(!k.isEnabled())return d.debug&&console.log("show: not enabled",k.getTarget()),b;f&&f.stopPropagation&&d.events.show&&d.events.show[f.type]&&(b=d.events.show[f.type],b.process?b=b.process(k,f):
(b.stopPropagation&&f.stopPropagation(),b.preventDefault&&f.preventDefault(),b=b.returnValue));if(h.visible&&h.hideTimeout)return window.clearTimeout(h.hideTimeout),h.hideTimeout=window.setTimeout(e.hide,d.hide.timeout),d.debug&&console.log("show: hide timeout was set",k.getTarget()),b;if(h.hideDelay)return window.clearTimeout(h.hideDelay),h.hideDelay=null,h.visible=!0,d.debug&&console.log("show: hide delay was set; already shown",k.getTarget()),b;if(h.frozen)return d.debug&&console.log("show: frozen",
k.getTarget()),b;h.destroyDelay&&(window.clearTimeout(h.destroyDelay),h.destroyDelay=null);var g=!1;f&&f.stopPropagation&&h.dynamicTarget&&(g=e.changeDynamicTarget(f));if(h.visible)if(g)if(d.render.fn)e.hide(null,!0);else return e.reposition(f),b;else return d.debug&&console.log("show: already shown",l),b;l?g&&e.changeDynamicContent():e.render();if(!1===e.trigger("beforeshow",k,f))return d.debug&&console.log("show: beforeshow return false",k.getTarget()),b;Z(l);h.visible=!0;c.single&&n.hideAll(e);
e.toggleTitleAttribute(!1);c.delay&&!a?h.showDelay=window.setTimeout(function(){e.showAfterDelay(f)},c.delay):e.showAfterDelay(f,a);return b},hide:function(f,a,b){h.hideTimeout=null;var c=f&&f.stopPropagation?null:k;f&&f.stopPropagation&&d.events.hide&&d.events.hide[f.type]&&(c=d.events.hide[f.type],c.process?c=c.process(k,f):(c.stopPropagation&&f.stopPropagation(),c.preventDefault&&f.preventDefault(),c=c.returnValue));!h.visible&&h.hideDelay&&a&&(window.clearTimeout(h.hideDelay),h.hideDelay=null,
h.visible=!0);if(!l||!h.visible||!e.isEnabled())return d.debug&&console.log("hide: elem/visible/enabled: ",l,h.visible,e.isEnabled()),c;if(h.showDelay)return d.hide.cancelShowDelay||b?(window.clearTimeout(h.showDelay),h.showDelay=null,h.visible=!1,d.debug&&console.log("hide: cancelShowDelay: ",e.getTarget())):d.debug&&console.log("hide: show delay was set",e.getTarget()),c;if(h.frozen)return d.debug&&console.log("hide: frozen",e.getTarget()),c;if(!1===e.trigger("beforehide",k,f))return d.debug&&console.log("hide: beforehide returned false",
e.getTarget()),c;Z(l);h.visible=!1;e.toggleTitleAttribute(!0);h.dynamicTarget&&e.resetDynamicTarget();d.hide.delay&&!a?h.hideDelay=window.setTimeout(function(){e.hideAfterDelay(f)},d.hide.delay):e.hideAfterDelay(f,a);return c},setPositionType:function(f){f&&(z(f)?(d.position.get=f,d.position.type=!1):(d.position.get=null,d.position.type=f));f=d.position.type;!1===f?h.position=!1:d.position.get&&"m"!=f?h.position="fn":(f=f.substr(0,1),h.position="w"==f?"window":"m"==f?"mouse":"target");v&&(v.remove(),
l&&v.render())},getPosition:function(f){if(!l)return null;var a,b=d.position;switch(h.position){case !1:return null;case "target":a=e.getTargetPosition(f);break;case "mouse":a=e.getMousePosition(f);break;case "window":a=e.getWindowPosition(f);break;case "fn":a=b.get.call(t,k,f)}if(!1!==b.screenX||!1!==b.screenY)a=e.correctScreenPosition(a,b.screenX,b.screenY);return a},reposition:function(f){f&&(f=C(f));if(f=e.getPosition(f))void 0!=f.x&&a(l,{left:f.x+"px"}),void 0!=f.y&&a(l,{top:f.y+"px"}),void 0==
f.x&&void 0==f.y&&a(l,f)},getContentElem:function(){return l?d.selector.content?x(d.selector.content,l).shift()||l:l:null},setContent:function(f,a){a=a||"";if(!l)return d.content.value=f,k;d.content.prepare&&(f=d.content.prepare(k,a,f));var b=k.getContentElem(),c=h.rendered&&!d.selector.content&&v,g=c&&v.getEl();if(c&&g)try{l.removeChild(g)}catch(m){}if(z(f))b.innerHTML=f;else for(var n in f){var p=d.selector[n];p&&(p=x(p,b).shift())&&(p.innerHTML=f[n])}if(c&&g)try{l.appendChild(g)}catch(r){}b=x("img",
b);h.images=b.length;n=-1;for(c=b.length;++n<c;A(b[n],"load",e.onImageLoad));e.trigger("contentchange",k,f,a);e.onContentChange();return k},readContent:function(){var f=k.getTarget(),a;f&&(a=d.content.attr?f.getAttribute(d.content.attr):f.getAttribute("tooltip")||f.getAttribute("title")||f.getAttribute("alt"));a&&e.setContent(a,"attribute");return k},loadContent:function(f){E(l,d.cls.loading);f=D({},d.ajax,f,!0,!0);e.trigger("beforeajax",k,f);return ea(f).done(e.onAjaxLoad)},destroy:function(){e.trigger("destroy",
k);B(window,"resize",e.onWindowResize);B(window,"scroll",e.onWindowScroll);e.destroyElem();v&&(v.destroy(),v=null);e.setHandlers("unbind");m.destroy();w=h=k=e=m=null},setFocus:function(){var f=d.show.focus,a;if(!0===f)if(f=x("input",l).concat(x("textarea",l)),0<f.length)f[0].focus();else{if(d.buttons)for(a in d.buttons){(a=x(d.buttons[a],l).shift())&&a.focus();break}}else(a=x(f,l).shift())&&a.focus()}},!0,!1);D(e,k,{init:function(){n.register(e);d.modal&&(d.overlay.enabled=!0);e.setPositionType();
e.setTarget(d.target);if(d.pointer.size||d.pointer.el)v=new F(e,d.pointer);d.render.lazy||e.render();e.setHandlers("bind")},setHandlers:function(f,a){for(var b=["show","hide","toggle"],c="bind"==f?A:B,g="bind"==f?ka:la,m,n,p,r,q,v,t,s,u,y;m=b.shift();)if(n=d[m].events,!1!==n){if(z(n)||"object"==typeof n&&5===L(n))h.dynamicTarget?(q={},q[n]=d.target,n={_html:q}):n={_target:n};for(p in n){if(a)if("_self"==a){if("_self"!=p&&"_overlay"!=p&&">"!=p.substr(0,1))continue}else if(p!=a)continue;if("_self"!=
p&&"_overlay"!=p&&">"!=p.substr(0,1)||l){if(t=n[p]){switch(p){case "_target":s=[e.getTarget()];break;case "_self":s=[l];break;case "_window":s=[window];break;case "_document":s=[document];break;case "_html":s=[document.documentElement];break;case "_overlay":s=[w];break;default:s=">"==p.substr(0,1)?x(p.substr(1),l):x(p)}if(s&&s.length)if(z(t)&&(t=[t]),"object"==typeof t&&5===L(t))for(q=0,v=t.length;q<v;q++)for(u=-1,y=s.length;++u<y;c(s[u],t[q],k[m]));else for(r in t)for(u=-1,y=s.length;++u<y;g(s[u],
t[r],r,k[m]));}}else h.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var f=h.dynamicTargetEl;f&&(e.setHandlers("unbind","_target"),e.trigger("targetchange",k,null,f))},isDynamicTargetChanged:function(f){var a=d.target;f=f.target;for(var b=h.dynamicTargetEl;f&&!U(f,a);)f=f.parentNode;return f?!b||b!==f:!1},changeDynamicTarget:function(f){var a=d.target;f=f.target;for(var b=h.dynamicTargetEl;f&&!U(f,a);)f=f.parentNode;if(!f||b&&b===f)return!1;b&&e.setHandlers("unbind","_target");h.dynamicTargetEl=
f;e.setHandlers("bind","_target");e.trigger("targetchange",k,f,b);return!0},showAfterDelay:function(f,a){h.showDelay=null;if(h.visible){d.position.manual||e.reposition(f);"mouse"==h.position&&A(document.documentElement,"mousemove",e.onMouseMove);var b=d.position;(b.resize||b.screenX||b.screenY)&&A(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&A(window,"scroll",e.onWindowScroll);if(a||!1!==e.trigger("afterdelay",k,f)){w&&(d.overlay.animateShow?e.animate("show",null,!0):w.style.display=
"");if(d.show.preventScroll){var b=d.show.preventScroll,c,g;!0===b&&(b="body");b=x(b);c=-1;for(g=b.length;++c<g;A(b[c],"mousewheel",e.onPreventScroll)&&A(b[c],"touchmove",e.onPreventScroll));}d.show.animate&&!a?e.animate("show").done(function(){e.showAfterAnimation(f)}):e.showAfterAnimation(f)}else h.visible=!1,d.debug&&console.log("showAfterDelay: afterdelay returned false",k.getTarget())}else d.debug&&console.log("showAfterDelay: already hidden",e.getTarget())},showAfterAnimation:function(f){h.visible?
(T(l,d.cls.hidden),E(l,d.cls.visible),d.render.keepVisible||(l.style.display=""),d.hide.timeout&&(h.hideTimeout=window.setTimeout(e.hide,d.hide.timeout)),d.show.focus&&window.setTimeout(e.setFocus,20),e.trigger("show",k,f)):d.debug&&console.log("showAfterAnimation: already hidden",e.getTarget())},hideAfterDelay:function(f,a){h.hideDelay=null;if(h.visible)d.debug&&console.log("hideAfterDelay: already shown again",e.getTarget());else{"mouse"==h.position&&B(document.documentElement,"mousemove",e.onMouseMove);
var b=d.position;(b.resize||b.screenX||b.screenY)&&B(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&B(window,"scroll",e.onWindowScroll);if(a||!1!==e.trigger("afterhidedelay",k,f)){if(d.show.preventScroll){var b=d.show.preventScroll,c,g;!0===b&&(b="body");b=x(b);c=-1;for(g=b.length;++c<g;B(b[c],"mousewheel",e.onPreventScroll)&&B(b[c],"touchmove",e.onPreventScroll));}w&&(d.overlay.animateShow?e.animate("hide",null,!0).done(function(){w.style.display="none"}):w.style.display="none");
d.hide.animate&&!a?e.animate("hide").done(function(){e.hideAfterAnimation(f)}):e.hideAfterAnimation(f)}else h.visible=d.cls.hidden?!S(l,d.cls.hidden):!(0>=l.offsetWidth||0>=l.offsetHeight),d.debug&&console.log("hideAfterDelay: afterhdelay returned false",e.getTarget())}},hideAfterAnimation:function(a){h.visible?d.debug&&console.log("hideAfterAnimation: already shown again",e.getTarget()):(T(l,d.cls.visible),E(l,d.cls.hidden),d.render.keepVisible||(l.style.display="none"),e.trigger("hide",k,a),a=d.render.lifetime,
null!==a&&(0===a?e.destroyElem():h.destroyDelay=window.setTimeout(e.destroyElem,a)),l&&d.hide.destroy&&window.setTimeout(function(){y(l,d.instanceName,null);e.destroy()},0))},render:function(){if(l)d.debug&&console.log("element already rendered",l);else{var f=d.render,b=d.cls;if(f.fn){var c=f.fn.call(t,k);f[z(c)?"tpl":"el"]=c}f.el?z(f.el)?(l=x(f.el).shift(),f.keepInDOM=!0):l=f.el:(c=document.createElement("div"),c.innerHTML=f.tpl,l=c.firstChild);l||(l=document.createElement("div"));f.id&&l.setAttribute("id",
f.id);d.render.keepVisible||(l.style.display="none");E(l,b.dialog);E(l,b.hidden);f.style&&a(l,f.style);d.overlay.enabled&&(w=document.createElement("div"),a(w,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:d.overlay.opacity,backgroundColor:d.overlay.color}),document.body.appendChild(w),A(w,"click",e.onOverlayClick),f.zIndex&&a(w,{zIndex:f.zIndex}),d.overlay.cls&&E(w,d.overlay.cls));f.appendTo?f.appendTo.appendChild(l):!1!==f.appendTo&&document.body.appendChild(l);f.zIndex&&
a(l,{zIndex:f.zIndex});f=d.content;if(!1!==f.value)if(f.value)e.setContent(f.value);else if(f.fn)e.setContent(f.fn.call(t,k));else e[d.ajax.url?"loadContent":"readContent"]();v&&v.render();if(d.buttons)for(var g in d.buttons)if(f=x(d.buttons[g],l).shift())y(f,"metaphorjsTooltip-button-id",g),A(f,"click",e.onButtonClick),A(f,"keyup",e.onButtonKeyup);h.bindSelfOnRender&&(e.setHandlers("bind","_self"),h.bindSelfOnRender=!1);h.rendered=!0;e.trigger("render",k)}},animate:function(a,b,c){var g,k;g=c?"show"==
a?d.overlay.animateShow:d.overlay.animateHide:d[a].animate;"function"==typeof g&&(g=g(e,b));k=g.skipDisplayChange||!1;R(g)?g=a:z(g)&&(g=[g]);return Y(l,g,function(){"show"!=a||k||(c?w.style.display="":l.style.display="")})},toggleTitleAttribute:function(a){var b=k.getTarget(),d;b&&(!1===a?(y(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(d=y(b,"tmp-title"))&&b.setAttribute("title",d))},changeDynamicContent:function(){d.content.fn?e.setContent(d.content.fn.call(t,k)):d.content.attr&&
e.readContent()},getDialogSize:function(){var f=d.cls.hidden?S(l,d.cls.hidden):!!(0>=l.offsetWidth||0>=l.offsetHeight),b,e=l.style.left;f&&(a(l,{left:"-1000px"}),l.style.display="");b={width:I(l),height:J(l)};f&&(a(l,{left:e}),l.style.display="none");return b},getTargetSize:function(){var a=e.getTarget();return a?{width:I(a),height:J(a)}:null},getTargetPosition:function(a,b){var c=e.getTarget();if(!c)return null;var g=e.getDialogSize();var k={top:0,left:0};ha(c)&&c!==window?(c.getBoundingClientRect&&
(k=c.getBoundingClientRect()),c={top:k.top+V()-O.clientTop,left:k.left+W()-O.clientLeft}):c=k;var k=e.getTargetSize(),h={};b=b||d.position.type;var l=b.substr(0,1),n=b.substr(1),m=d.position.offsetX,p=d.position.offsetY,q=v?v.getDialogPositionOffset():null;switch(l){case "t":h.y=c.top-g.height-p;break;case "r":h.x=c.left+k.width+m;break;case "b":h.y=c.top+k.height+p;break;case "l":h.x=c.left-g.width-m}switch(n){case "t":h.y=c.top+p;break;case "r":h.x=c.left+k.width-g.width-m;break;case "b":h.y=c.top+
k.height-g.height-p;break;case "l":h.x=c.left+m;break;case "rc":h.x=c.left+k.width+m;break;case "lc":h.x=c.left-g.width-m;break;case "":switch(l){case "t":case "b":h.x=c.left+k.width/2-g.width/2;break;case "r":case "l":h.y=c.top+k.height/2-g.height/2}}q&&(h.x+=q.x,h.y+=q.y);return h},getMousePosition:function(a){if(!a)return null;var b=e.getDialogSize(),c={},g=d.position.type.substr(1),h=d.position.offsetX,l=d.position.offsetY,m=d.position.axis,n=v?v.getDialogPositionOffset():null;switch(g){case "":c=
d.position.get.call(t,k,a);break;case "t":c.y=a.pageY-b.height-l;c.x=a.pageX-b.width/2;break;case "r":c.y=a.pageY-b.height/2;c.x=a.pageX+h;break;case "b":c.y=a.pageY+l;c.x=a.pageX-b.width/2;break;case "l":c.y=a.pageY-b.height/2;c.x=a.pageX-b.width-h;break;case "rt":c.y=a.pageY-b.height-l;c.x=a.pageX+h;break;case "rb":c.y=a.pageY+l;c.x=a.pageX+h;break;case "lt":c.y=a.pageY-b.height-l;c.x=a.pageX-b.width-h;break;case "lb":c.y=a.pageY+l,c.x=a.pageX-b.width-h}n&&(c.x+=n.x,c.y+=n.y);m&&(a=e.getTargetPosition(a,
g))&&("x"==m?c.y=a.y:c.x=a.x);return c},getWindowPosition:function(){var a=e.getDialogSize(),b={},c=d.position.type.substr(1),g=d.position.offsetX,h=d.position.offsetY,k=V(),l=W(),m=I(window),n=J(window);switch(c){case "c":b.y=n/2-a.height/2+k;b.x=m/2-a.width/2+l;break;case "t":b.y=k+h;b.x=m/2-a.width/2+l;break;case "r":b.y=n/2-a.height/2+k;b.x=m-a.width+l-g;break;case "b":b.y=n-a.height+k-h;b.x=m/2-a.width/2+l;break;case "l":b.y=n/2-a.height/2+k;b.x=l+g;break;case "rt":b.y=k+h;b.x=m-a.width+l-g;
break;case "rb":b.y=n-a.height+k-h;b.x=m-a.width+l-g;break;case "lt":b.y=k+h;b.x=l+g;break;case "lb":b.y=n-a.height+k-h,b.x=l+g}return b},correctScreenPosition:function(a,b,c){var d=e.getDialogSize(),g=V(),h=W(),k=I(window),l=J(window);c&&a.y+d.height>l+g-c&&(a.y=l+g-c-d.height);b&&a.x+d.width>k+h-b&&(a.x=k+h-b-d.width);c&&a.y<g+c&&(a.y=g+c);b&&a.x<h+b&&(a.x=h+b);return a},onMouseMove:function(a){e.reposition(C(a))},onWindowResize:function(a){e.reposition(C(a))},onWindowScroll:function(a){e.reposition(C(a))},
onPreventScroll:function(a){C(a).preventDefault()},onOverlayClick:function(a){return d.modal?(a=C(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=C(a).target;(b=y(b,"metaphorjsTooltip-button-id"))&&e.trigger("button",k,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=y(a.target,"metaphorjsTooltip-button-id");b&&e.trigger("button",k,b,C(a))}},onAjaxLoad:function(a){T(l,d.cls.loading);e.setContent(a,"ajax")},onImageLoad:function(){h.images--;
e.onContentChange()},onContentChange:function(){h.visible&&e.reposition()},destroyElem:function(){e.setHandlers("unbind","_self");h.bindSelfOnRender=!0;v&&v.remove();w&&(w.parentNode.removeChild(w),w=null);l&&(d.render.keepInDOM||l.parentNode.removeChild(l),l=null);e.trigger("lifetime",k)}},!0,!1);delete d.callback.scope;for(var s in d.callback)k.on(s,d.callback[s],t);d.target&&d.useHref&&(s=d.target.getAttribute("href"),"#"==s.substr(0,1)?d.render.el=s:d.ajax.url=s);e.init();return k};D(u,{defaults:{}});
return u}();window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(a,b,g){var c="dialog",m;"string"==typeof a&&"destroy"!=a&&(m=a,a=b,b=g);a=a||{};c+="-"+(b||"default");this.each(function(){var b=y(this,c);if(b)if("destroy"==a)b.destroy(),y(this,c,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else a.target=this,a.instanceName=c,y(this,c,new ca(m,a))})});return ca});
