'use strict';define("metaphorjs-dialog",["metaphorjs-observable","metaphorjs-promise","metaphorjs-ajax","metaphorjs-select","metaphorjs-animate"],function(ca,s,da,x,Y){function Q(a){return"object"==typeof a&&3===M(a)&&!a.nodeType&&a.constructor===Object}function R(a){return!0===a||!1===a}function S(a,b){return b?Z("(?:^|\\s)"+b+"(?!\\S)").test(a.className):!1}function E(a,b){b&&!S(a,b)&&(a.className+=" "+b)}function T(a,b){b&&(a.className=a.className.replace(Z("(?:^|\\s)"+b+"(?!\\S)"),""))}function I(a,
b){return a.getAttribute?a.getAttribute(b):null}function A(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}function B(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)}function N(){return!1}function O(){return!0}function y(a){return new L(a)}function z(a){return"string"==typeof a||a===""+a}function t(a){return a.substr(0,1).toUpperCase()+a.substr(1)}function ea(a,b,c,h){var m=b+"-"+c,n=function(a){a=y(a);return U(a.target,b)?h(a):null};P[m]||(P[m]=
[]);P[m].push({el:a,ls:n,fn:h});A(a,c,n)}function fa(a,b,c,h){var m,n;if(n=P[b+"-"+c])for(b=-1,m=n.length;++b<m;)n[b].el===a&&n[b].fn===h&&B(a,c,n[b].ls)}var $=Y.stop,ga=Array.prototype.slice,ha=Object.prototype.toString,M=function(){var a={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(b){if(!b){if(null===b)return 6;if(void 0===b)return 7}var c=a[ha.call(b)];return void 0===
c?-1:1==c&&isNaN(b)?8:c}}(),C=function(){return function b(){var c=!1,h=!1,m=ga.call(arguments),n=m.shift(),F,p,r;R(m[m.length-1])&&(c=m.pop());R(m[m.length-1])&&(h=c,c=m.pop());for(;m.length;)if(F=m.shift())for(p in F)if(F.hasOwnProperty(p)&&void 0!==(r=F[p]))if(h)if(n[p]&&Q(n[p])&&Q(r))b(n[p],r,c,h);else{if(!0===c||void 0==n[p])Q(r)?(n[p]={},b(n[p],r,c,!0)):n[p]=r}else if(!0===c||void 0==n[p])n[p]=r;return n}}(),aa=function(){var a=["0","0","0"];return function(){for(var b=a.length,c;b;){b--;c=
a[b].charCodeAt(0);if(57==c)return a[b]="A",a.join("");if(90==c)a[b]="0";else return a[b]=String.fromCharCode(c+1),a.join("")}a.unshift("0");return a.join("")}}(),Z=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),D=function(){var a={};return function(b,c,h){b=b._mjsid||(b._mjsid=aa());var m=a[b];return void 0!==h?(m||(m=a[b]={}),m[c]=h):m?m[c]:void 0}}(),L=function(a){if(a instanceof L)return a;if(!(this instanceof L))return new L(a);for(var b in a)if(!this[b])try{this[b]=
a[b]}catch(c){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var h,m=a.button;void 0===this.pageX&&null!==a.clientX&&(h=this.target?this.target.ownerDocument||window.document:window.document,b=h.documentElement,h=h.body,this.pageX=a.clientX+(b&&b.scrollLeft||h&&h.scrollLeft||0)-(b&&b.clientLeft||h&&h.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||h&&h.scrollTop||0)-(b&&b.clientTop||h&&h.clientTop||0));this.which||void 0===m||(this.which=m&1?1:m&
2?3:m&4?2:0);this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&!1===a.returnValue?O:N;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};C(L.prototype,{isDefaultPrevented:N,isPropagationStopped:N,isImmediatePropagationStopped:N,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=O;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=O;a&&a.stopPropagation&&a.stopPropagation()},
stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=O;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}},!0,!1);var U=x.is;s=function(a){var b,c=a?"pageYOffset":"pageXOffset",h=a?"scrollTop":"scrollLeft";a=window.document;var m=a.body,n=a.documentElement;b=void 0!==window[c]?function(){return window[c]}:n.clientHeight?function(){return n[h]}:function(){return m[h]};return function(a){return a&&a!==window?a&&1==a.nodeType&&
a!==m&&a!==n?a[h]:b():b()}};var V=s(!0),W=s(!1),ia=function(){return function b(c){if(c===window)return!0;if(3==c.nodeType)return c.parentElement?b(c.parentElement):!0;var h=window.document.documentElement;return c===h?!0:h.contains(c)}}(),ja=function(){var a;return function(){if(void 0===a){var b=window.document,c=b.createElement("div"),h=b.createElement("div"),b=b.body;h.style&&window.getComputedStyle?(c.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",
c.appendChild(h),h.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",h.innerHTML="",b.appendChild(c),h="4px"===window.getComputedStyle(h,null).width,b.removeChild(c),a=h):a=!1}return a}}();s=function(a,b){var c=/^([+-]?(?:d*.|)d+(?:[eE][+-]?d+|))(?!px)[a-z%]+$/i,h=["Top","Right","Bottom","Left"],m=a?"inner"==a?"padding":"":"content";return function(a,x){if(a===window)return a.document.documentElement["client"+
b];if(9===a.nodeType){var p=a.documentElement;return Math.max(a.body["scroll"+b],p["scroll"+b],a.body["offset"+b],p["offset"+b],p["client"+b])}var p=b.toLowerCase(),r;a:if(window.getComputedStyle){if(a===window){r={};break a}r=getComputedStyle(a,null)}else r=a.currentStyle||a.style||{};a:{var u=m||(!0===x?"margin":"border"),X=!0,q="width"===p?a.offsetWidth:a.offsetHeight,f="border-box"===r.boxSizing;if(0>=q||null==q){q=a.style[p];if(c.test(q)){p=q;break a}X=f&&(ja()||q===a.style[p]);q=parseFloat(q)||
0}u=u||(f?"border":"content");p=u===(X?"border":"content")?4:"width"===p?1:0;for(f=0;4>p;p+=2)"margin"===u&&(f+=parseFloat(r[u+h[p]])),X?("content"===u&&(f-=parseFloat(r["padding"+h[p]])),"margin"!==u&&(f-=parseFloat(r["border"+h[p]+"Width"]))):(f+=parseFloat(r["padding"+h[p]]),"padding"!==u&&(f+=parseFloat(r["border"+h[p]+"Width"])));p=q+f}return p}};var J=s("outer","Width"),K=s("outer","Height"),P={},ba=function(){var a=function(a,b){var f=a.style,k;for(k in b)f[k]=b[k]},b={t:"b",r:"l",b:"t",l:"r"},
c={t:"top",r:"right",b:"bottom",l:"left"},h={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},m=null,n=function(){var a={},b={};return{register:function(f){var k=f.getInstanceId(),c=f.getGroup(),h,e,m;a[k]=f;h=0;for(e=c.length;h<e;h++)m=c[h],b[m]||(b[m]={}),b[m][k]=!0;f.on("destroy",this.unregister,this)},unregister:function(f){f=f.getInstanceId();delete a[f]},hideAll:function(f){var k=f.getInstanceId();f=f.getGroup();var c,h,e,m;c=0;for(h=f.length;c<h;c++)for(m in e=f[c],e=b[e],e)a[m]?m==k||a[m].isHideAllIgnored()||
a[m].hide(null,!0,!0):delete e[m]}}}(),F=function(p,q,f){null===m&&(m=window.document.all&&!window.XMLHttpRequest);var k,n=this,G,e={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},r=q.size,l=q.width||2*r;C(n,{init:function(){q.border&&n.createInner()},getEl:function(){return k},getDialogPositionOffset:function(){var a=(n.detectPointerPosition()||"").substr(0,1),f=(p.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1),e={x:0,y:0};
a==b[f]&&(e["t"==a||"b"==a?"y":"x"]="b"==a||"r"==a?-r:r);return e},createInner:function(){var a=C({},q);a.size=r-2*q.border;a.width=l-4*q.border;a.border=null;a.borderColor=null;a.borderCls=null;a.offset=null;G=new F(p,a,q.border)},detectPointerPosition:function(){if(q.position)return q.position;var a=(p.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return a?b[a]:null},detectPointerDirection:function(a){return q.direction?q.direction:a},getBorders:function(a,f,e){var k={},d=a.substr(0,
1);a=f.substr(0,1);var H=f.substr(1);f=m?"dotted":"solid";k["border"+t(c[b[d]])]=r+"px solid "+e;k["border"+t(c[d])]="0 "+f+" transparent";H?(k["border"+t(c[H])]="0 solid transparent",k["border"+t(c[b[H]])]=l+"px "+f+" transparent"):(e=Math.floor(l/2),k["border"+t(c[h[a][0]])]=e+"px "+f+" transparent",k["border"+t(c[h[a][1]])]=e+"px "+f+" transparent");return k},getOffsets:function(a,e){var g={},h=a.substr(0,1),d="t"==h||"b"==h?"r":"b";if(!r)switch(window.document.body.appendChild(k),h){case "t":case "b":r=
K(k);l=J(k);break;case "l":case "r":l=K(k),r=J(k)}g[c[h]]=f?"auto":-r+"px";g[c[d]]="auto";if(f){var h=e.substr(0,1),H=e.substr(1);g[c[b[d]]]=H?"l"==H||"t"==H?f+"px":-l-f+"px":Math.floor(-l/2)+"px";g[c[b[h]]]=-(r+2*f)+"px"}else{switch(a){case "t":case "r":case "b":case "l":h=e!=a?"l"==e||"t"==e?q.offset:-l+q.offset:-l/2+q.offset;break;case "bl":case "tl":case "lt":case "rt":h=q.offset;break;default:h=-l-q.offset}g["margin"+t(c[b[d]])]=h+"px";switch(a){case "t":case "r":case "b":case "l":h="50%";break;
case "tr":case "rb":case "br":case "lb":h="100%";break;default:h=0}g[c[b[d]]]=h}return g},render:function(){if(!k){var b=n.detectPointerPosition();if(b)if(q.el){if(z(q.el)){var l=window.document.createElement("div");l.innerHTML=q.el;k=l.firstChild}else k=q.el;a(k,{position:"absolute"});a(k,n.getOffsets(b));E(k,q.cls);p.getElem().appendChild(k)}else{l=n.detectPointerDirection(b);k=window.document.createElement("div");var g=window.document.createComment(" ");k.appendChild(g);a(k,e);a(k,n.getBorders(b,
l,q.borderColor||q.color));a(k,n.getOffsets(b,l));E(k,q.borderCls||q.cls);G&&(G.render(),k.appendChild(G.getEl()));f||p.getElem().appendChild(k)}}},destroy:function(){n.remove();f=q=p=G=n=null},remove:function(){G&&G.remove();k&&(k.parentNode.removeChild(k),k=null)}},!0,!1);n.init();return n},p=function(a){if(!a)return{};var b=function(f,b,h){var c=a[f],e=!1;if(void 0!==c){switch(h){case "string":e=z(c);break;case "function":e="function"==typeof c;break;case "number":e=1===M(c)||c==parseInt(c);break;
case "dom":e=c&&(c.tagName||c.nodeName)?!0:!1;break;case "jquery":(e=c&&c.jquery?!0:!1)&&(c=c.get(0));break;case "boolean":if(!0===c||!1===c)e=!0;break;default:!0===h&&!0===c&&(e=!0),!1===h&&!1===c&&(e=!0)}e&&(a[f]={},a[f][b]=c)}};b("content","value","string");b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");b("show","events",!1);b("show",
"events","string");b("hide","events",!1);b("hide","events","string");b("toggle","events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position","string");b("pointer","size","number");return a},r={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,
hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",
offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},u=function(b,c){b&&!z(b)&&(c=b,b=null);c=c||
{};var f=this,k={},h=aa(),m=new ca,e=C({},r,p(u.defaults),p(u[b]),p(c),!0,!0),t=e.callback.scope||k,l,v,w,g={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};c=null;C(k,m.getApi(),{getElem:function(){return l},getInstanceId:function(){return h},getCfg:function(){return C({},e)},getGroup:function(){return e.group?z(e.group)?[e.group]:e.group:[""]},
setTarget:function(d){if(!d)return k;var a=!1,e=g.target;g.target?(f.setHandlers("unbind","_target"),a=!0):g.dynamicTarget&&(a=!0);z(d)?(g.dynamicTarget=!0,g.target=null):(g.dynamicTarget=!1,g.target=d);a&&(f.setHandlers("bind","_target"),f.trigger("targetchange",k,d,e));return k},getTarget:function(){return g.dynamicTarget?g.dynamicTargetEl:e.target},isEnabled:function(){return g.enabled},isVisible:function(){return g.visible},isHideAllIgnored:function(){return e.show.ignoreHideAll},isFrozen:function(){return g.frozen},
enable:function(){g.enabled=!0;return k},disable:function(){f.hide();g.enabled=!1;return k},freeze:function(){g.frozen=!0;return k},unfreeze:function(){g.frozen=!1;return k},toggle:function(d,a){return d&&d.stopPropagation&&g.dynamicTarget&&g.visible&&f.isDynamicTargetChanged(d)?f.show(d):f[g.visible?"hide":"show"](d,a)},show:function(d,a){var b=d&&d.stopPropagation?null:k,c=e.show;if(!k.isEnabled())return e.debug&&console.log("show: not enabled",k.getTarget()),b;d&&d.stopPropagation&&e.events.show&&
e.events.show[d.type]&&(b=e.events.show[d.type],b.process?b=b.process(k,d):(b.stopPropagation&&d.stopPropagation(),b.preventDefault&&d.preventDefault(),b=b.returnValue));if(g.visible&&g.hideTimeout)return window.clearTimeout(g.hideTimeout),g.hideTimeout=window.setTimeout(f.hide,e.hide.timeout),e.debug&&console.log("show: hide timeout was set",k.getTarget()),b;if(g.hideDelay)return window.clearTimeout(g.hideDelay),g.hideDelay=null,g.visible=!0,e.debug&&console.log("show: hide delay was set; already shown",
k.getTarget()),b;if(g.frozen)return e.debug&&console.log("show: frozen",k.getTarget()),b;g.destroyDelay&&(window.clearTimeout(g.destroyDelay),g.destroyDelay=null);var h=!1;d&&d.stopPropagation&&g.dynamicTarget&&(h=f.changeDynamicTarget(d));if(g.visible)if(h)if(e.render.fn)f.hide(null,!0);else return f.reposition(d),b;else return e.debug&&console.log("show: already shown",l),b;l?h&&f.changeDynamicContent():f.render();if(!1===f.trigger("beforeshow",k,d))return e.debug&&console.log("show: beforeshow return false",
k.getTarget()),b;$(l);g.visible=!0;c.single&&n.hideAll(f);f.toggleTitleAttribute(!1);c.delay&&!a?g.showDelay=window.setTimeout(function(){f.showAfterDelay(d)},c.delay):f.showAfterDelay(d,a);return b},hide:function(d,a,b){g.hideTimeout=null;var c=d&&d.stopPropagation?null:k;d&&d.stopPropagation&&e.events.hide&&e.events.hide[d.type]&&(c=e.events.hide[d.type],c.process?c=c.process(k,d):(c.stopPropagation&&d.stopPropagation(),c.preventDefault&&d.preventDefault(),c=c.returnValue));!g.visible&&g.hideDelay&&
a&&(window.clearTimeout(g.hideDelay),g.hideDelay=null,g.visible=!0);if(!l||!g.visible||!f.isEnabled())return e.debug&&console.log("hide: elem/visible/enabled: ",l,g.visible,f.isEnabled()),c;if(g.showDelay)return e.hide.cancelShowDelay||b?(window.clearTimeout(g.showDelay),g.showDelay=null,g.visible=!1,e.debug&&console.log("hide: cancelShowDelay: ",f.getTarget())):e.debug&&console.log("hide: show delay was set",f.getTarget()),c;if(g.frozen)return e.debug&&console.log("hide: frozen",f.getTarget()),c;
if(!1===f.trigger("beforehide",k,d))return e.debug&&console.log("hide: beforehide returned false",f.getTarget()),c;$(l);g.visible=!1;f.toggleTitleAttribute(!0);g.dynamicTarget&&f.resetDynamicTarget();e.hide.delay&&!a?g.hideDelay=window.setTimeout(function(){f.hideAfterDelay(d)},e.hide.delay):f.hideAfterDelay(d,a);return c},setPositionType:function(d){d&&(z(d)?(e.position.get=d,e.position.type=!1):(e.position.get=null,e.position.type=d));d=e.position.type;!1===d?g.position=!1:e.position.get&&"m"!=
d?g.position="fn":(d=d.substr(0,1),g.position="w"==d?"window":"m"==d?"mouse":"target");v&&(v.remove(),l&&v.render())},getPosition:function(d){if(!l)return null;var a,b=e.position;switch(g.position){case !1:return null;case "target":a=f.getTargetPosition(d);break;case "mouse":a=f.getMousePosition(d);break;case "window":a=f.getWindowPosition(d);break;case "fn":a=b.get.call(t,k,d)}if(!1!==b.screenX||!1!==b.screenY)a=f.correctScreenPosition(a,b.screenX,b.screenY);return a},reposition:function(d){d&&(d=
y(d));if(d=f.getPosition(d))void 0!=d.x&&a(l,{left:d.x+"px"}),void 0!=d.y&&a(l,{top:d.y+"px"}),void 0==d.x&&void 0==d.y&&a(l,d)},getContentElem:function(){return l?e.selector.content?x(e.selector.content,l).shift()||l:l:null},setContent:function(d,a){a=a||"";if(!l)return e.content.value=d,k;e.content.prepare&&(d=e.content.prepare(k,a,d));var b=k.getContentElem(),c=g.rendered&&!e.selector.content&&v,h=c&&v.getEl();if(c&&h)try{l.removeChild(h)}catch(m){}if(z(d))b.innerHTML=d;else for(var p in d){var n=
e.selector[p];n&&(n=x(n,b).shift())&&(n.innerHTML=d[p])}if(c&&h)try{l.appendChild(h)}catch(q){}b=x("img",b);g.images=b.length;p=-1;for(c=b.length;++p<c;A(b[p],"load",f.onImageLoad));f.trigger("contentchange",k,d,a);f.onContentChange();return k},readContent:function(){var d=k.getTarget(),a;d&&(a=e.content.attr?I(d,e.content.attr):I(d,"tooltip")||I(d,"title")||I(d,"alt"));a&&f.setContent(a,"attribute");return k},loadContent:function(d){E(l,e.cls.loading);d=C({},e.ajax,d,!0,!0);f.trigger("beforeajax",
k,d);return da(d).done(f.onAjaxLoad)},destroy:function(){f.trigger("destroy",k);B(window,"resize",f.onWindowResize);B(window,"scroll",f.onWindowScroll);f.destroyElem();v&&(v.destroy(),v=null);f.setHandlers("unbind");m.destroy();w=g=k=f=m=null},setFocus:function(){var d=e.show.focus,a;if(!0===d)if(d=x("input",l).concat(x("textarea",l)),0<d.length)d[0].focus();else{if(e.buttons)for(a in e.buttons){(a=x(e.buttons[a],l).shift())&&a.focus();break}}else(a=x(d,l).shift())&&a.focus()}},!0,!1);C(f,k,{init:function(){n.register(f);
e.modal&&(e.overlay.enabled=!0);f.setPositionType();f.setTarget(e.target);if(e.pointer.size||e.pointer.el)v=new F(f,e.pointer);e.render.lazy||f.render();f.setHandlers("bind")},setHandlers:function(d,a){for(var b=["show","hide","toggle"],c="bind"==d?A:B,h="bind"==d?ea:fa,m,p,n,q,r,v,t,s,u,y;m=b.shift();)if(p=e[m].events,!1!==p){if(z(p)||"object"==typeof p&&5===M(p))g.dynamicTarget?(r={},r[p]=e.target,p={_html:r}):p={_target:p};for(n in p){if(a)if("_self"==a){if("_self"!=n&&"_overlay"!=n&&">"!=n.substr(0,
1))continue}else if(n!=a)continue;if("_self"!=n&&"_overlay"!=n&&">"!=n.substr(0,1)||l){if(t=p[n]){switch(n){case "_target":s=[f.getTarget()];break;case "_self":s=[l];break;case "_window":s=[window];break;case "_document":s=[window.document];break;case "_html":s=[window.document.documentElement];break;case "_overlay":s=[w];break;default:s=">"==n.substr(0,1)?x(n.substr(1),l):x(n)}if(s&&s.length)if(z(t)&&(t=[t]),"object"==typeof t&&5===M(t))for(r=0,v=t.length;r<v;r++)for(u=-1,y=s.length;++u<y;c(s[u],
t[r],k[m]));else for(q in t)for(u=-1,y=s.length;++u<y;h(s[u],t[q],q,k[m]));}}else g.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var d=g.dynamicTargetEl;d&&(f.setHandlers("unbind","_target"),f.trigger("targetchange",k,null,d))},isDynamicTargetChanged:function(d){var a=e.target;d=d.target;for(var b=g.dynamicTargetEl;d&&!U(d,a);)d=d.parentNode;return d?!b||b!==d:!1},changeDynamicTarget:function(d){var a=e.target;d=d.target;for(var b=g.dynamicTargetEl;d&&!U(d,a);)d=d.parentNode;if(!d||b&&b===
d)return!1;b&&f.setHandlers("unbind","_target");g.dynamicTargetEl=d;f.setHandlers("bind","_target");f.trigger("targetchange",k,d,b);return!0},showAfterDelay:function(d,a){g.showDelay=null;if(g.visible){e.position.manual||f.reposition(d);"mouse"==g.position&&A(window.document.documentElement,"mousemove",f.onMouseMove);var b=e.position;(b.resize||b.screenX||b.screenY)&&A(window,"resize",f.onWindowResize);(b.scroll||b.screenX||b.screenY)&&A(window,"scroll",f.onWindowScroll);if(a||!1!==f.trigger("afterdelay",
k,d)){w&&(e.overlay.animateShow?f.animate("show",null,!0):w.style.display="");if(e.show.preventScroll){var b=e.show.preventScroll,c,h;!0===b&&(b="body");b=x(b);c=-1;for(h=b.length;++c<h;A(b[c],"mousewheel",f.onPreventScroll)&&A(b[c],"touchmove",f.onPreventScroll));}e.show.animate&&!a?f.animate("show").done(function(){f.showAfterAnimation(d)}):f.showAfterAnimation(d)}else g.visible=!1,e.debug&&console.log("showAfterDelay: afterdelay returned false",k.getTarget())}else e.debug&&console.log("showAfterDelay: already hidden",
f.getTarget())},showAfterAnimation:function(d){g.visible?(T(l,e.cls.hidden),E(l,e.cls.visible),e.render.keepVisible||(l.style.display=""),e.hide.timeout&&(g.hideTimeout=window.setTimeout(f.hide,e.hide.timeout)),e.show.focus&&window.setTimeout(f.setFocus,20),f.trigger("show",k,d)):e.debug&&console.log("showAfterAnimation: already hidden",f.getTarget())},hideAfterDelay:function(d,a){g.hideDelay=null;if(g.visible)e.debug&&console.log("hideAfterDelay: already shown again",f.getTarget());else{"mouse"==
g.position&&B(window.document.documentElement,"mousemove",f.onMouseMove);var b=e.position;(b.resize||b.screenX||b.screenY)&&B(window,"resize",f.onWindowResize);(b.scroll||b.screenX||b.screenY)&&B(window,"scroll",f.onWindowScroll);if(a||!1!==f.trigger("afterhidedelay",k,d)){if(e.show.preventScroll){var b=e.show.preventScroll,c,h;!0===b&&(b="body");b=x(b);c=-1;for(h=b.length;++c<h;B(b[c],"mousewheel",f.onPreventScroll)&&B(b[c],"touchmove",f.onPreventScroll));}w&&(e.overlay.animateShow?f.animate("hide",
null,!0).done(function(){w.style.display="none"}):w.style.display="none");e.hide.animate&&!a?f.animate("hide").done(function(){f.hideAfterAnimation(d)}):f.hideAfterAnimation(d)}else g.visible=e.cls.hidden?!S(l,e.cls.hidden):!(0>=l.offsetWidth||0>=l.offsetHeight),e.debug&&console.log("hideAfterDelay: afterhdelay returned false",f.getTarget())}},hideAfterAnimation:function(d){g.visible?e.debug&&console.log("hideAfterAnimation: already shown again",f.getTarget()):(T(l,e.cls.visible),E(l,e.cls.hidden),
e.render.keepVisible||(l.style.display="none"),f.trigger("hide",k,d),d=e.render.lifetime,null!==d&&(0===d?f.destroyElem():g.destroyDelay=window.setTimeout(f.destroyElem,d)),l&&e.hide.destroy&&window.setTimeout(function(){D(l,e.instanceName,null);f.destroy()},0))},render:function(){if(l)e.debug&&console.log("element already rendered",l);else{var d=e.render,b=e.cls;if(d.fn){var c=d.fn.call(t,k);d[z(c)?"tpl":"el"]=c}d.el?z(d.el)?(l=x(d.el).shift(),d.keepInDOM=!0):l=d.el:(c=window.document.createElement("div"),
c.innerHTML=d.tpl,l=c.firstChild);l||(l=window.document.createElement("div"));d.id&&l.setAttribute("id",d.id);e.render.keepVisible||(l.style.display="none");E(l,b.dialog);E(l,b.hidden);d.style&&a(l,d.style);e.overlay.enabled&&(w=window.document.createElement("div"),a(w,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:e.overlay.opacity,backgroundColor:e.overlay.color}),window.document.body.appendChild(w),A(w,"click",f.onOverlayClick),d.zIndex&&a(w,{zIndex:d.zIndex}),e.overlay.cls&&
E(w,e.overlay.cls));d.appendTo?d.appendTo.appendChild(l):!1!==d.appendTo&&window.document.body.appendChild(l);d.zIndex&&a(l,{zIndex:d.zIndex});d=e.content;if(!1!==d.value)if(d.value)f.setContent(d.value);else if(d.fn)f.setContent(d.fn.call(t,k));else f[e.ajax.url?"loadContent":"readContent"]();v&&v.render();if(e.buttons)for(var h in e.buttons)if(d=x(e.buttons[h],l).shift())D(d,"metaphorjsTooltip-button-id",h),A(d,"click",f.onButtonClick),A(d,"keyup",f.onButtonKeyup);g.bindSelfOnRender&&(f.setHandlers("bind",
"_self"),g.bindSelfOnRender=!1);g.rendered=!0;f.trigger("render",k)}},animate:function(d,a,b){var c,h;c=b?"show"==d?e.overlay.animateShow:e.overlay.animateHide:e[d].animate;"function"==typeof c&&(c=c(f,a));h=c.skipDisplayChange||!1;R(c)?c=d:z(c)&&(c=[c]);return Y(l,c,function(){"show"!=d||h||(b?w.style.display="":l.style.display="")})},toggleTitleAttribute:function(d){var a=k.getTarget(),b;a&&(!1===d?(D(a,"tmp-title",I(a,"title")),a.removeAttribute("title")):(b=D(a,"tmp-title"))&&a.setAttribute("title",
b))},changeDynamicContent:function(){e.content.fn?f.setContent(e.content.fn.call(t,k)):e.content.attr&&f.readContent()},getDialogSize:function(){var d=e.cls.hidden?S(l,e.cls.hidden):!!(0>=l.offsetWidth||0>=l.offsetHeight),b,f=l.style.left;d&&(a(l,{left:"-1000px"}),l.style.display="");b={width:J(l),height:K(l)};d&&(a(l,{left:f}),l.style.display="none");return b},getTargetSize:function(){var a=f.getTarget();return a?{width:J(a),height:K(a)}:null},getTargetPosition:function(a,b){var c=f.getTarget();
if(!c)return null;var h=f.getDialogSize();var k={top:0,left:0},g=window.document.documentElement;ia(c)&&c!==window?(c.getBoundingClientRect&&(k=c.getBoundingClientRect()),c={top:k.top+V()-g.clientTop,left:k.left+W()-g.clientLeft}):c=k;k=f.getTargetSize();g={};b=b||e.position.type;var l=b.substr(0,1),p=b.substr(1),m=e.position.offsetX,n=e.position.offsetY,q=v?v.getDialogPositionOffset():null;switch(l){case "t":g.y=c.top-h.height-n;break;case "r":g.x=c.left+k.width+m;break;case "b":g.y=c.top+k.height+
n;break;case "l":g.x=c.left-h.width-m}switch(p){case "t":g.y=c.top+n;break;case "r":g.x=c.left+k.width-h.width-m;break;case "b":g.y=c.top+k.height-h.height-n;break;case "l":g.x=c.left+m;break;case "rc":g.x=c.left+k.width+m;break;case "lc":g.x=c.left-h.width-m;break;case "":switch(l){case "t":case "b":g.x=c.left+k.width/2-h.width/2;break;case "r":case "l":g.y=c.top+k.height/2-h.height/2}}q&&(g.x+=q.x,g.y+=q.y);return g},getMousePosition:function(a){if(!a)return null;var b=f.getDialogSize(),c={},h=
e.position.type.substr(1),g=e.position.offsetX,l=e.position.offsetY,m=e.position.axis,n=v?v.getDialogPositionOffset():null;switch(h){case "":c=e.position.get.call(t,k,a);break;case "t":c.y=a.pageY-b.height-l;c.x=a.pageX-b.width/2;break;case "r":c.y=a.pageY-b.height/2;c.x=a.pageX+g;break;case "b":c.y=a.pageY+l;c.x=a.pageX-b.width/2;break;case "l":c.y=a.pageY-b.height/2;c.x=a.pageX-b.width-g;break;case "rt":c.y=a.pageY-b.height-l;c.x=a.pageX+g;break;case "rb":c.y=a.pageY+l;c.x=a.pageX+g;break;case "lt":c.y=
a.pageY-b.height-l;c.x=a.pageX-b.width-g;break;case "lb":c.y=a.pageY+l,c.x=a.pageX-b.width-g}n&&(c.x+=n.x,c.y+=n.y);m&&(a=f.getTargetPosition(a,h))&&("x"==m?c.y=a.y:c.x=a.x);return c},getWindowPosition:function(){var a=f.getDialogSize(),b={},c=e.position.type.substr(1),g=e.position.offsetX,h=e.position.offsetY,k=V(),l=W(),m=J(window),n=K(window);switch(c){case "c":b.y=n/2-a.height/2+k;b.x=m/2-a.width/2+l;break;case "t":b.y=k+h;b.x=m/2-a.width/2+l;break;case "r":b.y=n/2-a.height/2+k;b.x=m-a.width+
l-g;break;case "b":b.y=n-a.height+k-h;b.x=m/2-a.width/2+l;break;case "l":b.y=n/2-a.height/2+k;b.x=l+g;break;case "rt":b.y=k+h;b.x=m-a.width+l-g;break;case "rb":b.y=n-a.height+k-h;b.x=m-a.width+l-g;break;case "lt":b.y=k+h;b.x=l+g;break;case "lb":b.y=n-a.height+k-h,b.x=l+g}return b},correctScreenPosition:function(a,b,c){var e=f.getDialogSize(),g=V(),h=W(),k=J(window),l=K(window);c&&a.y+e.height>l+g-c&&(a.y=l+g-c-e.height);b&&a.x+e.width>k+h-b&&(a.x=k+h-b-e.width);c&&a.y<g+c&&(a.y=g+c);b&&a.x<h+b&&(a.x=
h+b);return a},onMouseMove:function(a){f.reposition(y(a))},onWindowResize:function(a){f.reposition(y(a))},onWindowScroll:function(a){f.reposition(y(a))},onPreventScroll:function(a){y(a).preventDefault()},onOverlayClick:function(a){return e.modal?(a=y(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=y(a).target;(b=D(b,"metaphorjsTooltip-button-id"))&&f.trigger("button",k,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=D(a.target,"metaphorjsTooltip-button-id");
b&&f.trigger("button",k,b,y(a))}},onAjaxLoad:function(a){T(l,e.cls.loading);f.setContent(a,"ajax")},onImageLoad:function(){g.images--;f.onContentChange()},onContentChange:function(){g.visible&&f.reposition()},destroyElem:function(){f.setHandlers("unbind","_self");g.bindSelfOnRender=!0;v&&v.remove();w&&(w.parentNode.removeChild(w),w=null);l&&(e.render.keepInDOM||l.parentNode.removeChild(l),l=null);f.trigger("lifetime",k)}},!0,!1);delete e.callback.scope;for(var s in e.callback)k.on(s,e.callback[s],
t);e.target&&e.useHref&&(s=I(e.target,"href"),"#"==s.substr(0,1)?e.render.el=s:e.ajax.url=s);f.init();return k};C(u,{defaults:{}});return u}();window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(a,b,c){var h="dialog",m;"string"==typeof a&&"destroy"!=a&&(m=a,a=b,b=c);a=a||{};h+="-"+(b||"default");this.each(function(){var b=D(this,h);if(b)if("destroy"==a)b.destroy(),D(this,h,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else a.target=this,a.instanceName=h,
D(this,h,new ba(m,a))})});return ba});
