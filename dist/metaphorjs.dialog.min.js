(function(){var p=window.MetaphorJs,C=p.extend,U=p.nextUid,P=p.hasClass,D=p.addClass,J=p.removeClass,Q=p.isArray,K=p.toArray,z=p.addListener,A=p.removeListener,v=p.data,V=p.trim,B=p.normalizeEvent,W=p.ajax||$.ajax,X=p.lib.Observable,Y=p.animate,F=function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},u=function(e,c){var b=e.style,f;for(f in c)b[f]=c[f]},r=function(e){var c;c=L();var b=M();if(e===window)b=document.documentElement,c={left:0,right:b.clientWidth,top:c,bottom:b.clientHeight+c,width:b.clientWidth,
height:b.clientHeight};else if(e.getBoundingClientRect)e=e.getBoundingClientRect(),c={left:e.left+b,top:e.top+c,right:e.right+b,bottom:e.bottom+c},c.width=c.right-c.left,c.height=c.bottom-c.top;else{var f=e.style;c={left:(parseInt(f.left,10)||0)+b,top:(parseInt(f.top,10)||0)+c,width:e.offsetWidth,height:e.offsetHeight,right:0,bottom:0}}c.getCenter=function(){return this.width/2};c.getCenterX=function(){return this.left+this.width/2};return c},L=function(){if("undefined"!=typeof window.pageYOffset)return window.pageYOffset;
var e=document.body,c=document.documentElement;return(c.clientHeight?c:e).scrollTop},M=function(){if("undefined"!=typeof window.pageXOffset)return window.pageXOffset;var e=document.body,c=document.documentElement;return(c.clientWidth?c:e).scrollLeft},w=function(e,c){c=c||document;var b;if(c.querySelectorAll)try{return K(c.querySelectorAll(e))}catch(f){}if(window.jQuery)return $(e,c).toArray();e=V(e);if(-1!=e.indexOf(" "))b="Cannot use selector "+e;else return b=e.substr(0,1),"#"==b?[document.getElementById(e.substr(1))]:
"."==b?K(c.getElementsByClassName(e.substr(1))):K(c.getElementsByTagName(e));if(b)throw b;return[]},N=function(e,c){var b,f,m;try{for(b=w(c,e.parentNode),f=-1,m=b.length;++f<m;)if(b[f]===e)return!0}catch(k){}return!b&&window.jQuery?$(e).is(c):!1},I={},Z=function(e,c,b,f){var m=c+"-"+b,k=function(b){b=B(b);return N(b.target,c)?f(b):null};I[m]||(I[m]=[]);I[m].push({el:e,ls:k,fn:f});z(e,b,k)},aa=function(e,c,b,f){var m,k;if(k=I[c+"-"+b])for(c=-1,m=k.length;++c<m;)k[c].el===e&&k[c].fn===f&&A(e,b,k[c].ls)},
E={t:"b",r:"l",b:"t",l:"r"},s={t:"top",r:"right",b:"bottom",l:"left"},R={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},ba=document.all&&!window.XMLHttpRequest,S=function(){var e={},c={};return{register:function(b){var f=b.getInstanceId(),m=b.getGroup(),k,d,n;e[f]=b;k=0;for(d=m.length;k<d;k++)n=m[k],c[n]||(c[n]={}),c[n][f]=!0;b.on("destroy",this.unregister,this)},unregister:function(b){b=b.getInstanceId();delete e[b]},hideAll:function(b){var f=b.getInstanceId();b=b.getGroup();var m,k,d,n;m=0;for(k=
b.length;m<k;m++)for(n in d=b[m],d=c[d],d)e[n]?n==f||e[n].isHideAllIgnored()||e[n].hide(null,!0,!0):delete d[n]}}}(),T=function(e,c,b){var f,m=this,k,d={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},n=c.size,g=c.width||2*n;C(m,{init:function(){c.border&&m.createInner()},getEl:function(){return f},getDialogPositionOffset:function(){var b=(m.detectPointerPosition()||"").substr(0,1),d=(e.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,
1),c={x:0,y:0};b==E[d]&&(c["t"==b||"b"==b?"y":"x"]="b"==b||"r"==b?-n:n);return c},createInner:function(){var b=C({},c);b.size=n-2*c.border;b.width=g-4*c.border;delete b.border;delete b.borderColor;delete b.borderCls;delete b.offset;k=new T(e,b,c.border)},detectPointerPosition:function(){if(c.position)return c.position;var b=(e.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return b?E[b]:null},detectPointerDirection:function(b){return c.direction?c.direction:b},getBorders:function(b,
d,c){var f={},a=b.substr(0,1);b=d.substr(0,1);var G=d.substr(1);d=ba?"dotted":"solid";f["border"+F(s[E[a]])]=n+"px solid "+c;f["border"+F(s[a])]="0 "+d+" transparent";G?(f["border"+F(s[G])]="0 solid transparent",f["border"+F(s[E[G]])]=g+"px "+d+" transparent"):(c=Math.floor(g/2),f["border"+F(s[R[b][0]])]=c+"px "+d+" transparent",f["border"+F(s[R[b][1]])]=c+"px "+d+" transparent");return f},getOffsets:function(d,e){var h={},k=d.substr(0,1),a="t"==k||"b"==k?"r":"b";if(!n)switch(document.body.appendChild(f),
k){case "t":case "b":n=r(f).height;g=r(f).width;break;case "l":case "r":g=r(f).height,n=r(f).width}h[s[k]]=b?"auto":-n+"px";h[s[a]]="auto";if(b){var k=e.substr(0,1),G=e.substr(1);h[s[E[a]]]=G?"l"==G||"t"==G?b+"px":-g-b+"px":Math.floor(-g/2)+"px";h[s[E[k]]]=-(n+2*b)+"px"}else{switch(d){case "t":case "r":case "b":case "l":k=e!=d?"l"==e||"t"==e?c.offset:-g+c.offset:-g/2+c.offset;break;case "bl":case "tl":case "lt":case "rt":k=c.offset;break;default:k=-g-c.offset}h["margin"+F(s[E[a]])]=k+"px";switch(d){case "t":case "r":case "b":case "l":k=
"50%";break;case "tr":case "rb":case "br":case "lb":k="100%";break;default:k=0}h[s[E[a]]]=k}return h},render:function(){if(!f){var g=m.detectPointerPosition();if(g)if(c.el){if("string"==typeof c.el){var n=document.createElement("div");n.innerHTML=c.el;f=n.firstChild}else f=c.el;u(f,{position:"absolute"});u(f,m.getOffsets(g));D(f,c.cls);e.getElem().appendChild(f)}else{n=m.detectPointerDirection(g);f=document.createElement("div");var h=document.createComment(" ");f.appendChild(h);u(f,d);u(f,m.getBorders(g,
n,c.borderColor||c.color));u(f,m.getOffsets(g,n));D(f,c.borderCls||c.cls);k&&(k.render(),f.appendChild(k.getEl()));b||e.getElem().appendChild(f)}}},destroy:function(){m.remove();k=m=null},remove:function(){k&&k.remove();f&&(f.parentNode.removeChild(f),f=null)}});m.init();return m},O=function(e){if(!e)return{};var c=function(b,c,m){var k=e[b],d=!1;if(void 0!==k){switch(m){case "string":d="string"==typeof k;break;case "function":d="function"==typeof k;break;case "number":d="number"==typeof k||k==parseInt(k);
break;case "dom":d=k&&(k.tagName||k.nodeName)?!0:!1;break;case "jquery":(d=k&&k.jquery?!0:!1)&&(k=k.get(0));break;case "boolean":if(!0===k||!1===k)d=!0;break;default:!0===m&&!0===k&&(d=!0),!1===m&&!1===k&&(d=!0)}d&&(e[b]={},e[b][c]=k)}};c("content","value","string");c("content","value","boolean");c("content","fn","function");c("ajax","url","string");c("cls","dialog","string");c("render","tpl","string");c("render","fn","function");c("render","el","dom");c("render","el","jquery");c("show","events",
!1);c("show","events","string");c("hide","events",!1);c("hide","events","string");c("toggle","events",!1);c("toggle","events","string");c("position","type","string");c("position","type",!1);c("position","get","function");c("overlay","enabled","boolean");c("pointer","position","string");c("pointer","size","number");return e},ca={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,
visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},
position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},H=function(e,c){e&&"string"!=
typeof e&&(c=e,e=null);c=c||{};var b=this,f={},m=U(),k=new X,d=C({},ca,O(H.defaults),O(H[e]),O(c),!0),n=d.callback.scope||f,g,q,t,h={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};c=null;C(f,k.getApi(),{getElem:function(){return g},getInstanceId:function(){return m},getCfg:function(){return C({},d)},getGroup:function(){return d.group?"string"==
typeof d.group?[d.group]:d.group:[""]},setTarget:function(a){if(!a)return f;var d=!1,l=h.target;h.target?(b.setHandlers("unbind","_target"),d=!0):h.dynamicTarget&&(d=!0);"string"==typeof a?(h.dynamicTarget=!0,h.target=null):(h.dynamicTarget=!1,h.target=a);d&&(b.setHandlers("bind","_target"),b.trigger("targetchange",f,a,l));return f},getTarget:function(){return h.dynamicTarget?h.dynamicTargetEl:d.target},isEnabled:function(){return h.enabled},isVisible:function(){return h.visible},isHideAllIgnored:function(){return d.show.ignoreHideAll},
isFrozen:function(){return h.frozen},enable:function(){h.enabled=!0;return f},disable:function(){b.hide();h.enabled=!1;return f},freeze:function(){h.frozen=!0;return f},unfreeze:function(){h.frozen=!1;return f},toggle:function(a,d){return a&&a.stopPropagation&&h.dynamicTarget&&h.visible&&b.isDynamicTargetChanged(a)?b.show(a):b[h.visible?"hide":"show"](a,d)},show:function(a,c){var l=a&&a.stopPropagation?null:f,e=d.show;if(!f.isEnabled())return d.debug&&console.log("show: not enabled",f.getTarget()),
l;a&&a.stopPropagation&&d.events.show&&d.events.show[a.type]&&(l=d.events.show[a.type],l.process?l=l.process(f,a):(l.stopPropagation&&a.stopPropagation(),l.preventDefault&&a.preventDefault(),l=l.returnValue));if(h.visible&&h.hideTimeout)return window.clearTimeout(h.hideTimeout),h.hideTimeout=window.setTimeout(b.hide,d.hide.timeout),d.debug&&console.log("show: hide timeout was set",f.getTarget()),l;if(h.hideDelay)return window.clearTimeout(h.hideDelay),h.hideDelay=null,h.visible=!0,d.debug&&console.log("show: hide delay was set; already shown",
f.getTarget()),l;if(h.frozen)return d.debug&&console.log("show: frozen",f.getTarget()),l;h.destroyDelay&&(window.clearTimeout(h.destroyDelay),h.destroyDelay=null);var k=!1;a&&a.stopPropagation&&h.dynamicTarget&&(k=b.changeDynamicTarget(a));if(h.visible)if(k)if(d.render.fn)b.hide(null,!0);else return b.reposition(a),l;else return d.debug&&console.log("show: already shown",g),l;g?k&&b.changeDynamicContent():b.render();if(!1===b.trigger("beforeshow",f,a))return d.debug&&console.log("show: beforeshow return false",
f.getTarget()),l;h.visible=!0;e.single&&S.hideAll(b);b.toggleTitleAttribute(!1);e.delay&&!c?h.showDelay=window.setTimeout(function(){b.showAfterDelay(a)},e.delay):b.showAfterDelay(a,c);return l},hide:function(a,c,l){h.hideTimeout=null;var e=a&&a.stopPropagation?null:f;a&&a.stopPropagation&&d.events.hide&&d.events.hide[a.type]&&(e=d.events.hide[a.type],e.process?e=e.process(f,a):(e.stopPropagation&&a.stopPropagation(),e.preventDefault&&a.preventDefault(),e=e.returnValue));!h.visible&&h.hideDelay&&
c&&(window.clearTimeout(h.hideDelay),h.hideDelay=null,h.visible=!0);if(!g||!h.visible||!b.isEnabled())return d.debug&&console.log("hide: elem/visible/enabled: ",g,h.visible,b.isEnabled()),e;if(h.showDelay)return d.hide.cancelShowDelay||l?(window.clearTimeout(h.showDelay),h.showDelay=null,h.visible=!1,d.debug&&console.log("hide: cancelShowDelay: ",b.getTarget())):d.debug&&console.log("hide: show delay was set",b.getTarget()),e;if(h.frozen)return d.debug&&console.log("hide: frozen",b.getTarget()),e;
if(!1===b.trigger("beforehide",f,a))return d.debug&&console.log("hide: beforehide returned false",b.getTarget()),e;h.visible=!1;b.toggleTitleAttribute(!0);h.dynamicTarget&&b.resetDynamicTarget();d.hide.delay&&!c?h.hideDelay=window.setTimeout(function(){b.hideAfterDelay(a)},d.hide.delay):b.hideAfterDelay(a,c);return e},setPositionType:function(a){a&&("function"==typeof a?(d.position.get=a,d.position.type=!1):(d.position.get=null,d.position.type=a));a=d.position.type;!1===a?h.position=!1:d.position.get&&
"m"!=a?h.position="fn":(a=a.substr(0,1),h.position="w"==a?"window":"m"==a?"mouse":"target");q&&(q.remove(),g&&q.render())},getPosition:function(a){if(!g)return null;var c,l=d.position;switch(h.position){case !1:return null;case "target":c=b.getTargetPosition(a);break;case "mouse":c=b.getMousePosition(a);break;case "window":c=b.getWindowPosition(a);break;case "fn":c=l.get.call(n,f,a)}if(!1!==l.screenX||!1!==l.screenY)c=b.correctScreenPosition(c,l.screenX,l.screenY);return c},reposition:function(a){a&&
(a=B(a));if(a=b.getPosition(a))void 0!=a.x&&u(g,{left:a.x+"px"}),void 0!=a.y&&u(g,{top:a.y+"px"}),void 0==a.x&&void 0==a.y&&u(g,a)},getContentElem:function(){return g?d.selector.content?w(d.selector.content,g).shift()||g:g:null},setContent:function(a,c){c=c||"";if(!g)return d.content.value=a,f;d.content.prepare&&(a=d.content.prepare(f,c,a));var l=f.getContentElem(),e=h.rendered&&!d.selector.content&&q,k=e&&q.getEl();if(e&&k)try{g.removeChild(k)}catch(da){}if("string"!=typeof a)for(var m in a){var n=
d.selector[m];n&&(n=w(n,l).shift())&&(n.innerHTML=a[m])}else l.innerHTML=a;if(e&&k)try{g.appendChild(k)}catch(p){}l=w("img",l);h.images=l.length;m=-1;for(e=l.length;++m<e;z(l[m],"load",b.onImageLoad));b.trigger("contentchange",f,a,c);b.onContentChange();return f},readContent:function(){var a=f.getTarget(),c;a&&(c=d.content.attr?a.getAttribute(d.content.attr):a.getAttribute("tooltip")||a.getAttribute("title")||a.getAttribute("alt"));c&&b.setContent(c,"attribute");return f},loadContent:function(a){D(g,
d.cls.loading);a=C({},d.ajax,a,!0);b.trigger("beforeajax",f,a);return W(a).done(b.onAjaxLoad)},destroy:function(){b.trigger("destroy",f);A(window,"resize",b.onWindowResize);A(window,"scroll",b.onWindowScroll);b.destroyElem();q&&(q.destroy(),q=null);b.setHandlers("unbind");k.destroy();t=h=f=b=k=null},setFocus:function(){var a=d.show.focus,b;if(!0===a)if(a=w("input",g).concat(w("textarea",g)),0<a.length)a[0].focus();else{if(d.buttons)for(b in d.buttons){(b=w(d.buttons[b],g).shift())&&b.focus();break}}else(b=
w(a,g).shift())&&b.focus()}});C(b,f,{init:function(){S.register(b);d.modal&&(d.overlay.enabled=!0);b.setPositionType();b.setTarget(d.target);if(d.pointer.size||d.pointer.el)q=new T(b,d.pointer);d.render.lazy||b.render();b.setHandlers("bind")},setHandlers:function(a,c){for(var l=["show","hide","toggle"],e="bind"==a?z:A,k="bind"==a?Z:aa,m,n,x,p,q,u,r,y,s,v;m=l.shift();)if(n=d[m].events,!1!==n){if("string"==typeof n||Q(n))h.dynamicTarget?(q={},q[n]=d.target,n={_html:q}):n={_target:n};for(x in n){if(c)if("_self"==
c){if("_self"!=x&&"_overlay"!=x&&">"!=x.substr(0,1))continue}else if(x!=c)continue;if("_self"!=x&&"_overlay"!=x&&">"!=x.substr(0,1)||g){if(r=n[x]){switch(x){case "_target":y=[b.getTarget()];break;case "_self":y=[g];break;case "_window":y=[window];break;case "_document":y=[document];break;case "_html":y=[document.documentElement];break;case "_overlay":y=[t];break;default:y=">"==x.substr(0,1)?w(x.substr(1),g):w(x)}if(y&&y.length)if("string"==typeof r&&(r=[r]),Q(r))for(q=0,u=r.length;q<u;q++)for(s=-1,
v=y.length;++s<v;e(y[s],r[q],f[m]));else for(p in r)for(s=-1,v=y.length;++s<v;k(y[s],r[p],p,f[m]));}}else h.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var a=h.dynamicTargetEl;a&&(b.setHandlers("unbind","_target"),b.trigger("targetchange",f,null,a))},isDynamicTargetChanged:function(a){var b=d.target;a=a.target;for(var c=h.dynamicTargetEl;a&&!N(a,b);)a=a.parentNode;return a?!c||c!==a:!1},changeDynamicTarget:function(a){var c=d.target;a=a.target;for(var l=h.dynamicTargetEl;a&&!N(a,c);)a=a.parentNode;
if(!a||l&&l===a)return!1;l&&b.setHandlers("unbind","_target");h.dynamicTargetEl=a;b.setHandlers("bind","_target");b.trigger("targetchange",f,a,l);return!0},showAfterDelay:function(a,c){h.showDelay=null;if(h.visible){d.position.manual||b.reposition(a);"mouse"==h.position&&z(document.documentElement,"mousemove",b.onMouseMove);var l=d.position;(l.resize||l.screenX||l.screenY)&&z(window,"resize",b.onWindowResize);(l.scroll||l.screenX||l.screenY)&&z(window,"scroll",b.onWindowScroll);if(c||!1!==b.trigger("afterdelay",
f,a)){t&&(d.overlay.animateShow?b.animate("show",null,!0):t.style.display="");if(d.show.preventScroll){var l=d.show.preventScroll,e,g;!0===l&&(l="body");l=w(l);e=-1;for(g=l.length;++e<g;z(l[e],"mousewheel",b.onPreventScroll)&&z(l[e],"touchmove",b.onPreventScroll));}d.show.animate&&!c?b.animate("show").done(function(){b.showAfterAnimation(a)}):b.showAfterAnimation(a)}else h.visible=!1,d.debug&&console.log("showAfterDelay: afterdelay returned false",f.getTarget())}else d.debug&&console.log("showAfterDelay: already hidden",
b.getTarget())},showAfterAnimation:function(a){h.visible?(J(g,d.cls.hidden),D(g,d.cls.visible),d.render.keepVisible||(g.style.display=""),d.hide.timeout&&(h.hideTimeout=window.setTimeout(b.hide,d.hide.timeout)),d.show.focus&&window.setTimeout(b.setFocus,20),b.trigger("show",f,a)):d.debug&&console.log("showAfterAnimation: already hidden",b.getTarget())},hideAfterDelay:function(a,c){h.hideDelay=null;if(h.visible)d.debug&&console.log("hideAfterDelay: already shown again",b.getTarget());else{"mouse"==
h.position&&A(document.documentElement,"mousemove",b.onMouseMove);var l=d.position;(l.resize||l.screenX||l.screenY)&&A(window,"resize",b.onWindowResize);(l.scroll||l.screenX||l.screenY)&&A(window,"scroll",b.onWindowScroll);if(c||!1!==b.trigger("afterhidedelay",f,a)){if(d.show.preventScroll){var l=d.show.preventScroll,e,k;!0===l&&(l="body");l=w(l);e=-1;for(k=l.length;++e<k;A(l[e],"mousewheel",b.onPreventScroll)&&A(l[e],"touchmove",b.onPreventScroll));}t&&(d.overlay.animateShow?b.animate("hide",null,
!0).done(function(){t.style.display="none"}):t.style.display="none");d.hide.animate&&!c?b.animate("hide").done(function(){b.hideAfterAnimation(a)}):b.hideAfterAnimation(a)}else h.visible=d.cls.hidden?!P(g,d.cls.hidden):!(0>=g.offsetWidth||0>=g.offsetHeight),d.debug&&console.log("hideAfterDelay: afterhdelay returned false",b.getTarget())}},hideAfterAnimation:function(a){h.visible?d.debug&&console.log("hideAfterAnimation: already shown again",b.getTarget()):(J(g,d.cls.visible),D(g,d.cls.hidden),d.render.keepVisible||
(g.style.display="none"),b.trigger("hide",f,a),a=d.render.lifetime,null!==a&&(0===a?b.destroyElem():h.destroyDelay=window.setTimeout(b.destroyElem,a)),g&&d.hide.destroy&&window.setTimeout(function(){v(g,d.instanceName,null);b.destroy()},0))},render:function(){if(g)d.debug&&console.log("element already rendered",g);else{var a=d.render,c=d.cls;if(a.fn){var l=a.fn.call(n,f);a["string"==typeof l?"tpl":"el"]=l}a.el?"string"==typeof a.el?(g=w(a.el).shift(),a.keepInDOM=!0):g=a.el:(l=document.createElement("div"),
l.innerHTML=a.tpl,g=l.firstChild);g||(g=document.createElement("div"));a.id&&g.setAttribute("id",a.id);d.render.keepVisible||(g.style.display="none");D(g,c.dialog);D(g,c.hidden);a.style&&u(g,a.style);d.overlay.enabled&&(t=document.createElement("div"),u(t,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:d.overlay.opacity,backgroundColor:d.overlay.color}),document.body.appendChild(t),z(t,"click",b.onOverlayClick),a.zIndex&&u(t,{zIndex:a.zIndex}),d.overlay.cls&&D(t,d.overlay.cls));
a.appendTo?a.appendTo.appendChild(g):!1!==a.appendTo&&document.body.appendChild(g);a.zIndex&&u(g,{zIndex:a.zIndex});a=d.content;if(!1!==a.value)if(a.value)b.setContent(a.value);else if(a.fn)b.setContent(a.fn.call(n,f));else b[d.ajax.url?"loadContent":"readContent"]();q&&q.render();if(d.buttons)for(var e in d.buttons)if(a=w(d.buttons[e],g).shift())v(a,"metaphorjsTooltip-button-id",e),z(a,"click",b.onButtonClick),z(a,"keyup",b.onButtonKeyup);h.bindSelfOnRender&&(b.setHandlers("bind","_self"),h.bindSelfOnRender=
!1);h.rendered=!0;b.trigger("render",f)}},animate:function(a,c,l){var e;e=l?"show"==a?d.overlay.animateShow:d.overlay.animateHide:d[a].animate;"function"==typeof e&&(e=e(b,c));"boolean"==typeof e?e=a:"string"==typeof e&&(e=[e]);return Y(g,e,function(){"show"==a&&(l?t.style.display="":g.style.display="")})},toggleTitleAttribute:function(a){var b=f.getTarget(),d;b&&(!1===a?(v(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(d=v(b,"tmp-title"))&&b.setAttribute("title",d))},changeDynamicContent:function(){d.content.fn?
b.setContent(d.content.fn.call(n,f)):d.content.attr&&b.readContent()},getDialogSize:function(){var a=d.cls.hidden?P(g,d.cls.hidden):!!(0>=g.offsetWidth||0>=g.offsetHeight),b,c=g.style.left;a&&(u(g,{left:"-1000px"}),g.style.display="");b={width:r(g).width,height:r(g).height};a&&(u(g,{left:c}),g.style.display="none");return b},getTargetSize:function(){var a=b.getTarget();return a?{width:r(a).width,height:r(a).height}:null},getTargetPosition:function(a,c){var e=b.getTarget();if(!e)return null;var f=
b.getDialogSize(),e=r(e),h=b.getTargetSize(),g={};c=c||d.position.type;var k=c.substr(0,1),n=c.substr(1),m=d.position.offsetX,p=d.position.offsetY,s=q?q.getDialogPositionOffset():null;switch(k){case "t":g.y=e.top-f.height-p;break;case "r":g.x=e.left+h.width+m;break;case "b":g.y=e.top+h.height+p;break;case "l":g.x=e.left-f.width-m}switch(n){case "t":g.y=e.top+p;break;case "r":g.x=e.left+h.width-f.width-m;break;case "b":g.y=e.top+h.height-f.height-p;break;case "l":g.x=e.left+m;break;case "rc":g.x=e.left+
h.width+m;break;case "lc":g.x=e.left-f.width-m;break;case "":switch(k){case "t":case "b":g.x=e.left+h.width/2-f.width/2;break;case "r":case "l":g.y=e.top+h.height/2-f.height/2}}s&&(g.x+=s.x,g.y+=s.y);return g},getMousePosition:function(a){if(!a)return null;var c=b.getDialogSize(),e={},g=d.position.type.substr(1),h=d.position.offsetX,k=d.position.offsetY,m=d.position.axis,p=q?q.getDialogPositionOffset():null;switch(g){case "":e=d.position.get.call(n,f,a);break;case "t":e.y=a.pageY-c.height-k;e.x=a.pageX-
c.width/2;break;case "r":e.y=a.pageY-c.height/2;e.x=a.pageX+h;break;case "b":e.y=a.pageY+k;e.x=a.pageX-c.width/2;break;case "l":e.y=a.pageY-c.height/2;e.x=a.pageX-c.width-h;break;case "rt":e.y=a.pageY-c.height-k;e.x=a.pageX+h;break;case "rb":e.y=a.pageY+k;e.x=a.pageX+h;break;case "lt":e.y=a.pageY-c.height-k;e.x=a.pageX-c.width-h;break;case "lb":e.y=a.pageY+k,e.x=a.pageX-c.width-h}p&&(e.x+=p.x,e.y+=p.y);m&&(a=b.getTargetPosition(a,g))&&("x"==m?e.y=a.y:e.x=a.x);return e},getWindowPosition:function(){var a=
b.getDialogSize(),c={},e=d.position.type.substr(1),f=d.position.offsetX,g=d.position.offsetY,h=L(),k=M(),m=r(window).width,n=r(window).height;switch(e){case "c":c.y=n/2-a.height/2+h;c.x=m/2-a.width/2+k;break;case "t":c.y=h+g;c.x=m/2-a.width/2+k;break;case "r":c.y=n/2-a.height/2+h;c.x=m-a.width+k-f;break;case "b":c.y=n-a.height+h-g;c.x=m/2-a.width/2+k;break;case "l":c.y=n/2-a.height/2+h;c.x=k+f;break;case "rt":c.y=h+g;c.x=m-a.width+k-f;break;case "rb":c.y=n-a.height+h-g;c.x=m-a.width+k-f;break;case "lt":c.y=
h+g;c.x=k+f;break;case "lb":c.y=n-a.height+h-g,c.x=k+f}return c},correctScreenPosition:function(a,c,d){var e=b.getDialogSize(),f=L(),g=M(),h=r(window).width,k=r(window).height;d&&a.y+e.height>k+f-d&&(a.y=k+f-d-e.height);c&&a.x+e.width>h+g-c&&(a.x=h+g-c-e.width);d&&a.y<f+d&&(a.y=f+d);c&&a.x<g+c&&(a.x=g+c);return a},onMouseMove:function(a){b.reposition(B(a))},onWindowResize:function(a){b.reposition(B(a))},onWindowScroll:function(a){b.reposition(B(a))},onPreventScroll:function(a){B(a).preventDefault()},
onOverlayClick:function(a){return d.modal?(a=B(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var c=B(a).target;(c=v(c,"metaphorjsTooltip-button-id"))&&b.trigger("button",f,c,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var c=v(a.target,"metaphorjsTooltip-button-id");c&&b.trigger("button",f,c,B(a))}},onAjaxLoad:function(a){J(g,d.cls.loading);b.setContent(a,"ajax")},onImageLoad:function(){h.images--;b.onContentChange()},onContentChange:function(){h.visible&&
b.reposition()},destroyElem:function(){b.setHandlers("unbind","_self");h.bindSelfOnRender=!0;q&&q.remove();t&&(t.parentNode.removeChild(t),t=null);g&&(d.render.keepInDOM||g.parentNode.removeChild(g),g=null);b.trigger("lifetime",f)}});delete d.callback.scope;for(var p in d.callback)f.on(p,d.callback[p],n);d.target&&d.useHref&&(p=d.target.getAttribute("href"),"#"==p.substr(0,1)?d.render.el=p:d.ajax.url=p);b.init();return f};C(H,{defaults:{}});window.MetaphorJs&&MetaphorJs.ns?MetaphorJs.ns.register("MetaphorJs.lib.Dialog",
H):(window.MetaphorJs=window.MetaphorJs||{},MetaphorJs.lib=MetaphorJs.lib||{},MetaphorJs.lib.Dialog=H);window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(e,c,b){var f="dialog",m;"string"==typeof e&&"destroy"!=e&&(m=e,e=c,c=b);e=e||{};f+="-"+(c||"default");this.each(function(){var b=v(this,f);if(b)if("destroy"==e)b.destroy(),v(this,f,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else e.target=this,e.instanceName=f,v(this,f,new H(m,e))})})})();
