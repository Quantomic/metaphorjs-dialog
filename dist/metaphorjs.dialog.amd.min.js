define("metaphorjs-dialog",["metaphorjs-observable","metaphorjs-promise","metaphorjs-ajax","metaphorjs-select","metaphorjs-animate"],function(ba,P,ca,p,X){var Y=X.stop,da=Array.prototype.slice,ea=Object.prototype.toString,L=function(){var b={"[object String]":0,"[object Number]":1,"[object Boolean]":2,"[object Object]":3,"[object Function]":4,"[object Array]":5,"[object RegExp]":9,"[object Date]":10};return function(a){if(!a){if(null===a)return 6;if(void 0===a)return 7}var g=b[ea.call(a)];return void 0===
g?-1:1==g&&isNaN(a)?8:g}}(),Q=function(b){return"object"==typeof b&&3===L(b)&&!b.nodeType},R=function(b){return!0===b||!1===b},F=function(){return function a(){var g=!1,m=!1,f=da.call(arguments),n=f.shift(),H,s,p;R(f[f.length-1])&&(g=f.pop());R(f[f.length-1])&&(m=g,g=f.pop());for(;f.length;)if(H=f.shift())for(s in H)if(H.hasOwnProperty(s)&&void 0!==(p=H[s]))if(m)if(n[s]&&Q(n[s])&&Q(p))a(n[s],p,g,m);else{if(!0===g||void 0==n[s])Q(p)?(n[s]={},a(n[s],p,g,!0)):n[s]=p}else if(!0===g||void 0==n[s])n[s]=
p;return n}}(),Z=function(){var b=["0","0","0"];return function(){for(var a=b.length,g;a;){a--;g=b[a].charCodeAt(0);if(57==g)return b[a]="A",b.join("");if(90==g)b[a]="0";else return b[a]=String.fromCharCode(g+1),b.join("")}b.unshift("0");return b.join("")}}(),$=function(){var b={};return function(a){return b[a]||(b[a]=new RegExp(a))}}(),S=function(b,a){return a?$("(?:^|\\s)"+a+"(?!\\S)").test(b.className):!1},G=function(b,a){a&&!S(b,a)&&(b.className+=" "+a)},T=function(b,a){a&&(b.className=b.className.replace($("(?:^|\\s)"+
a+"(?!\\S)"),""))},x=function(){var b={};return function(a,g,m){a=a._mjsid||(a._mjsid=Z());var f=b[a];return void 0!==m?(f||(f=b[a]={}),f[g]=m):f?f[g]:void 0}}(),B=function(b,a,g){return b&&b.getAttribute?void 0===g?b.getAttribute(a):null===g?b.removeAttribute(a):b.setAttribute(a,g):null},A=function(b,a,g){b.attachEvent?b.attachEvent("on"+a,g):b.addEventListener(a,g,!1)},C=function(b,a,g){b.detachEvent?b.detachEvent("on"+a,g):b.removeEventListener(a,g,!1)},D=function(){return!1},N=function(){return!0},
I=function(b){if(b instanceof I)return b;if(!(this instanceof I))return new I(b);for(var a in b)if(!this[a])try{this[a]=b[a]}catch(g){}this.originalEvent=b;this.type=b.type;!this.target&&b.srcElement&&(this.target=b.srcElement);var m,f=b.button;void 0===this.pageX&&null!==b.clientX&&(m=this.target?this.target.ownerDocument||document:document,a=m.documentElement,m=m.body,this.pageX=b.clientX+(a&&a.scrollLeft||m&&m.scrollLeft||0)-(a&&a.clientLeft||m&&m.clientLeft||0),this.pageY=b.clientY+(a&&a.scrollTop||
m&&m.scrollTop||0)-(a&&a.clientTop||m&&m.clientTop||0));this.which||void 0===f||(this.which=f&1?1:f&2?3:f&4?2:0);this.isDefaultPrevented=b.defaultPrevented||void 0===b.defaultPrevented&&!1===b.returnValue?N:D;this.timeStamp=b&&b.timeStamp||(new Date).getTime()};I.prototype={isDefaultPrevented:D,isPropagationStopped:D,isImmediatePropagationStopped:D,preventDefault:function(){var b=this.originalEvent;this.isDefaultPrevented=N;b.returnValue=!1;b&&b.preventDefault&&b.preventDefault()},stopPropagation:function(){var b=
this.originalEvent;this.isPropagationStopped=N;b&&b.stopPropagation&&b.stopPropagation()},stopImmediatePropagation:function(){var b=this.originalEvent;this.isImmediatePropagationStopped=N;b&&b.stopImmediatePropagation&&b.stopImmediatePropagation();this.stopPropagation()}};var E=function(b){return new I(b)},U=p.is,z=function(b){return"string"==typeof b||0===L(b)},r=function(b){return b.substr(0,1).toUpperCase()+b.substr(1)};P=function(b){var a,g=b?"pageYOffset":"pageXOffset",m=b?"scrollTop":"scrollLeft";
b=document;var f=b.body,n=b.documentElement;a=void 0!==window[g]?function(){return window[g]}:n.clientHeight?function(){return n[m]}:function(){return f[m]};return function(b){return b&&1==b.nodeType&&b!==f&&b!==n?b[m]:a()}};var V=P(!0),W=P(!1),u=function(b){var a;a=V();var g=W();b===window?(g=document.documentElement,a={left:0,right:g.clientWidth,top:a,bottom:g.clientHeight+a,width:g.clientWidth,height:g.clientHeight}):b.getBoundingClientRect?(b=b.getBoundingClientRect(),a={left:b.left+g,top:b.top+
a,right:b.right+g,bottom:b.bottom+a},a.width=a.right-a.left,a.height=a.bottom-a.top):a={left:b.offsetLeft+g,top:b.offsetTop+a,width:b.offsetWidth,height:b.offsetHeight,right:0,bottom:0};a.getCenter=function(){return this.width/2};a.getCenterX=function(){return this.left+this.width/2};return a},O={},fa=function(b,a,g,m){var f=a+"-"+g,n=function(b){b=E(b);return U(b.target,a)?m(b):null};O[f]||(O[f]=[]);O[f].push({el:b,ls:n,fn:m});A(b,g,n)},ga=function(b,a,g,m){var f,n;if(n=O[a+"-"+g])for(a=-1,f=n.length;++a<
f;)n[a].el===b&&n[a].fn===m&&C(b,g,n[a].ls)},aa=function(){var b=function(b,a){var e=b.style,h;for(h in a)e[h]=a[h]},a={t:"b",r:"l",b:"t",l:"r"},g={t:"top",r:"right",b:"bottom",l:"left"},m={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},f=document.all&&!window.XMLHttpRequest,n=function(){var b={},a={};return{register:function(e){var h=e.getInstanceId(),g=e.getGroup(),m,d,f;b[h]=e;m=0;for(d=g.length;m<d;m++)f=g[m],a[f]||(a[f]={}),a[f][h]=!0;e.on("destroy",this.unregister,this)},unregister:function(e){e=
e.getInstanceId();delete b[e]},hideAll:function(e){var h=e.getInstanceId();e=e.getGroup();var g,m,d,f;g=0;for(m=e.length;g<m;g++)for(f in d=e[g],d=a[d],d)b[f]?f==h||b[f].isHideAllIgnored()||b[f].hide(null,!0,!0):delete d[f]}}}(),H=function(n,q,e){var h,p=this,J,d={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},t=q.size,l=q.width||2*t;F(p,{init:function(){q.border&&p.createInner()},getEl:function(){return h},getDialogPositionOffset:function(){var d=
(p.detectPointerPosition()||"").substr(0,1),b=(n.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1),e={x:0,y:0};d==a[b]&&(e["t"==d||"b"==d?"y":"x"]="b"==d||"r"==d?-t:t);return e},createInner:function(){var d=F({},q);d.size=t-2*q.border;d.width=l-4*q.border;delete d.border;delete d.borderColor;delete d.borderCls;delete d.offset;J=new H(n,d,q.border)},detectPointerPosition:function(){if(q.position)return q.position;var d=(n.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return d?
a[d]:null},detectPointerDirection:function(d){return q.direction?q.direction:d},getBorders:function(d,b,e){var h={},c=d.substr(0,1);d=b.substr(0,1);var K=b.substr(1);b=f?"dotted":"solid";h["border"+r(g[a[c]])]=t+"px solid "+e;h["border"+r(g[c])]="0 "+b+" transparent";K?(h["border"+r(g[K])]="0 solid transparent",h["border"+r(g[a[K]])]=l+"px "+b+" transparent"):(e=Math.floor(l/2),h["border"+r(g[m[d][0]])]=e+"px "+b+" transparent",h["border"+r(g[m[d][1]])]=e+"px "+b+" transparent");return h},getOffsets:function(d,
b){var k={},f=d.substr(0,1),c="t"==f||"b"==f?"r":"b";if(!t)switch(document.body.appendChild(h),f){case "t":case "b":t=u(h).height;l=u(h).width;break;case "l":case "r":l=u(h).height,t=u(h).width}k[g[f]]=e?"auto":-t+"px";k[g[c]]="auto";if(e){var f=b.substr(0,1),K=b.substr(1);k[g[a[c]]]=K?"l"==K||"t"==K?e+"px":-l-e+"px":Math.floor(-l/2)+"px";k[g[a[f]]]=-(t+2*e)+"px"}else{switch(d){case "t":case "r":case "b":case "l":f=b!=d?"l"==b||"t"==b?q.offset:-l+q.offset:-l/2+q.offset;break;case "bl":case "tl":case "lt":case "rt":f=
q.offset;break;default:f=-l-q.offset}k["margin"+r(g[a[c]])]=f+"px";switch(d){case "t":case "r":case "b":case "l":f="50%";break;case "tr":case "rb":case "br":case "lb":f="100%";break;default:f=0}k[g[a[c]]]=f}return k},render:function(){if(!h){var a=p.detectPointerPosition();if(a)if(q.el){if(z(q.el)){var l=document.createElement("div");l.innerHTML=q.el;h=l.firstChild}else h=q.el;b(h,{position:"absolute"});b(h,p.getOffsets(a));G(h,q.cls);n.getElem().appendChild(h)}else{l=p.detectPointerDirection(a);
h=document.createElement("div");var k=document.createComment(" ");h.appendChild(k);b(h,d);b(h,p.getBorders(a,l,q.borderColor||q.color));b(h,p.getOffsets(a,l));G(h,q.borderCls||q.cls);J&&(J.render(),h.appendChild(J.getEl()));e||n.getElem().appendChild(h)}}},destroy:function(){p.remove();J=p=null},remove:function(){J&&J.remove();h&&(h.parentNode.removeChild(h),h=null)}},!0,!1);p.init();return p},s=function(b){if(!b)return{};var a=function(e,a,g){var f=b[e],d=!1;if(void 0!==f){switch(g){case "string":d=
z(f);break;case "function":d="function"==typeof f;break;case "number":d=1===L(f)||f==parseInt(f);break;case "dom":d=f&&(f.tagName||f.nodeName)?!0:!1;break;case "jquery":(d=f&&f.jquery?!0:!1)&&(f=f.get(0));break;case "boolean":if(!0===f||!1===f)d=!0;break;default:!0===g&&!0===f&&(d=!0),!1===g&&!1===f&&(d=!0)}d&&(b[e]={},b[e][a]=f)}};a("content","value","string");a("content","value","boolean");a("content","fn","function");a("ajax","url","string");a("cls","dialog","string");a("render","tpl","string");
a("render","fn","function");a("render","el","dom");a("render","el","jquery");a("show","events",!1);a("show","events","string");a("hide","events",!1);a("hide","events","string");a("toggle","events",!1);a("toggle","events","string");a("position","type","string");a("position","type",!1);a("position","get","function");a("overlay","enabled","boolean");a("pointer","position","string");a("pointer","size","number");return b},I={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,
prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,
timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",offsetX:0,offsetY:0,axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,
render:null,lifetime:null,targetchange:null,button:null}},D=function(a,f){a&&!z(a)&&(f=a,a=null);f=f||{};var e=this,h={},g=Z(),m=new ba,d=F({},I,s(D.defaults),s(D[a]),s(f),!0,!0),t=d.callback.scope||h,l,v,w,k={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};f=null;F(h,m.getApi(),{getElem:function(){return l},getInstanceId:function(){return g},getCfg:function(){return F({},
d)},getGroup:function(){return d.group?z(d.group)?[d.group]:d.group:[""]},setTarget:function(c){if(!c)return h;var d=!1,b=k.target;k.target?(e.setHandlers("unbind","_target"),d=!0):k.dynamicTarget&&(d=!0);z(c)?(k.dynamicTarget=!0,k.target=null):(k.dynamicTarget=!1,k.target=c);d&&(e.setHandlers("bind","_target"),e.trigger("targetchange",h,c,b));return h},getTarget:function(){return k.dynamicTarget?k.dynamicTargetEl:d.target},isEnabled:function(){return k.enabled},isVisible:function(){return k.visible},
isHideAllIgnored:function(){return d.show.ignoreHideAll},isFrozen:function(){return k.frozen},enable:function(){k.enabled=!0;return h},disable:function(){e.hide();k.enabled=!1;return h},freeze:function(){k.frozen=!0;return h},unfreeze:function(){k.frozen=!1;return h},toggle:function(c,d){return c&&c.stopPropagation&&k.dynamicTarget&&k.visible&&e.isDynamicTargetChanged(c)?e.show(c):e[k.visible?"hide":"show"](c,d)},show:function(c,b){var a=c&&c.stopPropagation?null:h,f=d.show;if(!h.isEnabled())return d.debug&&
console.log("show: not enabled",h.getTarget()),a;c&&c.stopPropagation&&d.events.show&&d.events.show[c.type]&&(a=d.events.show[c.type],a.process?a=a.process(h,c):(a.stopPropagation&&c.stopPropagation(),a.preventDefault&&c.preventDefault(),a=a.returnValue));if(k.visible&&k.hideTimeout)return window.clearTimeout(k.hideTimeout),k.hideTimeout=window.setTimeout(e.hide,d.hide.timeout),d.debug&&console.log("show: hide timeout was set",h.getTarget()),a;if(k.hideDelay)return window.clearTimeout(k.hideDelay),
k.hideDelay=null,k.visible=!0,d.debug&&console.log("show: hide delay was set; already shown",h.getTarget()),a;if(k.frozen)return d.debug&&console.log("show: frozen",h.getTarget()),a;k.destroyDelay&&(window.clearTimeout(k.destroyDelay),k.destroyDelay=null);var g=!1;c&&c.stopPropagation&&k.dynamicTarget&&(g=e.changeDynamicTarget(c));if(k.visible)if(g)if(d.render.fn)e.hide(null,!0);else return e.reposition(c),a;else return d.debug&&console.log("show: already shown",l),a;l?g&&e.changeDynamicContent():
e.render();if(!1===e.trigger("beforeshow",h,c))return d.debug&&console.log("show: beforeshow return false",h.getTarget()),a;Y(l);k.visible=!0;f.single&&n.hideAll(e);e.toggleTitleAttribute(!1);f.delay&&!b?k.showDelay=window.setTimeout(function(){e.showAfterDelay(c)},f.delay):e.showAfterDelay(c,b);return a},hide:function(c,b,a){k.hideTimeout=null;var f=c&&c.stopPropagation?null:h;c&&c.stopPropagation&&d.events.hide&&d.events.hide[c.type]&&(f=d.events.hide[c.type],f.process?f=f.process(h,c):(f.stopPropagation&&
c.stopPropagation(),f.preventDefault&&c.preventDefault(),f=f.returnValue));!k.visible&&k.hideDelay&&b&&(window.clearTimeout(k.hideDelay),k.hideDelay=null,k.visible=!0);if(!l||!k.visible||!e.isEnabled())return d.debug&&console.log("hide: elem/visible/enabled: ",l,k.visible,e.isEnabled()),f;if(k.showDelay)return d.hide.cancelShowDelay||a?(window.clearTimeout(k.showDelay),k.showDelay=null,k.visible=!1,d.debug&&console.log("hide: cancelShowDelay: ",e.getTarget())):d.debug&&console.log("hide: show delay was set",
e.getTarget()),f;if(k.frozen)return d.debug&&console.log("hide: frozen",e.getTarget()),f;if(!1===e.trigger("beforehide",h,c))return d.debug&&console.log("hide: beforehide returned false",e.getTarget()),f;Y(l);k.visible=!1;e.toggleTitleAttribute(!0);k.dynamicTarget&&e.resetDynamicTarget();d.hide.delay&&!b?k.hideDelay=window.setTimeout(function(){e.hideAfterDelay(c)},d.hide.delay):e.hideAfterDelay(c,b);return f},setPositionType:function(c){c&&(z(c)?(d.position.get=c,d.position.type=!1):(d.position.get=
null,d.position.type=c));c=d.position.type;!1===c?k.position=!1:d.position.get&&"m"!=c?k.position="fn":(c=c.substr(0,1),k.position="w"==c?"window":"m"==c?"mouse":"target");v&&(v.remove(),l&&v.render())},getPosition:function(c){if(!l)return null;var b,a=d.position;switch(k.position){case !1:return null;case "target":b=e.getTargetPosition(c);break;case "mouse":b=e.getMousePosition(c);break;case "window":b=e.getWindowPosition(c);break;case "fn":b=a.get.call(t,h,c)}if(!1!==a.screenX||!1!==a.screenY)b=
e.correctScreenPosition(b,a.screenX,a.screenY);return b},reposition:function(c){c&&(c=E(c));if(c=e.getPosition(c))void 0!=c.x&&b(l,{left:c.x+"px"}),void 0!=c.y&&b(l,{top:c.y+"px"}),void 0==c.x&&void 0==c.y&&b(l,c)},getContentElem:function(){return l?d.selector.content?p(d.selector.content,l).shift()||l:l:null},setContent:function(c,b){b=b||"";if(!l)return d.content.value=c,h;d.content.prepare&&(c=d.content.prepare(h,b,c));var a=h.getContentElem(),f=k.rendered&&!d.selector.content&&v,g=f&&v.getEl();
if(f&&g)try{l.removeChild(g)}catch(m){}if(z(c))a.innerHTML=c;else for(var M in c){var n=d.selector[M];n&&(n=p(n,a).shift())&&(n.innerHTML=c[M])}if(f&&g)try{l.appendChild(g)}catch(q){}a=p("img",a);k.images=a.length;M=-1;for(f=a.length;++M<f;A(a[M],"load",e.onImageLoad));e.trigger("contentchange",h,c,b);e.onContentChange();return h},readContent:function(){var c=h.getTarget(),b;c&&(b=d.content.attr?B(c,d.content.attr):B(c,"tooltip")||B(c,"title")||B(c,"alt"));b&&e.setContent(b,"attribute");return h},
loadContent:function(c){G(l,d.cls.loading);c=F({},d.ajax,c,!0,!0);e.trigger("beforeajax",h,c);return ca(c).done(e.onAjaxLoad)},destroy:function(){e.trigger("destroy",h);C(window,"resize",e.onWindowResize);C(window,"scroll",e.onWindowScroll);e.destroyElem();v&&(v.destroy(),v=null);e.setHandlers("unbind");m.destroy();w=k=h=e=m=null},setFocus:function(){var c=d.show.focus,b;if(!0===c)if(c=p("input",l).concat(p("textarea",l)),0<c.length)c[0].focus();else{if(d.buttons)for(b in d.buttons){(b=p(d.buttons[b],
l).shift())&&b.focus();break}}else(b=p(c,l).shift())&&b.focus()}},!0,!1);F(e,h,{init:function(){n.register(e);d.modal&&(d.overlay.enabled=!0);e.setPositionType();e.setTarget(d.target);if(d.pointer.size||d.pointer.el)v=new H(e,d.pointer);d.render.lazy||e.render();e.setHandlers("bind")},setHandlers:function(c,b){for(var a=["show","hide","toggle"],f="bind"==c?A:C,g="bind"==c?fa:ga,m,n,y,q,t,v,s,r,u,x;m=a.shift();)if(n=d[m].events,!1!==n){if(z(n)||"object"==typeof n&&5===L(n))k.dynamicTarget?(t={},t[n]=
d.target,n={_html:t}):n={_target:n};for(y in n){if(b)if("_self"==b){if("_self"!=y&&"_overlay"!=y&&">"!=y.substr(0,1))continue}else if(y!=b)continue;if("_self"!=y&&"_overlay"!=y&&">"!=y.substr(0,1)||l){if(s=n[y]){switch(y){case "_target":r=[e.getTarget()];break;case "_self":r=[l];break;case "_window":r=[window];break;case "_document":r=[document];break;case "_html":r=[document.documentElement];break;case "_overlay":r=[w];break;default:r=">"==y.substr(0,1)?p(y.substr(1),l):p(y)}if(r&&r.length)if(z(s)&&
(s=[s]),"object"==typeof s&&5===L(s))for(t=0,v=s.length;t<v;t++)for(u=-1,x=r.length;++u<x;f(r[u],s[t],h[m]));else for(q in s)for(u=-1,x=r.length;++u<x;g(r[u],s[q],q,h[m]));}}else k.bindSelfOnRender=!0}}},resetDynamicTarget:function(){var c=k.dynamicTargetEl;c&&(e.setHandlers("unbind","_target"),e.trigger("targetchange",h,null,c))},isDynamicTargetChanged:function(c){var b=d.target;c=c.target;for(var a=k.dynamicTargetEl;c&&!U(c,b);)c=c.parentNode;return c?!a||a!==c:!1},changeDynamicTarget:function(c){var b=
d.target;c=c.target;for(var a=k.dynamicTargetEl;c&&!U(c,b);)c=c.parentNode;if(!c||a&&a===c)return!1;a&&e.setHandlers("unbind","_target");k.dynamicTargetEl=c;e.setHandlers("bind","_target");e.trigger("targetchange",h,c,a);return!0},showAfterDelay:function(c,b){k.showDelay=null;if(k.visible){d.position.manual||e.reposition(c);"mouse"==k.position&&A(document.documentElement,"mousemove",e.onMouseMove);var a=d.position;(a.resize||a.screenX||a.screenY)&&A(window,"resize",e.onWindowResize);(a.scroll||a.screenX||
a.screenY)&&A(window,"scroll",e.onWindowScroll);if(b||!1!==e.trigger("afterdelay",h,c)){w&&(d.overlay.animateShow?e.animate("show",null,!0):w.style.display="");if(d.show.preventScroll){var a=d.show.preventScroll,f,g;!0===a&&(a="body");a=p(a);f=-1;for(g=a.length;++f<g;A(a[f],"mousewheel",e.onPreventScroll)&&A(a[f],"touchmove",e.onPreventScroll));}d.show.animate&&!b?e.animate("show").done(function(){e.showAfterAnimation(c)}):e.showAfterAnimation(c)}else k.visible=!1,d.debug&&console.log("showAfterDelay: afterdelay returned false",
h.getTarget())}else d.debug&&console.log("showAfterDelay: already hidden",e.getTarget())},showAfterAnimation:function(c){k.visible?(T(l,d.cls.hidden),G(l,d.cls.visible),d.render.keepVisible||(l.style.display=""),d.hide.timeout&&(k.hideTimeout=window.setTimeout(e.hide,d.hide.timeout)),d.show.focus&&window.setTimeout(e.setFocus,20),e.trigger("show",h,c)):d.debug&&console.log("showAfterAnimation: already hidden",e.getTarget())},hideAfterDelay:function(c,b){k.hideDelay=null;if(k.visible)d.debug&&console.log("hideAfterDelay: already shown again",
e.getTarget());else{"mouse"==k.position&&C(document.documentElement,"mousemove",e.onMouseMove);var a=d.position;(a.resize||a.screenX||a.screenY)&&C(window,"resize",e.onWindowResize);(a.scroll||a.screenX||a.screenY)&&C(window,"scroll",e.onWindowScroll);if(b||!1!==e.trigger("afterhidedelay",h,c)){if(d.show.preventScroll){var a=d.show.preventScroll,f,g;!0===a&&(a="body");a=p(a);f=-1;for(g=a.length;++f<g;C(a[f],"mousewheel",e.onPreventScroll)&&C(a[f],"touchmove",e.onPreventScroll));}w&&(d.overlay.animateShow?
e.animate("hide",null,!0).done(function(){w.style.display="none"}):w.style.display="none");d.hide.animate&&!b?e.animate("hide").done(function(){e.hideAfterAnimation(c)}):e.hideAfterAnimation(c)}else k.visible=d.cls.hidden?!S(l,d.cls.hidden):!(0>=l.offsetWidth||0>=l.offsetHeight),d.debug&&console.log("hideAfterDelay: afterhdelay returned false",e.getTarget())}},hideAfterAnimation:function(c){k.visible?d.debug&&console.log("hideAfterAnimation: already shown again",e.getTarget()):(T(l,d.cls.visible),
G(l,d.cls.hidden),d.render.keepVisible||(l.style.display="none"),e.trigger("hide",h,c),c=d.render.lifetime,null!==c&&(0===c?e.destroyElem():k.destroyDelay=window.setTimeout(e.destroyElem,c)),l&&d.hide.destroy&&window.setTimeout(function(){x(l,d.instanceName,null);e.destroy()},0))},render:function(){if(l)d.debug&&console.log("element already rendered",l);else{var c=d.render,a=d.cls;if(c.fn){var f=c.fn.call(t,h);c[z(f)?"tpl":"el"]=f}c.el?z(c.el)?(l=p(c.el).shift(),c.keepInDOM=!0):l=c.el:(f=document.createElement("div"),
f.innerHTML=c.tpl,l=f.firstChild);l||(l=document.createElement("div"));c.id&&B(l,"id",c.id);d.render.keepVisible||(l.style.display="none");G(l,a.dialog);G(l,a.hidden);c.style&&b(l,c.style);d.overlay.enabled&&(w=document.createElement("div"),b(w,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:d.overlay.opacity,backgroundColor:d.overlay.color}),document.body.appendChild(w),A(w,"click",e.onOverlayClick),c.zIndex&&b(w,{zIndex:c.zIndex}),d.overlay.cls&&G(w,d.overlay.cls));c.appendTo?
c.appendTo.appendChild(l):!1!==c.appendTo&&document.body.appendChild(l);c.zIndex&&b(l,{zIndex:c.zIndex});c=d.content;if(!1!==c.value)if(c.value)e.setContent(c.value);else if(c.fn)e.setContent(c.fn.call(t,h));else e[d.ajax.url?"loadContent":"readContent"]();v&&v.render();if(d.buttons)for(var g in d.buttons)if(c=p(d.buttons[g],l).shift())x(c,"metaphorjsTooltip-button-id",g),A(c,"click",e.onButtonClick),A(c,"keyup",e.onButtonKeyup);k.bindSelfOnRender&&(e.setHandlers("bind","_self"),k.bindSelfOnRender=
!1);k.rendered=!0;e.trigger("render",h)}},animate:function(c,b,a){var f,g;f=a?"show"==c?d.overlay.animateShow:d.overlay.animateHide:d[c].animate;"function"==typeof f&&(f=f(e,b));g=f.skipDisplayChange||!1;R(f)?f=c:z(f)&&(f=[f]);return X(l,f,function(){"show"!=c||g||(a?w.style.display="":l.style.display="")})},toggleTitleAttribute:function(c){var b=h.getTarget(),a;b&&(!1===c?(x(b,"tmp-title",B(b,"title")),B(b,"title",null)):(a=x(b,"tmp-title"))&&B(b,"title",a))},changeDynamicContent:function(){d.content.fn?
e.setContent(d.content.fn.call(t,h)):d.content.attr&&e.readContent()},getDialogSize:function(){var c=d.cls.hidden?S(l,d.cls.hidden):!!(0>=l.offsetWidth||0>=l.offsetHeight),a,e=l.style.left;c&&(b(l,{left:"-1000px"}),l.style.display="");a={width:u(l).width,height:u(l).height};c&&(b(l,{left:e}),l.style.display="none");return a},getTargetSize:function(){var c=e.getTarget();return c?{width:u(c).width,height:u(c).height}:null},getTargetPosition:function(c,b){var a=e.getTarget();if(!a)return null;var f=
e.getDialogSize(),a=u(a),g=e.getTargetSize(),h={};b=b||d.position.type;var k=b.substr(0,1),l=b.substr(1),m=d.position.offsetX,n=d.position.offsetY,p=v?v.getDialogPositionOffset():null;switch(k){case "t":h.y=a.top-f.height-n;break;case "r":h.x=a.left+g.width+m;break;case "b":h.y=a.top+g.height+n;break;case "l":h.x=a.left-f.width-m}switch(l){case "t":h.y=a.top+n;break;case "r":h.x=a.left+g.width-f.width-m;break;case "b":h.y=a.top+g.height-f.height-n;break;case "l":h.x=a.left+m;break;case "rc":h.x=a.left+
g.width+m;break;case "lc":h.x=a.left-f.width-m;break;case "":switch(k){case "t":case "b":h.x=a.left+g.width/2-f.width/2;break;case "r":case "l":h.y=a.top+g.height/2-f.height/2}}p&&(h.x+=p.x,h.y+=p.y);return h},getMousePosition:function(c){if(!c)return null;var a=e.getDialogSize(),b={},f=d.position.type.substr(1),g=d.position.offsetX,k=d.position.offsetY,l=d.position.axis,m=v?v.getDialogPositionOffset():null;switch(f){case "":b=d.position.get.call(t,h,c);break;case "t":b.y=c.pageY-a.height-k;b.x=c.pageX-
a.width/2;break;case "r":b.y=c.pageY-a.height/2;b.x=c.pageX+g;break;case "b":b.y=c.pageY+k;b.x=c.pageX-a.width/2;break;case "l":b.y=c.pageY-a.height/2;b.x=c.pageX-a.width-g;break;case "rt":b.y=c.pageY-a.height-k;b.x=c.pageX+g;break;case "rb":b.y=c.pageY+k;b.x=c.pageX+g;break;case "lt":b.y=c.pageY-a.height-k;b.x=c.pageX-a.width-g;break;case "lb":b.y=c.pageY+k,b.x=c.pageX-a.width-g}m&&(b.x+=m.x,b.y+=m.y);l&&(c=e.getTargetPosition(c,f))&&("x"==l?b.y=c.y:b.x=c.x);return b},getWindowPosition:function(){var b=
e.getDialogSize(),a={},f=d.position.type.substr(1),g=d.position.offsetX,h=d.position.offsetY,k=V(),l=W(),m=u(window).width,n=u(window).height;switch(f){case "c":a.y=n/2-b.height/2+k;a.x=m/2-b.width/2+l;break;case "t":a.y=k+h;a.x=m/2-b.width/2+l;break;case "r":a.y=n/2-b.height/2+k;a.x=m-b.width+l-g;break;case "b":a.y=n-b.height+k-h;a.x=m/2-b.width/2+l;break;case "l":a.y=n/2-b.height/2+k;a.x=l+g;break;case "rt":a.y=k+h;a.x=m-b.width+l-g;break;case "rb":a.y=n-b.height+k-h;a.x=m-b.width+l-g;break;case "lt":a.y=
k+h;a.x=l+g;break;case "lb":a.y=n-b.height+k-h,a.x=l+g}return a},correctScreenPosition:function(a,b,d){var f=e.getDialogSize(),g=V(),h=W(),k=u(window).width,l=u(window).height;d&&a.y+f.height>l+g-d&&(a.y=l+g-d-f.height);b&&a.x+f.width>k+h-b&&(a.x=k+h-b-f.width);d&&a.y<g+d&&(a.y=g+d);b&&a.x<h+b&&(a.x=h+b);return a},onMouseMove:function(a){e.reposition(E(a))},onWindowResize:function(a){e.reposition(E(a))},onWindowScroll:function(a){e.reposition(E(a))},onPreventScroll:function(a){E(a).preventDefault()},
onOverlayClick:function(a){return d.modal?(a=E(a),a.preventDefault(),a.stopPropagation(),!1):null},onButtonClick:function(a){var b=E(a).target;(b=x(b,"metaphorjsTooltip-button-id"))&&e.trigger("button",h,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=x(a.target,"metaphorjsTooltip-button-id");b&&e.trigger("button",h,b,E(a))}},onAjaxLoad:function(a){T(l,d.cls.loading);e.setContent(a,"ajax")},onImageLoad:function(){k.images--;e.onContentChange()},onContentChange:function(){k.visible&&
e.reposition()},destroyElem:function(){e.setHandlers("unbind","_self");k.bindSelfOnRender=!0;v&&v.remove();w&&(w.parentNode.removeChild(w),w=null);l&&(d.render.keepInDOM||l.parentNode.removeChild(l),l=null);e.trigger("lifetime",h)}},!0,!1);delete d.callback.scope;for(var r in d.callback)h.on(r,d.callback[r],t);d.target&&d.useHref&&(r=B(d.target,"href"),"#"==r.substr(0,1)?d.render.el=r:d.ajax.url=r);e.init();return h};F(D,{defaults:{}});return D}();window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(b,
a,g){var m="dialog",f;"string"==typeof b&&"destroy"!=b&&(f=b,b=a,a=g);b=b||{};m+="-"+(a||"default");this.each(function(){var a=x(this,m);if(a)if("destroy"==b)a.destroy(),x(this,m,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else b.target=this,b.instanceName=m,x(this,m,new aa(f,b))})});return aa});
