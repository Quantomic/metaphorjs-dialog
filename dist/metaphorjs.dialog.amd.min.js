define("metaphorjs-dialog",["metaphorjs-observable","metaphorjs-promise","metaphorjs-ajax","metaphorjs-select","metaphorjs-animate"],function($,fa,aa,n,T){var U=T.stop,ba=Array.prototype.slice,N=function(n){return!(!n||n.constructor!==Object)},t=function(n){return"undefined"==typeof n},F=function a(){var b=!1,f=!1,l=ba.call(arguments),m=l.shift(),n,u,r;"boolean"==typeof l[l.length-1]&&(b=l.pop());"boolean"==typeof l[l.length-1]&&(f=b,b=l.pop());for(;l.length;)if(n=l.shift())for(u in n)if(n.hasOwnProperty(u)&&
!t(r=n[u]))if(f)if(m[u]&&N(m[u])&&N(r))a(m[u],r,b,f);else{if(!0===b||t(m[u])||null===m[u])N(r)?(m[u]={},a(m[u],r,b,!0)):m[u]=r}else if(!0===b||t(m[u])||null===m[u])m[u]=r;return m},V=function(){var a=["0","0","0"];return function(){for(var b=a.length,f;b;){b--;f=a[b].charCodeAt(0);if(57==f)return a[b]="A",a.join("");if(90==f)a[b]="0";else return a[b]=String.fromCharCode(f+1),a.join("")}a.unshift("0");return a.join("")}}(),W=function(){var a={};return function(b){return a[b]||(a[b]=new RegExp(b))}}(),
O=function(a,b){return b?W("(?:^|\\s)"+b+"(?!\\S)").test(a.className):!1},G=function(a,b){b&&!O(a,b)&&(a.className+=" "+b)},P=function(a,b){b&&(a.className=a.className.replace(W("(?:^|\\s)"+b+"(?!\\S)"),""))},ca=Object.prototype.toString,X=function(a){return"number"==typeof a&&!isNaN(a)},Y=function(a){return!(!a||null==a||"object"!==typeof a||!X(a.length)||"[object Array]"!=ca.call(a))},B=function(){var a={};return function(b,f,l){b=b._mjsid||(b._mjsid=V());var m=a[b];if(t(l))return m?m[f]:void 0;
m||(m=a[b]={});return m[f]=l}}(),A=function(a,b,f){a.attachEvent?a.attachEvent("on"+b,f):a.addEventListener(b,f,!1)},C=function(a,b,f){a.detachEvent?a.detachEvent("on"+b,f):a.removeEventListener(b,f,!1)},H=function(){return!1},M=function(){return!0},I=function(a){if(a instanceof I)return a;if(!(this instanceof I))return new I(a);for(var b in a)if(!this[b])try{this[b]=a[b]}catch(f){}this.originalEvent=a;this.type=a.type;!this.target&&a.srcElement&&(this.target=a.srcElement);var l,m=a.button;t(this.pageX)&&
null!==a.clientX&&(l=this.target?this.target.ownerDocument||document:document,b=l.documentElement,l=l.body,this.pageX=a.clientX+(b&&b.scrollLeft||l&&l.scrollLeft||0)-(b&&b.clientLeft||l&&l.clientLeft||0),this.pageY=a.clientY+(b&&b.scrollTop||l&&l.scrollTop||0)-(b&&b.clientTop||l&&l.clientTop||0));this.which||void 0===m||(this.which=m&1?1:m&2?3:m&4?2:0);this.isDefaultPrevented=a.defaultPrevented||t(a.defaultPrevented)&&!1===a.returnValue?M:H;this.timeStamp=a&&a.timeStamp||(new Date).getTime()};I.prototype=
{isDefaultPrevented:H,isPropagationStopped:H,isImmediatePropagationStopped:H,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=M;a.returnValue=!1;a&&a.preventDefault&&a.preventDefault()},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=M;a&&a.stopPropagation&&a.stopPropagation()},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=M;a&&a.stopImmediatePropagation&&a.stopImmediatePropagation();this.stopPropagation()}};
var D=function(a){return new I(a)},Q=n.is,z=function(a){return"string"==typeof a},J=function(a){return a.substr(0,1).toUpperCase()+a.substr(1)},R=function(){if(t(window.pageYOffset)){var a=document.body,b=document.documentElement;return b.clientHeight?function(){return b.scrollTop}:function(){return a.scrollTop}}return function(){return window.pageYOffset}}(),S=function(){if(t(window.pageXOffset)){var a=document.body,b=document.documentElement;return b.clientWidth?function(){return b.scrollLeft}:
function(){return a.scrollLeft}}return function(){return window.pageXOffset}}(),r=function(a){var b;b=R();var f=S();if(a===window)f=document.documentElement,b={left:0,right:f.clientWidth,top:b,bottom:f.clientHeight+b,width:f.clientWidth,height:f.clientHeight};else if(a.getBoundingClientRect)a=a.getBoundingClientRect(),b={left:a.left+f,top:a.top+b,right:a.right+f,bottom:a.bottom+b},b.width=b.right-b.left,b.height=b.bottom-b.top;else{var l=a.style;b={left:(parseInt(l.left,10)||0)+f,top:(parseInt(l.top,
10)||0)+b,width:a.offsetWidth,height:a.offsetHeight,right:0,bottom:0}}b.getCenter=function(){return this.width/2};b.getCenterX=function(){return this.left+this.width/2};return b},E={},da=function(a,b,f,l){var m=b+"-"+f,n=function(a){a=D(a);return Q(a.target,b)?l(a):null};E[m]||(E[m]=[]);E[m].push({el:a,ls:n,fn:l});A(a,f,n)},ea=function(a,b,f,l){var m,n;if(n=E[b+"-"+f])for(b=-1,m=n.length;++b<m;)n[b].el===a&&n[b].fn===l&&C(a,f,n[b].ls)},Z=function(){var a=function(a,b){var e=a.style,h;for(h in b)e[h]=
b[h]},b={t:"b",r:"l",b:"t",l:"r"},f={t:"top",r:"right",b:"bottom",l:"left"},l={t:["l","r"],r:["t","b"],b:["r","l"],l:["b","t"]},m=document.all&&!window.XMLHttpRequest,I=function(){var a={},b={};return{register:function(e){var h=e.getInstanceId(),f=e.getGroup(),l,d,m;a[h]=e;l=0;for(d=f.length;l<d;l++)m=f[l],b[m]||(b[m]={}),b[m][h]=!0;e.on("destroy",this.unregister,this)},unregister:function(e){e=e.getInstanceId();delete a[e]},hideAll:function(e){var h=e.getInstanceId();e=e.getGroup();var f,l,d,m;f=
0;for(l=e.length;f<l;f++)for(m in d=e[f],d=b[d],d)a[m]?m==h||a[m].isHideAllIgnored()||a[m].hide(null,!0,!0):delete d[m]}}}(),u=function(n,p,e){var h,x=this,K,d={backgroundColor:"transparent",width:"0px",height:"0px",position:"absolute",fontSize:"0px",lineHeight:"0px"},s=p.size,k=p.width||2*s;F(x,{init:function(){p.border&&x.createInner()},getEl:function(){return h},getDialogPositionOffset:function(){var d=(x.detectPointerPosition()||"").substr(0,1),e=(n.getCfg().position.type||"").replace(/(w|m|c)/,
"").substr(0,1),a={x:0,y:0};d==b[e]&&(a["t"==d||"b"==d?"y":"x"]="b"==d||"r"==d?-s:s);return a},createInner:function(){var d=F({},p);d.size=s-2*p.border;d.width=k-4*p.border;delete d.border;delete d.borderColor;delete d.borderCls;delete d.offset;K=new u(n,d,p.border)},detectPointerPosition:function(){if(p.position)return p.position;var d=(n.getCfg().position.type||"").replace(/(w|m|c)/,"").substr(0,1);return d?b[d]:null},detectPointerDirection:function(d){return p.direction?p.direction:d},getBorders:function(d,
e,a){var h={},c=d.substr(0,1);d=e.substr(0,1);var L=e.substr(1);e=m?"dotted":"solid";h["border"+J(f[b[c]])]=s+"px solid "+a;h["border"+J(f[c])]="0 "+e+" transparent";L?(h["border"+J(f[L])]="0 solid transparent",h["border"+J(f[b[L]])]=k+"px "+e+" transparent"):(a=Math.floor(k/2),h["border"+J(f[l[d][0]])]=a+"px "+e+" transparent",h["border"+J(f[l[d][1]])]=a+"px "+e+" transparent");return h},getOffsets:function(d,a){var g={},l=d.substr(0,1),c="t"==l||"b"==l?"r":"b";if(!s)switch(document.body.appendChild(h),
l){case "t":case "b":s=r(h).height;k=r(h).width;break;case "l":case "r":k=r(h).height,s=r(h).width}g[f[l]]=e?"auto":-s+"px";g[f[c]]="auto";if(e){var l=a.substr(0,1),L=a.substr(1);g[f[b[c]]]=L?"l"==L||"t"==L?e+"px":-k-e+"px":Math.floor(-k/2)+"px";g[f[b[l]]]=-(s+2*e)+"px"}else{switch(d){case "t":case "r":case "b":case "l":l=a!=d?"l"==a||"t"==a?p.offset:-k+p.offset:-k/2+p.offset;break;case "bl":case "tl":case "lt":case "rt":l=p.offset;break;default:l=-k-p.offset}g["margin"+J(f[b[c]])]=l+"px";switch(d){case "t":case "r":case "b":case "l":l=
"50%";break;case "tr":case "rb":case "br":case "lb":l="100%";break;default:l=0}g[f[b[c]]]=l}return g},render:function(){if(!h){var b=x.detectPointerPosition();if(b)if(p.el){if(z(p.el)){var k=document.createElement("div");k.innerHTML=p.el;h=k.firstChild}else h=p.el;a(h,{position:"absolute"});a(h,x.getOffsets(b));G(h,p.cls);n.getElem().appendChild(h)}else{k=x.detectPointerDirection(b);h=document.createElement("div");var g=document.createComment(" ");h.appendChild(g);a(h,d);a(h,x.getBorders(b,k,p.borderColor||
p.color));a(h,x.getOffsets(b,k));G(h,p.borderCls||p.cls);K&&(K.render(),h.appendChild(K.getEl()));e||n.getElem().appendChild(h)}}},destroy:function(){x.remove();K=x=null},remove:function(){K&&K.remove();h&&(h.parentNode.removeChild(h),h=null)}},!0,!1);x.init();return x},H=function(a){if(!a)return{};var b=function(e,b,l){var f=a[e],d=!1;if(!t(f)){switch(l){case "string":d=z(f);break;case "function":d="function"===typeof f;break;case "number":d=X(f)||f==parseInt(f);break;case "dom":d=f&&(f.tagName||
f.nodeName)?!0:!1;break;case "jquery":(d=f&&f.jquery?!0:!1)&&(f=f.get(0));break;case "boolean":if(!0===f||!1===f)d=!0;break;default:!0===l&&!0===f&&(d=!0),!1===l&&!1===f&&(d=!0)}d&&(a[e]={},a[e][b]=f)}};b("content","value","string");b("content","value","boolean");b("content","fn","function");b("ajax","url","string");b("cls","dialog","string");b("render","tpl","string");b("render","fn","function");b("render","el","dom");b("render","el","jquery");b("show","events",!1);b("show","events","string");b("hide",
"events",!1);b("hide","events","string");b("toggle","events",!1);b("toggle","events","string");b("position","type","string");b("position","type",!1);b("position","get","function");b("overlay","enabled","boolean");b("pointer","position","string");b("pointer","size","number");return a},M={target:null,debug:!1,group:null,modal:!1,useHref:!1,content:{value:"",fn:null,prepare:null,attr:null},ajax:{url:null,data:null,dataType:"text",method:"GET"},cls:{dialog:null,visible:null,hidden:null,loading:null},
selector:{content:null},buttons:null,render:{tpl:"<div></div>",fn:null,el:null,zIndex:null,lazy:!0,style:null,appendTo:null,id:null,keepVisible:!1,keepInDOM:!1,lifetime:null},events:{show:{click:{preventDefault:!0,stopPropagation:!0,returnValue:!1,process:null}}},show:{delay:null,single:!1,events:null,animate:!1,ignoreHideAll:!1,focus:!1,preventScroll:!1},hide:{delay:null,timeout:null,events:null,destroy:!1,animate:!1,cancelShowDelay:!0},toggle:{events:null},position:{type:"t",offsetX:0,offsetY:0,
axis:null,get:null,screenX:!1,screenY:!1,resize:!0},pointer:{position:null,direction:null,size:0,width:null,color:null,offset:0,border:0,borderColor:null,el:null,cls:null,borderCls:null},overlay:{enabled:!1,color:"#000",opacity:.5,cls:null,animateShow:!1,animateHide:!1,preventScroll:!1},callback:{scope:null,contentchange:null,beforeshow:null,show:null,beforehide:null,hide:null,render:null,lifetime:null,targetchange:null,button:null}},E=function(b,f){b&&!z(b)&&(f=b,b=null);f=f||{};var e=this,h={},
l=V(),m=new $,d=F({},M,H(E.defaults),H(E[b]),H(f),!0,!0),s=d.callback.scope||h,k,q,v,g={bindSelfOnRender:!1,target:null,visible:!1,enabled:!0,frozen:!1,rendered:!1,hideTimeout:null,hideDelay:null,showDelay:null,dynamicTarget:!1,dynamicTargetEl:null,images:0,position:null,destroyDelay:null};f=null;F(h,m.getApi(),{getElem:function(){return k},getInstanceId:function(){return l},getCfg:function(){return F({},d)},getGroup:function(){return d.group?z(d.group)?[d.group]:d.group:[""]},setTarget:function(c){if(!c)return h;
var d=!1,a=g.target;g.target?(e.setHandlers("unbind","_target"),d=!0):g.dynamicTarget&&(d=!0);z(c)?(g.dynamicTarget=!0,g.target=null):(g.dynamicTarget=!1,g.target=c);d&&(e.setHandlers("bind","_target"),e.trigger("targetchange",h,c,a));return h},getTarget:function(){return g.dynamicTarget?g.dynamicTargetEl:d.target},isEnabled:function(){return g.enabled},isVisible:function(){return g.visible},isHideAllIgnored:function(){return d.show.ignoreHideAll},isFrozen:function(){return g.frozen},enable:function(){g.enabled=
!0;return h},disable:function(){e.hide();g.enabled=!1;return h},freeze:function(){g.frozen=!0;return h},unfreeze:function(){g.frozen=!1;return h},toggle:function(c,d){return c&&c.stopPropagation&&g.dynamicTarget&&g.visible&&e.isDynamicTargetChanged(c)?e.show(c):e[g.visible?"hide":"show"](c,d)},show:function(c,a){var b=c&&c.stopPropagation?null:h,f=d.show;if(!h.isEnabled())return d.debug&&console.log("show: not enabled",h.getTarget()),b;c&&c.stopPropagation&&d.events.show&&d.events.show[c.type]&&(b=
d.events.show[c.type],b.process?b=b.process(h,c):(b.stopPropagation&&c.stopPropagation(),b.preventDefault&&c.preventDefault(),b=b.returnValue));if(g.visible&&g.hideTimeout)return window.clearTimeout(g.hideTimeout),g.hideTimeout=window.setTimeout(e.hide,d.hide.timeout),d.debug&&console.log("show: hide timeout was set",h.getTarget()),b;if(g.hideDelay)return window.clearTimeout(g.hideDelay),g.hideDelay=null,g.visible=!0,d.debug&&console.log("show: hide delay was set; already shown",h.getTarget()),b;
if(g.frozen)return d.debug&&console.log("show: frozen",h.getTarget()),b;g.destroyDelay&&(window.clearTimeout(g.destroyDelay),g.destroyDelay=null);var l=!1;c&&c.stopPropagation&&g.dynamicTarget&&(l=e.changeDynamicTarget(c));if(g.visible)if(l)if(d.render.fn)e.hide(null,!0);else return e.reposition(c),b;else return d.debug&&console.log("show: already shown",k),b;k?l&&e.changeDynamicContent():e.render();if(!1===e.trigger("beforeshow",h,c))return d.debug&&console.log("show: beforeshow return false",h.getTarget()),
b;U(k);g.visible=!0;f.single&&I.hideAll(e);e.toggleTitleAttribute(!1);f.delay&&!a?g.showDelay=window.setTimeout(function(){e.showAfterDelay(c)},f.delay):e.showAfterDelay(c,a);return b},hide:function(c,a,b){g.hideTimeout=null;var f=c&&c.stopPropagation?null:h;c&&c.stopPropagation&&d.events.hide&&d.events.hide[c.type]&&(f=d.events.hide[c.type],f.process?f=f.process(h,c):(f.stopPropagation&&c.stopPropagation(),f.preventDefault&&c.preventDefault(),f=f.returnValue));!g.visible&&g.hideDelay&&a&&(window.clearTimeout(g.hideDelay),
g.hideDelay=null,g.visible=!0);if(!k||!g.visible||!e.isEnabled())return d.debug&&console.log("hide: elem/visible/enabled: ",k,g.visible,e.isEnabled()),f;if(g.showDelay)return d.hide.cancelShowDelay||b?(window.clearTimeout(g.showDelay),g.showDelay=null,g.visible=!1,d.debug&&console.log("hide: cancelShowDelay: ",e.getTarget())):d.debug&&console.log("hide: show delay was set",e.getTarget()),f;if(g.frozen)return d.debug&&console.log("hide: frozen",e.getTarget()),f;if(!1===e.trigger("beforehide",h,c))return d.debug&&
console.log("hide: beforehide returned false",e.getTarget()),f;U(k);g.visible=!1;e.toggleTitleAttribute(!0);g.dynamicTarget&&e.resetDynamicTarget();d.hide.delay&&!a?g.hideDelay=window.setTimeout(function(){e.hideAfterDelay(c)},d.hide.delay):e.hideAfterDelay(c,a);return f},setPositionType:function(c){c&&(z(c)?(d.position.get=c,d.position.type=!1):(d.position.get=null,d.position.type=c));c=d.position.type;!1===c?g.position=!1:d.position.get&&"m"!=c?g.position="fn":(c=c.substr(0,1),g.position="w"==c?
"window":"m"==c?"mouse":"target");q&&(q.remove(),k&&q.render())},getPosition:function(c){if(!k)return null;var a,b=d.position;switch(g.position){case !1:return null;case "target":a=e.getTargetPosition(c);break;case "mouse":a=e.getMousePosition(c);break;case "window":a=e.getWindowPosition(c);break;case "fn":a=b.get.call(s,h,c)}if(!1!==b.screenX||!1!==b.screenY)a=e.correctScreenPosition(a,b.screenX,b.screenY);return a},reposition:function(c){c&&(c=D(c));if(c=e.getPosition(c))void 0!=c.x&&a(k,{left:c.x+
"px"}),void 0!=c.y&&a(k,{top:c.y+"px"}),void 0==c.x&&void 0==c.y&&a(k,c)},getContentElem:function(){return k?d.selector.content?n(d.selector.content,k).shift()||k:k:null},setContent:function(c,a){a=a||"";if(!k)return d.content.value=c,h;d.content.prepare&&(c=d.content.prepare(h,a,c));var b=h.getContentElem(),f=g.rendered&&!d.selector.content&&q,l=f&&q.getEl();if(f&&l)try{k.removeChild(l)}catch(m){}if(z(c))b.innerHTML=c;else for(var y in c){var w=d.selector[y];w&&(w=n(w,b).shift())&&(w.innerHTML=c[y])}if(f&&
l)try{k.appendChild(l)}catch(p){}b=n("img",b);g.images=b.length;y=-1;for(f=b.length;++y<f;A(b[y],"load",e.onImageLoad));e.trigger("contentchange",h,c,a);e.onContentChange();return h},readContent:function(){var c=h.getTarget(),a;c&&(a=d.content.attr?c.getAttribute(d.content.attr):c.getAttribute("tooltip")||c.getAttribute("title")||c.getAttribute("alt"));a&&e.setContent(a,"attribute");return h},loadContent:function(c){G(k,d.cls.loading);c=F({},d.ajax,c,!0,!0);e.trigger("beforeajax",h,c);return aa(c).done(e.onAjaxLoad)},
destroy:function(){e.trigger("destroy",h);C(window,"resize",e.onWindowResize);C(window,"scroll",e.onWindowScroll);e.destroyElem();q&&(q.destroy(),q=null);e.setHandlers("unbind");m.destroy();v=g=h=e=m=null},setFocus:function(){var c=d.show.focus,a;if(!0===c)if(c=n("input",k).concat(n("textarea",k)),0<c.length)c[0].focus();else{if(d.buttons)for(a in d.buttons){(a=n(d.buttons[a],k).shift())&&a.focus();break}}else(a=n(c,k).shift())&&a.focus()}},!0,!1);F(e,h,{init:function(){I.register(e);d.modal&&(d.overlay.enabled=
!0);e.setPositionType();e.setTarget(d.target);if(d.pointer.size||d.pointer.el)q=new u(e,d.pointer);d.render.lazy||e.render();e.setHandlers("bind")},setHandlers:function(c,a){for(var b=["show","hide","toggle"],f="bind"==c?A:C,l="bind"==c?da:ea,m,y,w,p,r,u,s,q,t,x;m=b.shift();)if(y=d[m].events,!1!==y){if(z(y)||Y(y))g.dynamicTarget?(r={},r[y]=d.target,y={_html:r}):y={_target:y};for(w in y){if(a)if("_self"==a){if("_self"!=w&&"_overlay"!=w&&">"!=w.substr(0,1))continue}else if(w!=a)continue;if("_self"!=
w&&"_overlay"!=w&&">"!=w.substr(0,1)||k){if(s=y[w]){switch(w){case "_target":q=[e.getTarget()];break;case "_self":q=[k];break;case "_window":q=[window];break;case "_document":q=[document];break;case "_html":q=[document.documentElement];break;case "_overlay":q=[v];break;default:q=">"==w.substr(0,1)?n(w.substr(1),k):n(w)}if(q&&q.length)if(z(s)&&(s=[s]),Y(s))for(r=0,u=s.length;r<u;r++)for(t=-1,x=q.length;++t<x;f(q[t],s[r],h[m]));else for(p in s)for(t=-1,x=q.length;++t<x;l(q[t],s[p],p,h[m]));}}else g.bindSelfOnRender=
!0}}},resetDynamicTarget:function(){var c=g.dynamicTargetEl;c&&(e.setHandlers("unbind","_target"),e.trigger("targetchange",h,null,c))},isDynamicTargetChanged:function(c){var a=d.target;c=c.target;for(var b=g.dynamicTargetEl;c&&!Q(c,a);)c=c.parentNode;return c?!b||b!==c:!1},changeDynamicTarget:function(c){var a=d.target;c=c.target;for(var b=g.dynamicTargetEl;c&&!Q(c,a);)c=c.parentNode;if(!c||b&&b===c)return!1;b&&e.setHandlers("unbind","_target");g.dynamicTargetEl=c;e.setHandlers("bind","_target");
e.trigger("targetchange",h,c,b);return!0},showAfterDelay:function(c,a){g.showDelay=null;if(g.visible){d.position.manual||e.reposition(c);"mouse"==g.position&&A(document.documentElement,"mousemove",e.onMouseMove);var b=d.position;(b.resize||b.screenX||b.screenY)&&A(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&A(window,"scroll",e.onWindowScroll);if(a||!1!==e.trigger("afterdelay",h,c)){v&&(d.overlay.animateShow?e.animate("show",null,!0):v.style.display="");if(d.show.preventScroll){var b=
d.show.preventScroll,f,k;!0===b&&(b="body");b=n(b);f=-1;for(k=b.length;++f<k;A(b[f],"mousewheel",e.onPreventScroll)&&A(b[f],"touchmove",e.onPreventScroll));}d.show.animate&&!a?e.animate("show").done(function(){e.showAfterAnimation(c)}):e.showAfterAnimation(c)}else g.visible=!1,d.debug&&console.log("showAfterDelay: afterdelay returned false",h.getTarget())}else d.debug&&console.log("showAfterDelay: already hidden",e.getTarget())},showAfterAnimation:function(c){g.visible?(P(k,d.cls.hidden),G(k,d.cls.visible),
d.render.keepVisible||(k.style.display=""),d.hide.timeout&&(g.hideTimeout=window.setTimeout(e.hide,d.hide.timeout)),d.show.focus&&window.setTimeout(e.setFocus,20),e.trigger("show",h,c)):d.debug&&console.log("showAfterAnimation: already hidden",e.getTarget())},hideAfterDelay:function(c,a){g.hideDelay=null;if(g.visible)d.debug&&console.log("hideAfterDelay: already shown again",e.getTarget());else{"mouse"==g.position&&C(document.documentElement,"mousemove",e.onMouseMove);var b=d.position;(b.resize||
b.screenX||b.screenY)&&C(window,"resize",e.onWindowResize);(b.scroll||b.screenX||b.screenY)&&C(window,"scroll",e.onWindowScroll);if(a||!1!==e.trigger("afterhidedelay",h,c)){if(d.show.preventScroll){var b=d.show.preventScroll,f,l;!0===b&&(b="body");b=n(b);f=-1;for(l=b.length;++f<l;C(b[f],"mousewheel",e.onPreventScroll)&&C(b[f],"touchmove",e.onPreventScroll));}v&&(d.overlay.animateShow?e.animate("hide",null,!0).done(function(){v.style.display="none"}):v.style.display="none");d.hide.animate&&!a?e.animate("hide").done(function(){e.hideAfterAnimation(c)}):
e.hideAfterAnimation(c)}else g.visible=d.cls.hidden?!O(k,d.cls.hidden):!(0>=k.offsetWidth||0>=k.offsetHeight),d.debug&&console.log("hideAfterDelay: afterhdelay returned false",e.getTarget())}},hideAfterAnimation:function(c){g.visible?d.debug&&console.log("hideAfterAnimation: already shown again",e.getTarget()):(P(k,d.cls.visible),G(k,d.cls.hidden),d.render.keepVisible||(k.style.display="none"),e.trigger("hide",h,c),c=d.render.lifetime,null!==c&&(0===c?e.destroyElem():g.destroyDelay=window.setTimeout(e.destroyElem,
c)),k&&d.hide.destroy&&window.setTimeout(function(){B(k,d.instanceName,null);e.destroy()},0))},render:function(){if(k)d.debug&&console.log("element already rendered",k);else{var c=d.render,b=d.cls;if(c.fn){var f=c.fn.call(s,h);c[z(f)?"tpl":"el"]=f}c.el?z(c.el)?(k=n(c.el).shift(),c.keepInDOM=!0):k=c.el:(f=document.createElement("div"),f.innerHTML=c.tpl,k=f.firstChild);k||(k=document.createElement("div"));c.id&&k.setAttribute("id",c.id);d.render.keepVisible||(k.style.display="none");G(k,b.dialog);G(k,
b.hidden);c.style&&a(k,c.style);d.overlay.enabled&&(v=document.createElement("div"),a(v,{display:"none",position:"fixed",left:0,top:0,right:0,bottom:0,opacity:d.overlay.opacity,backgroundColor:d.overlay.color}),document.body.appendChild(v),A(v,"click",e.onOverlayClick),c.zIndex&&a(v,{zIndex:c.zIndex}),d.overlay.cls&&G(v,d.overlay.cls));c.appendTo?c.appendTo.appendChild(k):!1!==c.appendTo&&document.body.appendChild(k);c.zIndex&&a(k,{zIndex:c.zIndex});c=d.content;if(!1!==c.value)if(c.value)e.setContent(c.value);
else if(c.fn)e.setContent(c.fn.call(s,h));else e[d.ajax.url?"loadContent":"readContent"]();q&&q.render();if(d.buttons)for(var l in d.buttons)if(c=n(d.buttons[l],k).shift())B(c,"metaphorjsTooltip-button-id",l),A(c,"click",e.onButtonClick),A(c,"keyup",e.onButtonKeyup);g.bindSelfOnRender&&(e.setHandlers("bind","_self"),g.bindSelfOnRender=!1);g.rendered=!0;e.trigger("render",h)}},animate:function(c,b,a){var f,h;f=a?"show"==c?d.overlay.animateShow:d.overlay.animateHide:d[c].animate;"function"===typeof f&&
(f=f(e,b));h=f.skipDisplayChange||!1;"boolean"==typeof f?f=c:z(f)&&(f=[f]);return T(k,f,function(){"show"!=c||h||(a?v.style.display="":k.style.display="")})},toggleTitleAttribute:function(c){var b=h.getTarget(),a;b&&(!1===c?(B(b,"tmp-title",b.getAttribute("title")),b.removeAttribute("title")):(a=B(b,"tmp-title"))&&b.setAttribute("title",a))},changeDynamicContent:function(){d.content.fn?e.setContent(d.content.fn.call(s,h)):d.content.attr&&e.readContent()},getDialogSize:function(){var c=d.cls.hidden?
O(k,d.cls.hidden):!!(0>=k.offsetWidth||0>=k.offsetHeight),b,e=k.style.left;c&&(a(k,{left:"-1000px"}),k.style.display="");b={width:r(k).width,height:r(k).height};c&&(a(k,{left:e}),k.style.display="none");return b},getTargetSize:function(){var c=e.getTarget();return c?{width:r(c).width,height:r(c).height}:null},getTargetPosition:function(c,b){var a=e.getTarget();if(!a)return null;var f=e.getDialogSize(),a=r(a),h=e.getTargetSize(),g={};b=b||d.position.type;var k=b.substr(0,1),l=b.substr(1),m=d.position.offsetX,
n=d.position.offsetY,p=q?q.getDialogPositionOffset():null;switch(k){case "t":g.y=a.top-f.height-n;break;case "r":g.x=a.left+h.width+m;break;case "b":g.y=a.top+h.height+n;break;case "l":g.x=a.left-f.width-m}switch(l){case "t":g.y=a.top+n;break;case "r":g.x=a.left+h.width-f.width-m;break;case "b":g.y=a.top+h.height-f.height-n;break;case "l":g.x=a.left+m;break;case "rc":g.x=a.left+h.width+m;break;case "lc":g.x=a.left-f.width-m;break;case "":switch(k){case "t":case "b":g.x=a.left+h.width/2-f.width/2;
break;case "r":case "l":g.y=a.top+h.height/2-f.height/2}}p&&(g.x+=p.x,g.y+=p.y);return g},getMousePosition:function(c){if(!c)return null;var b=e.getDialogSize(),a={},f=d.position.type.substr(1),g=d.position.offsetX,k=d.position.offsetY,l=d.position.axis,m=q?q.getDialogPositionOffset():null;switch(f){case "":a=d.position.get.call(s,h,c);break;case "t":a.y=c.pageY-b.height-k;a.x=c.pageX-b.width/2;break;case "r":a.y=c.pageY-b.height/2;a.x=c.pageX+g;break;case "b":a.y=c.pageY+k;a.x=c.pageX-b.width/2;
break;case "l":a.y=c.pageY-b.height/2;a.x=c.pageX-b.width-g;break;case "rt":a.y=c.pageY-b.height-k;a.x=c.pageX+g;break;case "rb":a.y=c.pageY+k;a.x=c.pageX+g;break;case "lt":a.y=c.pageY-b.height-k;a.x=c.pageX-b.width-g;break;case "lb":a.y=c.pageY+k,a.x=c.pageX-b.width-g}m&&(a.x+=m.x,a.y+=m.y);l&&(c=e.getTargetPosition(c,f))&&("x"==l?a.y=c.y:a.x=c.x);return a},getWindowPosition:function(){var c=e.getDialogSize(),a={},b=d.position.type.substr(1),f=d.position.offsetX,g=d.position.offsetY,h=R(),k=S(),
l=r(window).width,m=r(window).height;switch(b){case "c":a.y=m/2-c.height/2+h;a.x=l/2-c.width/2+k;break;case "t":a.y=h+g;a.x=l/2-c.width/2+k;break;case "r":a.y=m/2-c.height/2+h;a.x=l-c.width+k-f;break;case "b":a.y=m-c.height+h-g;a.x=l/2-c.width/2+k;break;case "l":a.y=m/2-c.height/2+h;a.x=k+f;break;case "rt":a.y=h+g;a.x=l-c.width+k-f;break;case "rb":a.y=m-c.height+h-g;a.x=l-c.width+k-f;break;case "lt":a.y=h+g;a.x=k+f;break;case "lb":a.y=m-c.height+h-g,a.x=k+f}return a},correctScreenPosition:function(a,
b,d){var f=e.getDialogSize(),g=R(),h=S(),k=r(window).width,l=r(window).height;d&&a.y+f.height>l+g-d&&(a.y=l+g-d-f.height);b&&a.x+f.width>k+h-b&&(a.x=k+h-b-f.width);d&&a.y<g+d&&(a.y=g+d);b&&a.x<h+b&&(a.x=h+b);return a},onMouseMove:function(a){e.reposition(D(a))},onWindowResize:function(a){e.reposition(D(a))},onWindowScroll:function(a){e.reposition(D(a))},onPreventScroll:function(a){D(a).preventDefault()},onOverlayClick:function(a){return d.modal?(a=D(a),a.preventDefault(),a.stopPropagation(),!1):null},
onButtonClick:function(a){var b=D(a).target;(b=B(b,"metaphorjsTooltip-button-id"))&&e.trigger("button",h,b,a)},onButtonKeyup:function(a){if(13==a.keyCode||32==a.keyCode){var b=B(a.target,"metaphorjsTooltip-button-id");b&&e.trigger("button",h,b,D(a))}},onAjaxLoad:function(a){P(k,d.cls.loading);e.setContent(a,"ajax")},onImageLoad:function(){g.images--;e.onContentChange()},onContentChange:function(){g.visible&&e.reposition()},destroyElem:function(){e.setHandlers("unbind","_self");g.bindSelfOnRender=
!0;q&&q.remove();v&&(v.parentNode.removeChild(v),v=null);k&&(d.render.keepInDOM||k.parentNode.removeChild(k),k=null);e.trigger("lifetime",h)}},!0,!1);delete d.callback.scope;for(var t in d.callback)h.on(t,d.callback[t],s);d.target&&d.useHref&&(t=d.target.getAttribute("href"),"#"==t.substr(0,1)?d.render.el=t:d.ajax.url=t);e.init();return h};F(E,{defaults:{}});return E}();window.jQuery&&(jQuery.fn.metaphorjsTooltip=function(a,b,f){var l="dialog",m;"string"==typeof a&&"destroy"!=a&&(m=a,a=b,b=f);a=a||
{};l+="-"+(b||"default");this.each(function(){var b=B(this,l);if(b)if("destroy"==a)b.destroy(),B(this,l,null);else throw Error("MetaphorJs tooltip already instantiated for this html element");else a.target=this,a.instanceName=l,B(this,l,new Z(m,a))})});return Z});
